{"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AAEA,IAAIA,UAAU,GAAG,KAAjB,C,CACA;;AACO,SAASC,2BAAT,CAAqCC,IAArC,EAA0D;AAC/DF,EAAAA,UAAU,GAAGE,IAAb;AACD;;AAED,IAAIC,0BAA0B,GAAG,KAAjC;AAEA,IAAIC,oBAA6B,GAAG,KAApC,C,CAEA;AACA;AACA;;AACO,SAASC,mCAAT,CAA6CC,KAA7C,EAAmE;AACxEF,EAAAA,oBAAoB,GAAGE,KAAvB;AACD;;AAED,IAAIC,cAAoC,GAAG,IAA3C;;AAEA,SAASC,WAAT,GAAsC;AACpC,SAAO,IAAIC,oBAAJ,CAAkB;AACvBC,IAAAA,SAAS,EAAE,IADY;AAEvBC,IAAAA,KAAK,EAAE,IAFgB,CAEV;;AAFU,GAAlB,CAAP;AAID;;AAED,SAASC,iBAAT,GAA4C;AAAA;;AAC1C,4BAAOL,cAAP,6DAA0BA,cAAc,GAAGC,WAAW,EAAtD;AACD,C,CAED;;;;;;;AACO,MAAMK,cAAN,SACGC,0CADH,CAE0B;AASE;AAMjC;AAGAC,EAAAA,WAAW,CACTC,KADS,EAETC,OAGC,GAAG,EALK,EAMT;AAAA;;AACA;AADA;AAAA;AAAA;AAAA,mEApBwC,CAoBxC;AAAA;AAAA,qDAlBkB,IAAIC,gCAAJ,CAAoB,KAAKC,MAAL,CAAYC,IAAZ,CAAiB,IAAjB,CAApB,CAkBlB;AAAA,yDAjB+B,KAiB/B;AAAA;AAAA;AAAA;AAAA,iDAX4B,IAW5B;;AAAA;AAAA;AAAA,aARoB;AAQpB;;AAAA;AAAA;AAAA,aAPqC;AAOrC;;AAEA,SAAKC,MAAL,CAAYC,iCAAZ;AAEA,SAAKN,KAAL,GAAaA,KAAb;AACA,wBAAKA,KAAL,4DAAYO,eAAZ,CAA4B,IAA5B,EALA,CAKmC;;AACnC,QAAIvB,UAAJ,EAAgB;AACd,WAAKwB,KAAL,GAAa,qBAAb;AACA,WAAKA,KAAL,CAAWC,GAAX,CAAeC,KAAf,CAAqBC,QAArB,GAAgC,UAAhC;AACA,WAAKC,UAAL,CAAgB,KAAKJ,KAAL,CAAWC,GAA3B;AACD,KAVD,CAYA;;;AACA,SAAKI,gBAAL,GAAwBzB,oBAAxB;AACA,SAAK0B,QAAL,GAAgB,KAAKD,gBAAL,GAAwBjB,iBAAiB,EAAzC,GAA8CJ,WAAW,EAAzE;AACA,SAAKuB,MAAL,GAAc,KAAKF,gBAAL,GACVG,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CADU,GAEV,KAAKH,QAAL,CAAcI,UAFlB;AAGA,SAAKC,eAAL,GAAuB,KAAKJ,MAAL,CAAYK,UAAZ,CAAuB,IAAvB,CAAvB,CAlBA,CAkBsD;;AACtD,SAAKR,UAAL,CAAgB,KAAKG,MAArB;AAEA,SAAKM,MAAL,GAAc,IAAIC,wBAAJ,CACZ,EADY,EAEZ,CAFY,EAET;AACH,OAHY,EAIZ,EAJY,CAAd;AAMA,SAAKD,MAAL,CAAYV,QAAZ,CAAqBY,IAArB,0BACEtB,OAAO,CAACuB,0BADV,yEACwC,IAAIC,cAAJ,CAAY,CAAZ,EAAe,CAAf,EAAkB,CAAlB,CADxC;;AAGA,QAAIxB,OAAO,CAACyB,oBAAZ,EAAkC;AAChC,WAAKL,MAAL,CAAYV,QAAZ,CAAqBgB,cAArB,CAAoC,CAAC,CAArC;AACD;;AACD,SAAKN,MAAL,CAAYO,MAAZ,CAAmB,IAAIH,cAAJ,CAAY,CAAZ,EAAe,CAAf,EAAkB,CAAlB,CAAnB,EAjCA,CAiC0C;;AAC1C,SAAKI,aAAL,GAAqB,IAAIC,wCAAJ,CACnB,KAAKT,MADc,EAEnB,KAAKN,MAFc,EAGnB,KAAKgB,cAAL,CAAoB3B,IAApB,CAAyB,IAAzB,CAHmB,CAArB,CAlCA,CAwCA;;AACA,QAAI4B,MAAM,CAACC,cAAX,EAA2B;AACzB,YAAMC,QAAQ,GAAG,IAAIF,MAAM,CAACC,cAAX,CAA0B,KAAKE,QAAL,CAAc/B,IAAd,CAAmB,IAAnB,CAA1B,CAAjB;AACA8B,MAAAA,QAAQ,CAACE,OAAT,CAAiB,KAAKC,cAAtB;AACD,KAHD,MAGO;AACL,WAAKN,cAAL;;AACA,UAAI,CAAC5C,0BAAL,EAAiC;AAC/BmD,QAAAA,OAAO,CAACC,IAAR,CACE,gHADF;AAGApD,QAAAA,0BAA0B,GAAG,IAA7B;AACD;AACF;AACF;;AAEMqD,EAAAA,SAAP,CAAiBC,OAAjB,EAAgD;AAC9C,SAAKZ,aAAL,CAAmBW,SAAnB,CAA6BC,OAAO,CAACZ,aAArC;AACAY,IAAAA,OAAO,CAACZ,aAAR,CAAsBW,SAAtB,CAAgC,KAAKX,aAArC;AACD;AAED;;;AACOa,EAAAA,6BAAP,CAAqCC,MAArC,EAA4D;AAC1D,SAAKd,aAAL,CAAmBe,0BAAnB,GAAgDD,MAAhD;AACD;;AAESE,EAAAA,iBAAV,GAAoC;AAClC;AACA,SAAKC,MAAL;AACA,SAAK3C,MAAL;AACD;;AAED4B,EAAAA,cAAc,GAAS;AACrB,SAAKgB,SAAL,CAAeC,gBAAf;AACD,GAjG8B,CAmG/B;AACA;;;AACAC,EAAAA,wBAAwB,GAAS;AAC/B,SAAKZ,cAAL,CAAoBa,SAApB,CAA8BC,GAA9B,CAAkC,WAAlC;AACA,0DAAkB,IAAlB;AACD;AAED;;;AACAC,EAAAA,6BAA6B,CAACC,CAAD,EAA+B;AAC1D,+DAAuBA,CAAvB;AACD;;AAEOlD,EAAAA,MAAR,GAAuB;AAAA;;AACrB;AACA;AACA,wBAAKK,KAAL,4DAAY8C,KAAZ;AACA,SAAKP,SAAL,CAAeQ,eAAf;;AACA,QAAI,KAAKC,aAAT,EAAwB;AACtB,WAAKV,MAAL;AACD;;AAED,QAAI,KAAKjC,gBAAT,EAA2B;AACzB,WAAKC,QAAL,CAAc2C,OAAd,CAAsB,KAAK1C,MAAL,CAAY2C,KAAlC,EAAyC,KAAK3C,MAAL,CAAY4C,MAArD,EAA6D,KAA7D;AACA,WAAKxC,eAAL,CAAqByC,SAArB,CACE,CADF,EAEE,CAFF,EAGE,KAAK7C,MAAL,CAAY2C,KAHd,EAIE,KAAK3C,MAAL,CAAY4C,MAJd;AAMD;;AACD,QAAI,KAAK3D,KAAT,EAAgB;AACd,WAAKc,QAAL,CAAcX,MAAd,CAAqB,KAAKH,KAA1B,EAAiC,KAAKqB,MAAtC,EADc,CACiC;AAChD;;AACD,QAAI,KAAKR,gBAAT,EAA2B;AACzB,WAAKM,eAAL,CAAqB0C,SAArB,CAA+B,KAAK/C,QAAL,CAAcI,UAA7C,EAAyD,CAAzD,EAA4D,CAA5D;AACD;;AAED,4CAAI,IAAJ,eAAqB;AACnB,WAAKmB,cAAL,CAAoBa,SAApB,CAA8BY,MAA9B,CAAqC,WAArC;AACD;;AACD,yBAAKtD,KAAL,8DAAYuD,GAAZ;;AAEA,4CAAI,IAAJ,oBAA0B;AACxB;AACD;AACF;;AAEO5B,EAAAA,QAAR,GAAyB;AACvB,SAAKqB,aAAL,GAAqB,IAArB;AACA,SAAKzB,cAAL;AACD;;AAEOe,EAAAA,MAAR,GAAuB;AACrB,SAAKU,aAAL,GAAqB,KAArB;AAEA,UAAMQ,CAAC,GAAG,KAAK3B,cAAL,CAAoB4B,WAA9B;AACA,UAAMC,CAAC,GAAG,KAAK7B,cAAL,CAAoB8B,YAA9B;AACA,QAAIC,GAAG,GAAG,CAAV;;AACA,QAAI,KAAKC,uBAAL,GAA+B,CAAnC,EAAsC;AACpCD,MAAAA,GAAG,GAAGE,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYD,IAAI,CAACE,KAAL,CAAW,CAACR,CAAC,GAAGE,CAAL,IAAU,GAArB,CAAZ,CAAN;AACD,KAFD,MAEO,IAAI,KAAKG,uBAAL,GAA+B,CAAnC,EAAsC;AAC3CD,MAAAA,GAAG,GAAG,CAACE,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYD,IAAI,CAACE,KAAL,CAAW,CAACR,CAAC,GAAGE,CAAL,IAAU,GAArB,CAAZ,CAAP;AACD;;AACD,QAAIO,IAAI,GAAG,CAAX;AACA,QAAIC,MAAM,GAAG,CAAb;;AACA,QAAIR,CAAC,GAAGF,CAAR,EAAW;AACTU,MAAAA,MAAM,GAAGR,CAAC,GAAGF,CAAb;AACAS,MAAAA,IAAI,GAAG,CAACH,IAAI,CAACE,KAAL,CAAW,MAAME,MAAjB,CAAR;AACD;;AACD,SAAKrD,MAAL,CAAYsD,MAAZ,GAAqBX,CAAC,GAAGE,CAAzB;AACA,SAAK7C,MAAL,CAAYuD,aAAZ,CAA0BZ,CAA1B,EAA6BE,CAAC,GAAGQ,MAAjC,EAAyCN,GAAzC,EAA8CK,IAA9C,EAAoDT,CAApD,EAAuDE,CAAvD;AACA,SAAK7C,MAAL,CAAYwD,sBAAZ,GAnBqB,CAmBiB;;AAEtC,QAAI,KAAKhE,gBAAT,EAA2B;AACzB,WAAKE,MAAL,CAAY2C,KAAZ,GAAoBM,CAAC,GAAG,yBAAxB;AACA,WAAKjD,MAAL,CAAY4C,MAAZ,GAAqBO,CAAC,GAAG,yBAAzB;AACA,WAAKnD,MAAL,CAAYL,KAAZ,CAAkBgD,KAAlB,GAA0BM,CAAC,CAACc,QAAF,EAA1B;AACA,WAAK/D,MAAL,CAAYL,KAAZ,CAAkBiD,MAAlB,GAA2BK,CAAC,CAACc,QAAF,EAA3B;AACD,KALD,MAKO;AACL,WAAKhE,QAAL,CAAciE,aAAd,CAA4B,yBAA5B;AACA,WAAKjE,QAAL,CAAc2C,OAAd,CAAsBO,CAAtB,EAAyBE,CAAzB,EAA4B,IAA5B;AACD;;AAED,SAAKnC,cAAL;AACD,GAvL8B,CAyL/B;;;AACAiD,EAAAA,eAAe,CAAC/E,OAAiC,GAAG,EAArC,EAAiD;AAC9D;AACA;AACA,SAAKE,MAAL,GAH8D,CAK9D;;AACA,QAAI,CAACF,OAAO,CAACgF,UAAT,IAAuB,KAAKlE,MAAL,CAAY2C,KAAZ,KAAsB,KAAK3C,MAAL,CAAY4C,MAA7D,EAAqE;AACnE;AACA,aAAO,KAAK5C,MAAL,CAAYmE,SAAZ,EAAP;AACD,KAHD,MAGO;AACL,YAAMC,UAAU,GAAGnE,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAnB;AACA,YAAMmE,UAAU,GAAGd,IAAI,CAACe,GAAL,CAAS,KAAKtE,MAAL,CAAY2C,KAArB,EAA4B,KAAK3C,MAAL,CAAY4C,MAAxC,CAAnB;AACAwB,MAAAA,UAAU,CAACzB,KAAX,GAAmB0B,UAAnB;AACAD,MAAAA,UAAU,CAACxB,MAAX,GAAoByB,UAApB;AACA,YAAME,OAAO,GAAGH,UAAU,CAAC/D,UAAX,CAAsB,IAAtB,CAAhB,CALK,CAKyC;;AAC9CkE,MAAAA,OAAO,CAACzB,SAAR,CACE,KAAK9C,MADP,EAEE,EAAE,KAAKA,MAAL,CAAY2C,KAAZ,GAAoB0B,UAAtB,IAAoC,CAFtC,EAGE,EAAE,KAAKrE,MAAL,CAAY4C,MAAZ,GAAqByB,UAAvB,IAAqC,CAHvC;AAKA,aAAOD,UAAU,CAACD,SAAX,EAAP;AACD;AACF;;AAhN8B;;;;AAmNjCK,2CAAmBC,MAAnB,CAA0B,kBAA1B,EAA8C3F,cAA9C;;;;;;;;;;;;;AC/PA;AACO,MAAMK,eAAN,CAAsB;AAG3BH,EAAAA,WAAW,CAAS0F,QAAT,EAA6D;AAAA,SAApDA,QAAoD,GAApDA,QAAoD;AAAA,uDAFnC,IAEmC;AAAA,qDADpD,KAAKC,gBAAL,CAAsBtF,IAAtB,CAA2B,IAA3B,CACoD;AAAE;;AAC1E4C,EAAAA,gBAAgB,GAAS;AACvB,QAAI,CAAC,KAAK2C,WAAV,EAAuB;AACrB,WAAKA,WAAL,GAAmBC,qBAAqB,CAAC,KAAKC,SAAN,CAAxC;AACD;AACF;;AAEDtC,EAAAA,eAAe,GAAS;AACtB,QAAI,KAAKoC,WAAT,EAAsB;AACpBG,MAAAA,oBAAoB,CAAC,KAAKH,WAAN,CAApB;AACA,WAAKA,WAAL,GAAmB,CAAnB;AACD;AACF;;AAEOD,EAAAA,gBAAR,CAAyBK,SAAzB,EAA+D;AAC7D,SAAKJ,WAAL,GAAmB,CAAnB;AACA,SAAKF,QAAL,CAAcM,SAAd;AACD;;AApB0B;;;;;;;;;;;;;;;ACD7B;;AAKO,MAAMC,SAAN,CAAgB;AACrBjG,EAAAA,WAAW,CAASkG,UAAT,EAA6B,CACtC;AACA;AACA;AACA;AACA;;AALsC,SAApBA,UAAoB,GAApBA,UAAoB;AAMvC;;AAEDC,EAAAA,WAAW,GAAW;AACpB,WAAO,KAAKD,UAAZ;AACD;;AAXoB,C,CAcvB;AACA;AACA;;;;;AACO,MAAMnG,oBAAN,SAAmCqG,uCAAnC,CAAmD;AAEjB;AAGvCpG,EAAAA,WAAW,CAACE,OAAD,EAAwC;AAAA;;AACjD;AADiD;AAAA;AAAA,wDADM,IAAImG,GAAJ,EACN;AAEjD,SAAKC,MAAL,GAAc,KAAKC,YAAL,CAAkB;AAAEC,MAAAA,IAAI,mBAAEtG,OAAF,aAAEA,OAAF,uBAAEA,OAAO,CAAEsG,IAAX,yDAAmB;AAAzB,KAAlB,CAAd;AAEA,SAAKlE,cAAL,GAAsBrB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAtB;AACA,SAAKoB,cAAL,CAAoBa,SAApB,CAA8BC,GAA9B,CAAkC,SAAlC;AACA,SAAKkD,MAAL,CAAYG,WAAZ,CAAwB,KAAKnE,cAA7B;AACD,GAZuD,CAcxD;;;AACOhC,EAAAA,MAAP,CAAcoG,SAAd,EAA0C;AACxC,QAAI,KAAKC,YAAL,CAAkBC,GAAlB,CAAsBF,SAAtB,CAAJ,EAAsC;AACpC;AACD;;AAED,UAAMG,OAAyB,GAAG5F,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAlC;AACA2F,IAAAA,OAAO,CAACC,WAAR,GAAsBJ,SAAS,CAACP,WAAV,EAAtB;AAEA,SAAKQ,YAAL,CAAkBI,GAAlB,CAAsBL,SAAtB,EAAiCG,OAAjC;AACA,SAAKP,MAAL,CAAYG,WAAZ,CAAwBI,OAAxB;AACD,GAzBuD,CA2BxD;;;AACOG,EAAAA,SAAP,CAAiBN,SAAjB,EAA6C;AAC3C,UAAMG,OAAO,GAAG,KAAKF,YAAL,CAAkBC,GAAlB,CAAsBF,SAAtB,CAAhB;;AACA,QAAI,CAACG,OAAL,EAAc;AACZ;AACD;;AACD,SAAKP,MAAL,CAAYW,WAAZ,CAAwBJ,OAAxB;AACA,SAAKF,YAAL,CAAkBO,MAAlB,CAAyBR,SAAzB;AACD;;AAEM7F,EAAAA,UAAP,CAAkCsG,OAAlC,EAAiD;AAC/C,WAAO,KAAK7E,cAAL,CAAoBmE,WAApB,CAAgCU,OAAhC,CAAP;AACD;;AAEMC,EAAAA,cAAP,CAAsCD,OAAtC,EAAwD;AACtD,SAAK7E,cAAL,CAAoB+E,OAApB,CAA4BF,OAA5B;AACD;;AAEMG,EAAAA,aAAP,CAAqCH,OAArC,EAAoD;AAClD,WAAO,KAAK7E,cAAL,CAAoB2E,WAApB,CAAgCE,OAAhC,CAAP;AACD;;AA/CuD;;;;AAkD1D3B,2CAAmBC,MAAnB,CACE,+BADF,EAEE1F,oBAFF;;;;;;;;;ACxEA;AACA;AAEA;AACA,MAAMwH,eAAN,CAAsB;;AAEtB,IAAInB,eAAJ;;;AACA,IAAI,OAAOoB,WAAP,KAAuB,WAA3B,EAAwC;AACtC,4BAAApB,eAAe,GAAGoB,WAAlB;AACD,CAFD,MAEO;AACL,4BAAApB,eAAe,GAAGmB,eAAlB;AACD;;AAID,MAAME,kBAAN,CAAyB;AACvBhC,EAAAA,MAAM,GAAS,CACb;AACD;;AAHsB;;AAMzB,IAAID,kBAAJ;;;AAEA,IAAI,OAAOkC,cAAP,KAA0B,WAA9B,EAA2C;AACzC,+BAAAlC,kBAAkB,GAAGkC,cAArB;AACD,CAFD,MAEO;AACL,+BAAAlC,kBAAkB,GAAG,IAAIiC,kBAAJ,EAArB;AACD;;;;;;;;;AC3BD;AACO,SAASE,UAAT,GAA8B;AACnC,SAAOC,gBAAgB,IAAI,CAA3B;AACD;;;;;;;;;ACHD;;AAEA;AACA;AACA;AACA;AACA;AAEO,MAAMrH,iBAAiB,GAAG,IAAI0F,+BAAJ,CAAe;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAvBiC,CAA1B;;;;;;;;;;;;;;ACRP;;AACA;;AAEA;AACA;AACA;AACA,MAAM4B,OAAO,GAAG,UAAhB;AAEA,MAAMC,eAAwB,GAAG,IAAjC;AACA,MAAMC,uBAAgC,GAAG,IAAzC;AAEA,MAAMC,mBAAmB,GAAG,GAA5B,C,CACA;AACA;AACA;;AACA,MAAMC,kBAAkB,GAAG,EAA3B;AAEA,MAAMC,4BAA4B,GAAG,IAArC,C,CAEA;;AACA,SAASC,aAAT,CAAuBC,QAAvB,EAAyC;AACvC;AACA;AACA;AACA;AACA;AACA,SAAO,CAAC7D,IAAI,CAAC8D,GAAL,CAAS,IAAID,QAAb,KAA0B,IAAIA,QAA9B,CAAD,KAA6C,IAAI7D,IAAI,CAAC+D,CAAtD,IAA2D,CAAlE;AACD;;AAED,MAAMC,OAAN,CAAc;AAGZvI,EAAAA,WAAW,CACDwI,cADC,EAEDC,SAFC,EAGDC,SAHC,EAIDhD,QAJC,EAKT;AAAA,SAJQ8C,cAIR,GAJQA,cAIR;AAAA,SAHQC,SAGR,GAHQA,SAGR;AAAA,SAFQC,SAER,GAFQA,SAER;AAAA,SADQhD,QACR,GADQA,QACR;AAAA,qDAPkB,IAAIvF,gCAAJ,CAAoB,KAAKC,MAAL,CAAYC,IAAZ,CAAiB,IAAjB,CAApB,CAOlB;AAAA;AACA,SAAK2C,SAAL,CAAeC,gBAAf;AACA,SAAK0F,aAAL,GAAqBH,cAArB;AACD;;AAEOpI,EAAAA,MAAR,CAAewI,GAAf,EAAyC;AACvC,UAAMC,cAAc,GAClB,CAAC,KAAKF,aAAL,GAAqB,KAAKH,cAA3B,IAA6CR,mBAD/C;AAEA,UAAMc,aAAa,GAAGvE,IAAI,CAACe,GAAL,CACpB,CADoB,EAEpB,CAACsD,GAAG,GAAG,KAAKJ,cAAZ,IAA8BR,mBAFV,CAAtB;;AAKA,QACEa,cAAc,KAAK,CAAnB,IACAC,aAAa,GAAGb,kBAAkB,GAAGD,mBAFvC,EAGE;AACA;AACA;AACD;;AAED,UAAMe,KAAK,GAAGZ,aAAa,CAACW,aAAD,CAAb,GAA+BX,aAAa,CAACU,cAAD,CAA1D,CAhBuC,CAkBvC;AACA;;AACA,SAAKnD,QAAL,CAAc,KAAK+C,SAAL,GAAiBM,KAAjB,GAAyB,IAAvC,EAA6C,KAAKL,SAAL,GAAiBK,KAAjB,GAAyB,IAAtE;;AAEA,QAAID,aAAa,GAAG,CAApB,EAAuB;AACrB,WAAK9F,SAAL,CAAeC,gBAAf;AACD;;AACD,SAAK0F,aAAL,GAAqBC,GAArB;AACD;;AAvCW,C,CA0Cd;;;AACO,MAAM7G,mBAAN,CAA0B;AAC/B;;AAEA;AAK8C;AAM9C;AASA/B,EAAAA,WAAW,CACDsB,MADC,EAEDN,MAFC,EAGDgB,cAHC,EAIT;AAAA,SAHQV,MAGR,GAHQA,MAGR;AAAA,SAFQN,MAER,GAFQA,MAER;AAAA,SADQgB,cACR,GADQA,cACR;AAAA,+DAzB6B8F,eAyB7B;AAAA,sEAvBoCC,uBAuBpC;AAAA;AAAA,4DArBiC,CAqBjC;AAAA,4DApBiC,CAoBjC;AAAA,0DAnBsC,IAmBtC;AAAA,uDAlBoB,KAAKiB,MAAL,CAAY3I,IAAZ,CAAiB,IAAjB,CAkBpB;AAAA,4DAjByB,KAAK4I,WAAL,CAAiB5I,IAAjB,CAAsB,IAAtB,CAiBzB;AAAA,2DAhBwB,KAAK6I,UAAL,CAAgB7I,IAAhB,CAAqB,IAArB,CAgBxB;AAAA,4DAfyB,KAAK8I,WAAL,CAAiB9I,IAAjB,CAAsB,IAAtB,CAezB;AAAA,2DAdwB,KAAK+I,UAAL,CAAgB/I,IAAhB,CAAqB,IAArB,CAcxB;AAAA,yDAZiC,IAAIgJ,gBAAJ,EAYjC;AAAA,8DAXmC,CAWnC;AAAA,kEAVuC,CAUvC;AAAA,kEATuC,CASvC;AAAA,8DARmC,CAQnC;AAAA,kEAPuC,CAOvC;AAAA,kEANuC,CAMvC;AAAA,oEALyC,KAKzC;AACArI,IAAAA,MAAM,CAACsI,gBAAP,CAAwB,WAAxB,EAAqC,KAAKC,YAAL,CAAkBlJ,IAAlB,CAAuB,IAAvB,CAArC;AACAW,IAAAA,MAAM,CAACsI,gBAAP,CAAwB,YAAxB,EAAsC,KAAKE,YAAL,CAAkBnJ,IAAlB,CAAuB,IAAvB,CAAtC;AACD,GA9B8B,CAgC/B;;;AACAoJ,EAAAA,cAAc,CAACnG,CAAD,EAAoB;AAChC;AACA;AACA,WAAQiB,IAAI,CAACmF,IAAL,CAAUpG,CAAV,IAAeiB,IAAI,CAACoF,GAAL,CAASpF,IAAI,CAACqF,GAAL,CAAStG,CAAC,GAAG,EAAb,IAAmB,CAA5B,CAAhB,GAAkD,CAAzD;AACD;;AAEDiG,EAAAA,YAAY,CAACM,CAAD,EAAsB;AAChC5H,IAAAA,MAAM,CAACqH,gBAAP,CAAwB,WAAxB,EAAqC,KAAKQ,gBAA1C;AACA7H,IAAAA,MAAM,CAACqH,gBAAP,CAAwB,SAAxB,EAAmC,KAAKS,eAAxC;AACA,SAAKC,OAAL,CAAaH,CAAb;AAEA,SAAKI,kBAAL,GAA0BJ,CAAC,CAACK,SAA5B;AACD;;AAEDjB,EAAAA,WAAW,CAACY,CAAD,EAAsB;AAC/B,QAAIA,CAAC,CAACM,OAAF,KAAc,CAAlB,EAAqB;AACnB;AACA;AACA;AACA,WAAKjB,UAAL,CAAgBW,CAAhB;AACA;AACD;;AACD,UAAMO,MAAM,GAAG7F,IAAI,CAACe,GAAL,CAAS,KAAKtE,MAAL,CAAYqJ,WAArB,EAAkC,KAAKrJ,MAAL,CAAYsJ,YAA9C,CAAf;AACA,UAAMC,SAAS,GAAG,KAAKd,cAAL,CAAoBI,CAAC,CAACU,SAAF,GAAcH,MAAlC,CAAlB;AACA,UAAMI,SAAS,GAAG,KAAKf,cAAL,CACfI,CAAC,CAACW,SAAF,GAAcJ,MAAf,GAAyBlC,4BADT,CAAlB;AAGA,SAAKc,MAAL,CAAYuB,SAAZ,EAAuBC,SAAvB;AAEA,SAAKC,sBAAL,GACEF,SAAS,IAAIV,CAAC,CAACK,SAAF,GAAc,KAAKD,kBAAvB,CADX;AAEA,SAAKS,sBAAL,GACEF,SAAS,IAAIX,CAAC,CAACK,SAAF,GAAc,KAAKD,kBAAvB,CADX;AAEA,SAAKA,kBAAL,GAA0BJ,CAAC,CAACK,SAA5B;AACD;;AAEDhB,EAAAA,UAAU,CAACW,CAAD,EAAsB;AAC9B5H,IAAAA,MAAM,CAAC0I,mBAAP,CAA2B,WAA3B,EAAwC,KAAKb,gBAA7C;AACA7H,IAAAA,MAAM,CAAC0I,mBAAP,CAA2B,SAA3B,EAAsC,KAAKZ,eAA3C;AACA,SAAKa,KAAL,CAAWf,CAAX;;AAEA,QAAI,KAAKgB,mBAAT,EAA8B;AAC5B,UAAItC,OAAJ,CACE,KAAK0B,kBADP,EAEE,KAAKQ,sBAFP,EAGE,KAAKC,sBAHP,EAIE,KAAKI,WAJP;AAMD;AACF;;AAEDtB,EAAAA,YAAY,CAACK,CAAD,EAAsB;AAChC,QAAI,KAAKkB,cAAL,KAAwB,IAA5B,EAAkC;AAChC,WAAKA,cAAL,GAAsBlB,CAAC,CAACmB,cAAF,CAAiB,CAAjB,EAAoBC,UAA1C;AACA,WAAKC,gBAAL,GAAwBrB,CAAC,CAACsB,OAAF,CAAU,CAAV,EAAaC,OAArC;AACA,WAAKC,gBAAL,GAAwBxB,CAAC,CAACsB,OAAF,CAAU,CAAV,EAAaG,OAArC;AACArJ,MAAAA,MAAM,CAACqH,gBAAP,CAAwB,WAAxB,EAAqC,KAAKiC,gBAA1C;AACAtJ,MAAAA,MAAM,CAACqH,gBAAP,CAAwB,UAAxB,EAAoC,KAAKkC,eAAzC;AACAvJ,MAAAA,MAAM,CAACqH,gBAAP,CAAwB,YAAxB,EAAsC,KAAKkC,eAA3C;AACA,WAAKxB,OAAL,CAAaH,CAAb;AAEA,WAAK4B,kBAAL,GAA0B5B,CAAC,CAACK,SAA5B;AACD;AACF;;AAEDf,EAAAA,WAAW,CAACU,CAAD,EAAsB;AAC/B,SAAK,IAAI6B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG7B,CAAC,CAACmB,cAAF,CAAiBW,MAArC,EAA6CD,CAAC,EAA9C,EAAkD;AAChD,YAAME,KAAK,GAAG/B,CAAC,CAACmB,cAAF,CAAiBU,CAAjB,CAAd;;AACA,UAAIE,KAAK,CAACX,UAAN,KAAqB,KAAKF,cAA9B,EAA8C;AAC5C,cAAMX,MAAM,GAAG7F,IAAI,CAACe,GAAL,CACb,KAAKtE,MAAL,CAAYqJ,WADC,EAEb,KAAKrJ,MAAL,CAAYsJ,YAFC,CAAf;AAIA,cAAMC,SAAS,GAAG,KAAKd,cAAL,CAChB,CAACmC,KAAK,CAACR,OAAN,GAAgB,KAAKF,gBAAtB,IAA0Cd,MAD1B,CAAlB;AAGA,cAAMI,SAAS,GAAG,KAAKf,cAAL,CACf,CAACmC,KAAK,CAACN,OAAN,GAAgB,KAAKD,gBAAtB,IAA0CjB,MAA3C,GACElC,4BAFc,CAAlB;AAIA,aAAKc,MAAL,CAAYuB,SAAZ,EAAuBC,SAAvB;AACA,aAAKU,gBAAL,GAAwBU,KAAK,CAACR,OAA9B;AACA,aAAKC,gBAAL,GAAwBO,KAAK,CAACN,OAA9B;AAEA,aAAKO,sBAAL,GACEtB,SAAS,IAAIV,CAAC,CAACK,SAAF,GAAc,KAAKuB,kBAAvB,CADX;AAEA,aAAKK,sBAAL,GACEtB,SAAS,IAAIX,CAAC,CAACK,SAAF,GAAc,KAAKuB,kBAAvB,CADX;AAEA,aAAKA,kBAAL,GAA0B5B,CAAC,CAACK,SAA5B;AACD;AACF;AACF;;AAEDd,EAAAA,UAAU,CAACS,CAAD,EAAsB;AAC9B,SAAK,IAAI6B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG7B,CAAC,CAACmB,cAAF,CAAiBW,MAArC,EAA6CD,CAAC,EAA9C,EAAkD;AAChD,YAAME,KAAK,GAAG/B,CAAC,CAACmB,cAAF,CAAiBU,CAAjB,CAAd;;AACA,UAAIE,KAAK,CAACX,UAAN,KAAqB,KAAKF,cAA9B,EAA8C;AAC5C,aAAKA,cAAL,GAAsB,IAAtB;AACA9I,QAAAA,MAAM,CAAC0I,mBAAP,CAA2B,WAA3B,EAAwC,KAAKY,gBAA7C;AACAtJ,QAAAA,MAAM,CAAC0I,mBAAP,CAA2B,UAA3B,EAAuC,KAAKa,eAA5C;AACAvJ,QAAAA,MAAM,CAAC0I,mBAAP,CAA2B,aAA3B,EAA0C,KAAKa,eAA/C;AACA,aAAKZ,KAAL,CAAWf,CAAX;AACD;AACF;;AAED,QAAI,KAAKgB,mBAAT,EAA8B;AAC5B,UAAItC,OAAJ,CACE,KAAKkD,kBADP,EAEE,KAAKI,sBAFP,EAGE,KAAKC,sBAHP,EAIE,KAAKhB,WAJP;AAMD;AACF;;AAEDd,EAAAA,OAAO,CAACH,CAAD,EAAmC;AACxCA,IAAAA,CAAC,CAACkC,cAAF;AACD;;AAED/C,EAAAA,MAAM,CAACuB,SAAD,EAAoBC,SAApB,EAA6C;AAAA;;AACjD;AACA;AACA,SAAKwB,aAAL,CAAmBC,cAAnB,CAAkC,KAAK3K,MAAL,CAAYV,QAA9C;AAEA,SAAKoL,aAAL,CAAmBE,KAAnB,IAA4B,CAAC,CAAD,GAAK3B,SAAjC;AACA,SAAKyB,aAAL,CAAmBG,GAAnB,IAA0B,CAAC,CAAD,GAAK3B,SAA/B;;AACA,QAAI,KAAK3H,0BAAT,EAAqC;AACnC,WAAKmJ,aAAL,CAAmBG,GAAnB,GAAyB5H,IAAI,CAACC,GAAL,CAAS,KAAKwH,aAAL,CAAmBG,GAA5B,EAAiC5H,IAAI,CAAC6H,EAAL,GAAU,GAA3C,CAAzB;AACA,WAAKJ,aAAL,CAAmBG,GAAnB,GAAyB5H,IAAI,CAACe,GAAL,CAAS,KAAK0G,aAAL,CAAmBG,GAA5B,EAAiC5H,IAAI,CAAC6H,EAAL,GAAU,GAA3C,CAAzB;AACD,KAHD,MAGO;AACL,WAAKJ,aAAL,CAAmBG,GAAnB,GAAyB5H,IAAI,CAACC,GAAL,CAAS,KAAKwH,aAAL,CAAmBG,GAA5B,EAAiCtE,OAAjC,CAAzB;AACA,WAAKmE,aAAL,CAAmBG,GAAnB,GAAyB5H,IAAI,CAACe,GAAL,CACvB,KAAK0G,aAAL,CAAmBG,GADI,EAEvB5H,IAAI,CAAC6H,EAAL,GAAUvE,OAFa,CAAzB;AAID;;AAED,SAAKvG,MAAL,CAAYV,QAAZ,CAAqByL,gBAArB,CAAsC,KAAKL,aAA3C;AACA,SAAK1K,MAAL,CAAYO,MAAZ,CAAmB,IAAIH,cAAJ,CAAY,CAAZ,EAAe,CAAf,EAAkB,CAAlB,CAAnB;AACA,SAAK4K,wBAAL,GAAgC,IAAhC;AAEA,SAAKtK,cAAL;AACA,iCAAKuK,cAAL,8EAAqBC,oBAArB,CAA0C,KAAKlL,MAA/C,EAvBiD,CAwBjD;AACA;AACA;AACD;;AAEDsJ,EAAAA,KAAK,CAACf,CAAD,EAAmC;AACtCA,IAAAA,CAAC,CAACkC,cAAF;AACD;;AAEMtJ,EAAAA,SAAP,CAAiBgK,CAAjB,EAA+C;AAC7C,SAAKF,cAAL,GAAsBE,CAAtB;AACD;;AAEDD,EAAAA,oBAAoB,CAACE,CAAD,EAAkB;AACpC,SAAKpL,MAAL,CAAYV,QAAZ,CAAqBY,IAArB,CAA0BkL,CAAC,CAAC9L,QAA5B;AACA,SAAKU,MAAL,CAAYV,QAAZ,CAAqBgB,cAArB,CAAoC,CAAC,CAArC;AACA,SAAKN,MAAL,CAAYO,MAAZ,CAAmB,IAAIH,cAAJ,CAAY,CAAZ,EAAe,CAAf,EAAkB,CAAlB,CAAnB;AACA,SAAKM,cAAL;AACD;;AAlM8B;;;;ACxEjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;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5U,UAAL,CACE,IAAIy9B,mBAAJ,CAAwB7oB,QAAxB,EAAmC,cAAnC,EAAmD;AACjD+oB,MAAAA,wBAAwB,EAAEt+B,OAAF,aAAEA,OAAF,uBAAEA,OAAO,CAAEuY;AADc,KAAnD,CADF,EAIEtV,SAJF,CAIYC,GAJZ,CAIgB,qBAJhB;AAKA;AACD;;AAEDyU,EAAAA,aAAa,CAACvG,UAAD,EAAmC;AAC9C,2EAAiCc,QAAjC,CAA0Cd,UAA1C;AACD;;AAzC+B;;;;AA4ClC9L,2CAAmBC,MAAnB,CACE,6BADF,EAEE8S,wBAFF;;;;;;;;;ACnUA;;AAEO,MAAMmnB,aAAa,GAAG,IAAIz5B,+BAAJ,CAAe;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CA5B6B,CAAtB;;AA8BA,MAAMw4B,SAAS,GAAG,IAAIx4B,+BAAJ,CAAe;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CA5EyB,CAAlB,C,CA8EP;AACA;AACA;AACA;;;;;;;;;;;;;;;AC5GA;;AACA;;AAEA;;AARA;AAUA;AACO,MAAMoS,cAAN,SACGtY,0CADH,CAEsD;AAEA;AAC3DC,EAAAA,WAAW,CAACyV,QAAD,EAAsB;AAAA;;AAC/B;AAD+B;AAAA,iDADPxU,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CACO;AAE/B,SAAKuU,QAAL,GAAgBA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","sources":["./src/cubing/twisty/dom/viewers/Twisty3DCanvas.ts","./src/cubing/twisty/animation/RenderScheduler.ts","./src/cubing/twisty/dom/element/ManagedCustomElement.ts","./src/cubing/twisty/dom/element/node-custom-element-shims.ts","./src/cubing/twisty/dom/viewers/canvas.ts","./src/cubing/twisty/dom/viewers/Twisty3DCanvas.css.ts","./src/cubing/twisty/dom/viewers/TwistyOrbitControls.ts","src/vendor/node_modules/three/examples/jsm/libs/stats.module.js","./src/cubing/notation/index.ts","./src/cubing/notation/CountMoves.ts","./src/cubing/notation/CountAnimatedMoves.ts","./src/cubing/twisty/dom/TwistyPlayerConfig.ts","./src/cubing/twisty/dom/element/ElementConfig.ts","./src/cubing/twisty/dom/viewers/TwistyViewerWrapper.ts","./src/cubing/twisty/dom/element/ClassListManager.ts","./src/cubing/twisty/dom/viewers/TwistyViewerWrapper.css.ts","./src/cubing/twisty/dom/TwistyPlayer.ts","./src/cubing/twisty/3D/puzzles/Cube3D.ts","./src/cubing/twisty/animation/easing.ts","./src/cubing/twisty/3D/TAU.ts","./src/cubing/twisty/3D/puzzles/PG3D.ts","./src/cubing/twisty/3D/Twisty3DScene.ts","./src/cubing/twisty/animation/cursor/AlgCursor.ts","./src/cubing/twisty/3D/puzzles/KPuzzleWrapper.ts","./src/cubing/twisty/animation/indexer/tree/TreeAlgIndexer.ts","./src/cubing/twisty/animation/indexer/tree/chunkAlgs.ts","./src/cubing/twisty/animation/indexer/tree/AlgWalker.ts","./src/cubing/twisty/animation/indexer/AlgDuration.ts","./src/cubing/twisty/animation/cursor/CursorTypes.ts","./src/cubing/twisty/animation/indexer/SimpleAlgIndexer.ts","./src/cubing/twisty/animation/indexer/simultaneous-moves/SimultaneousMoveIndexer.ts","./src/cubing/twisty/animation/indexer/simultaneous-moves/simul-moves.ts","./src/cubing/twisty/animation/Timeline.ts","./src/cubing/twisty/dom/controls/buttons.ts","./src/cubing/twisty/dom/controls/buttons.css.ts","./src/cubing/twisty/dom/controls/TwistyScrubber.ts","./src/cubing/twisty/dom/controls/TwistyScrubber.css.ts","./src/cubing/twisty/dom/TwistyPlayer.css.ts","./src/cubing/twisty/dom/viewers/Twisty2DSVG.ts","./src/cubing/twisty/dom/viewers/Twisty2DSVGView.css.ts"],"sourcesContent":["import { PerspectiveCamera, Vector3, WebGLRenderer } from \"three\";\nimport { Twisty3DScene } from \"../../3D/Twisty3DScene\";\nimport { RenderScheduler } from \"../../animation/RenderScheduler\";\nimport { ManagedCustomElement } from \"../element/ManagedCustomElement\";\nimport { pixelRatio } from \"./canvas\";\nimport { twisty3DCanvasCSS } from \"./Twisty3DCanvas.css\";\nimport { TwistyOrbitControls } from \"./TwistyOrbitControls\";\nimport { TwistyViewerElement } from \"./TwistyViewerElement\";\nimport { customElementsShim } from \"../element/node-custom-element-shims\";\nimport Stats from \"../../../../vendor/node_modules/three/examples/jsm/libs/stats.module\";\n\nlet SHOW_STATS = false;\n// Show render stats for newly contructed renderers.\nexport function experimentalShowRenderStats(show: boolean): void {\n  SHOW_STATS = show;\n}\n\nlet resizeObserverWarningShown = false;\n\nlet shareAllNewRenderers: boolean = false;\n\n// WARNING: The current shared renderer implementation is not every efficient.\n// Avoid using for players that are likely to have dimensions approaching 1 megapixel or higher.\n// TODO: use a dedicated renderer while fullscreen?\nexport function experimentalSetShareAllNewRenderers(share: boolean): void {\n  shareAllNewRenderers = share;\n}\n\nlet sharedRenderer: WebGLRenderer | null = null;\n\nfunction newRenderer(): WebGLRenderer {\n  return new WebGLRenderer({\n    antialias: true,\n    alpha: true, // TODO\n  });\n}\n\nfunction newSharedRenderer(): WebGLRenderer {\n  return sharedRenderer ?? (sharedRenderer = newRenderer());\n}\n\n// <twisty-3d-canvas>\nexport class Twisty3DCanvas\n  extends ManagedCustomElement\n  implements TwistyViewerElement {\n  private scene: Twisty3DScene;\n  public canvas: HTMLCanvasElement;\n  public camera: PerspectiveCamera;\n  private legacyExperimentalShift: number = 0;\n  private orbitControls: TwistyOrbitControls;\n  private scheduler = new RenderScheduler(this.render.bind(this));\n  private resizePending: boolean = false;\n\n  private renderer: WebGLRenderer; // TODO: share renderers across elements? (issue: renderers are not designed to be constantly resized?)\n  private rendererIsShared: boolean;\n  private canvas2DContext: CanvasRenderingContext2D;\n\n  private stats: Stats | null = null;\n\n  // TODO: Are there any render duration performance concerns with removing this?\n  #invisible: boolean = false;\n  #onRenderFinish: null | (() => void) = null;\n  constructor(\n    scene?: Twisty3DScene,\n    options: {\n      experimentalCameraPosition?: Vector3;\n      negateCameraPosition?: boolean;\n    } = {},\n  ) {\n    super();\n    this.addCSS(twisty3DCanvasCSS);\n\n    this.scene = scene!;\n    this.scene?.addRenderTarget(this); // TODO\n    if (SHOW_STATS) {\n      this.stats = Stats();\n      this.stats.dom.style.position = \"absolute\";\n      this.addElement(this.stats.dom);\n    }\n\n    // We rely on the resize logic to handle renderer dimensions.\n    this.rendererIsShared = shareAllNewRenderers;\n    this.renderer = this.rendererIsShared ? newSharedRenderer() : newRenderer();\n    this.canvas = this.rendererIsShared\n      ? document.createElement(\"canvas\")\n      : this.renderer.domElement;\n    this.canvas2DContext = this.canvas.getContext(\"2d\")!; // TODO: avoid saving unneeded?\n    this.addElement(this.canvas);\n\n    this.camera = new PerspectiveCamera(\n      20,\n      1, // We rely on the resize logic to handle this.\n      0.1,\n      20,\n    );\n    this.camera.position.copy(\n      options.experimentalCameraPosition ?? new Vector3(2, 4, 4),\n    );\n    if (options.negateCameraPosition) {\n      this.camera.position.multiplyScalar(-1);\n    }\n    this.camera.lookAt(new Vector3(0, 0, 0)); // TODO: Handle with `negateCameraPosition`\n    this.orbitControls = new TwistyOrbitControls(\n      this.camera,\n      this.canvas,\n      this.scheduleRender.bind(this),\n    );\n\n    // TODO: Remove this when enough Safari users have `ResizeObserver`.\n    if (window.ResizeObserver) {\n      const observer = new window.ResizeObserver(this.onResize.bind(this));\n      observer.observe(this.contentWrapper);\n    } else {\n      this.scheduleRender();\n      if (!resizeObserverWarningShown) {\n        console.warn(\n          \"You are using an older browser that does not support `ResizeObserver`. Displayed puzzles will not be rescaled.\",\n        );\n        resizeObserverWarningShown = true;\n      }\n    }\n  }\n\n  public setMirror(partner: Twisty3DCanvas): void {\n    this.orbitControls.setMirror(partner.orbitControls);\n    partner.orbitControls.setMirror(this.orbitControls);\n  }\n\n  /** @deprecated */\n  public experimentalSetLatitudeLimits(limits: boolean): void {\n    this.orbitControls.experimentalLatitudeLimits = limits;\n  }\n\n  protected connectedCallback(): void {\n    // Resize as soon as we're in the DOM, to avoid a flash of incorrectly sized content.\n    this.resize();\n    this.render();\n  }\n\n  scheduleRender(): void {\n    this.scheduler.requestAnimFrame();\n  }\n\n  // If the current size/state is incorrect, it may be preferable to hide it\n  // briefly, rather than flashing an incorrect version for one frame.\n  makeInvisibleUntilRender(): void {\n    this.contentWrapper.classList.add(\"invisible\");\n    this.#invisible = true;\n  }\n\n  /** @deprecated */\n  experimentalSetOnRenderFinish(f: null | (() => void)): void {\n    this.#onRenderFinish = f;\n  }\n\n  private render(): void {\n    // Cancel any scheduled frame, since we're rendering right now.\n    // We don't need to re-render until something schedules again.\n    this.stats?.begin();\n    this.scheduler.cancelAnimFrame();\n    if (this.resizePending) {\n      this.resize();\n    }\n\n    if (this.rendererIsShared) {\n      this.renderer.setSize(this.canvas.width, this.canvas.height, false);\n      this.canvas2DContext.clearRect(\n        0,\n        0,\n        this.canvas.width,\n        this.canvas.height,\n      );\n    }\n    if (this.scene) {\n      this.renderer.render(this.scene, this.camera); // TODO\n    }\n    if (this.rendererIsShared) {\n      this.canvas2DContext.drawImage(this.renderer.domElement, 0, 0);\n    }\n\n    if (this.#invisible) {\n      this.contentWrapper.classList.remove(\"invisible\");\n    }\n    this.stats?.end();\n\n    if (this.#onRenderFinish) {\n      this.#onRenderFinish();\n    }\n  }\n\n  private onResize(): void {\n    this.resizePending = true;\n    this.scheduleRender();\n  }\n\n  private resize(): void {\n    this.resizePending = false;\n\n    const w = this.contentWrapper.clientWidth;\n    const h = this.contentWrapper.clientHeight;\n    let off = 0;\n    if (this.legacyExperimentalShift > 0) {\n      off = Math.max(0, Math.floor((w - h) * 0.5));\n    } else if (this.legacyExperimentalShift < 0) {\n      off = -Math.max(0, Math.floor((w - h) * 0.5));\n    }\n    let yoff = 0;\n    let excess = 0;\n    if (h > w) {\n      excess = h - w;\n      yoff = -Math.floor(0.5 * excess);\n    }\n    this.camera.aspect = w / h;\n    this.camera.setViewOffset(w, h - excess, off, yoff, w, h);\n    this.camera.updateProjectionMatrix(); // TODO\n\n    if (this.rendererIsShared) {\n      this.canvas.width = w * pixelRatio();\n      this.canvas.height = h * pixelRatio();\n      this.canvas.style.width = w.toString();\n      this.canvas.style.height = w.toString();\n    } else {\n      this.renderer.setPixelRatio(pixelRatio());\n      this.renderer.setSize(w, h, true);\n    }\n\n    this.scheduleRender();\n  }\n\n  // Square crop is useful for rending icons.\n  renderToDataURL(options: { squareCrop?: boolean } = {}): string {\n    // We don't preserve the drawing buffer, so we have to render again and then immediately read the canvas data.\n    // https://stackoverflow.com/a/30647502\n    this.render();\n\n    // TODO: can we assume that a central crop is similar enough to how a square canvas render would loook?\n    if (!options.squareCrop || this.canvas.width === this.canvas.height) {\n      // TODO: is this such an uncommon path that we can skip it?\n      return this.canvas.toDataURL();\n    } else {\n      const tempCanvas = document.createElement(\"canvas\");\n      const squareSize = Math.min(this.canvas.width, this.canvas.height);\n      tempCanvas.width = squareSize;\n      tempCanvas.height = squareSize;\n      const tempCtx = tempCanvas.getContext(\"2d\")!; // TODO: can we assume this is always availab?E\n      tempCtx.drawImage(\n        this.canvas,\n        -(this.canvas.width - squareSize) / 2,\n        -(this.canvas.height - squareSize) / 2,\n      );\n      return tempCanvas.toDataURL();\n    }\n  }\n}\n\ncustomElementsShim.define(\"twisty-3d-canvas\", Twisty3DCanvas);\n","// Debounces `requestAnimationFrame()`.\nexport class RenderScheduler {\n  private animFrameID: number | null = null;\n  private animFrame = this.animFrameWrapper.bind(this);\n  constructor(private callback: (timestamp: DOMHighResTimeStamp) => void) {}\n  requestAnimFrame(): void {\n    if (!this.animFrameID) {\n      this.animFrameID = requestAnimationFrame(this.animFrame);\n    }\n  }\n\n  cancelAnimFrame(): void {\n    if (this.animFrameID) {\n      cancelAnimationFrame(this.animFrameID);\n      this.animFrameID = 0;\n    }\n  }\n\n  private animFrameWrapper(timestamp: DOMHighResTimeStamp): void {\n    this.animFrameID = 0;\n    this.callback(timestamp);\n  }\n}\n","import {\n  HTMLElementShim,\n  customElementsShim,\n} from \"./node-custom-element-shims\";\n\nexport class CSSSource {\n  constructor(private sourceText: string) {\n    // TODO: Replace with adopted style sheets some day if we can.\n    // const blob = new Blob([sourceText], {\n    //   type: \"text/utf8\",\n    // });\n    // this.url = URL.createObjectURL(blob);\n  }\n\n  getAsString(): string {\n    return this.sourceText;\n  }\n}\n\n// - Wrapped element\n//   - Shadow root\n//     - Content wrapper\nexport class ManagedCustomElement extends HTMLElementShim {\n  public shadow: ShadowRoot;\n  public contentWrapper: HTMLDivElement; // TODO: can we get rid of this wrapper?\n\n  private cssSourceMap: Map<CSSSource, HTMLStyleElement> = new Map();\n  constructor(options?: { mode: \"open\" | \"closed\" }) {\n    super();\n    this.shadow = this.attachShadow({ mode: options?.mode ?? \"closed\" });\n\n    this.contentWrapper = document.createElement(\"div\");\n    this.contentWrapper.classList.add(\"wrapper\");\n    this.shadow.appendChild(this.contentWrapper);\n  }\n\n  // Add the source, if not already added.\n  public addCSS(cssSource: CSSSource): void {\n    if (this.cssSourceMap.get(cssSource)) {\n      return;\n    }\n\n    const cssElem: HTMLStyleElement = document.createElement(\"style\");\n    cssElem.textContent = cssSource.getAsString();\n\n    this.cssSourceMap.set(cssSource, cssElem);\n    this.shadow.appendChild(cssElem);\n  }\n\n  // Remove the source, if it's currently added.\n  public removeCSS(cssSource: CSSSource): void {\n    const cssElem = this.cssSourceMap.get(cssSource);\n    if (!cssElem) {\n      return;\n    }\n    this.shadow.removeChild(cssElem);\n    this.cssSourceMap.delete(cssSource);\n  }\n\n  public addElement<T extends Node>(element: T): T {\n    return this.contentWrapper.appendChild(element);\n  }\n\n  public prependElement<T extends Node>(element: T): void {\n    this.contentWrapper.prepend(element);\n  }\n\n  public removeElement<T extends Node>(element: T): T {\n    return this.contentWrapper.removeChild(element);\n  }\n}\n\ncustomElementsShim.define(\n  \"twisty-managed-custom-element\",\n  ManagedCustomElement,\n);\n","// Workarounds for `node`.\n// TODO: figure out how to remove this.\n\n// This stub does not need to be callable, just constructable to satisfy the `node` loader.\nclass HTMLElementStub {}\n\nlet HTMLElementShim: typeof HTMLElement;\nif (typeof HTMLElement !== \"undefined\") {\n  HTMLElementShim = HTMLElement;\n} else {\n  HTMLElementShim = HTMLElementStub as any;\n}\n\nexport { HTMLElementShim };\n\nclass CustomElementsStub {\n  define(): void {\n    // nothing\n  }\n}\n\nlet customElementsShim: typeof customElements;\n\nif (typeof customElements !== \"undefined\") {\n  customElementsShim = customElements;\n} else {\n  customElementsShim = new CustomElementsStub() as any;\n}\n\nexport { customElementsShim };\n","// TODO: Handle if you move across screens?\nexport function pixelRatio(): number {\n  return devicePixelRatio || 1;\n}\n","import { CSSSource } from \"../element/ManagedCustomElement\";\n\n// The `position` values are a hack for a bug in Safari where the canvas either\n// grows infinitely, or takes up the full `fr` of any encompassing grid (making\n// the contents of that element e.g. over 100% of its height). `contain:\n// content` is a good fix for this, but there is no indication that Safari will\n// support it soon. https://developer.mozilla.org/en-US/docs/Web/CSS/contain\n\nexport const twisty3DCanvasCSS = new CSSSource(`\n:host {\n  width: 384px;\n  height: 256px;\n  display: grid;\n}\n\n.wrapper {\n  width: 100%;\n  height: 100%;\n  display: grid;\n  overflow: hidden;\n}\n\n/* TODO: This is due to stats hack. Replace with \\`canvas\\`. */\n.wrapper > canvas {\n  max-width: 100%;\n  max-height: 100%;\n}\n\n.wrapper.invisible {\n  opacity: 0;\n}\n`);\n","import { Camera, Spherical, Vector3 } from \"three\";\nimport { RenderScheduler } from \"../../animation/RenderScheduler\";\n\n// Buffer at the end values of the latitude (phi), to prevent gymbal lock.\n// Without this, the puzzle would flip every frame if you try to push past the\n// end, or snap to a standard longitude (theta).\nconst EPSILON = 0.00000001;\n\nconst INERTIA_DEFAULT: boolean = true;\nconst LATITUDE_LIMITS_DEFAULT: boolean = true;\n\nconst INERTIA_DURATION_MS = 500;\n// If the first inertial render is this long after the last move, we assume the\n// user has halted the cursor and we consider inertia to have \"timed out\". We\n// never begin animating the inertia.\nconst INERTIA_TIMEOUT_MS = 50;\n\nconst VERTICAL_MOVEMENT_BASE_SCALE = 0.75;\n\n// progress is from 0 to 1.\nfunction momentumScale(progress: number) {\n  // This is the exponential curve flipped so that\n  // - The slope at progress = 0 is 1 (this corresponds to \"x = 1\" on the normal\n  //   curve).\n  // - The scale exponentially \"decays\" until progress = 1.\n  // This means the scale at the end will be about 0.418\n  return (Math.exp(1 - progress) - (1 - progress)) / (1 - Math.E) + 1;\n}\n\nclass Inertia {\n  private scheduler = new RenderScheduler(this.render.bind(this));\n  private lastTimestamp: number;\n  constructor(\n    private startTimestamp: number,\n    private momentumX: number,\n    private momentumY: number,\n    private callback: (movementX: number, movementY: number) => void,\n  ) {\n    this.scheduler.requestAnimFrame();\n    this.lastTimestamp = startTimestamp;\n  }\n\n  private render(now: DOMHighResTimeStamp) {\n    const progressBefore =\n      (this.lastTimestamp - this.startTimestamp) / INERTIA_DURATION_MS;\n    const progressAfter = Math.min(\n      1,\n      (now - this.startTimestamp) / INERTIA_DURATION_MS,\n    );\n\n    if (\n      progressBefore === 0 &&\n      progressAfter > INERTIA_TIMEOUT_MS / INERTIA_DURATION_MS\n    ) {\n      // The user has already paused for a while. Don't start any inertia.\n      return;\n    }\n\n    const delta = momentumScale(progressAfter) - momentumScale(progressBefore);\n\n    // TODO: For now, we only carry horizontal momentum. If this should stay, we\n    // can remove the plumbing for the Y dimension.\n    this.callback(this.momentumX * delta * 1000, this.momentumY * delta * 1000);\n\n    if (progressAfter < 1) {\n      this.scheduler.requestAnimFrame();\n    }\n    this.lastTimestamp = now;\n  }\n}\n\n// TODO: change mouse cursor while moving.\nexport class TwistyOrbitControls {\n  /** @deprecated */\n  experimentalInertia: boolean = INERTIA_DEFAULT;\n  /** @deprecated */\n  experimentalLatitudeLimits: boolean = LATITUDE_LIMITS_DEFAULT;\n  private mirrorControls?: TwistyOrbitControls;\n  private lastTouchClientX: number = 0;\n  private lastTouchClientY: number = 0;\n  private currentTouchID: number | null = null; // TODO: support multiple touches?\n  private onMoveBound = this.onMove.bind(this);\n  private onMouseMoveBound = this.onMouseMove.bind(this);\n  private onMouseEndBound = this.onMouseEnd.bind(this);\n  private onTouchMoveBound = this.onTouchMove.bind(this);\n  private onTouchEndBound = this.onTouchEnd.bind(this);\n  // Variable for temporary use, to prevent reallocation.\n  private tempSpherical: Spherical = new Spherical();\n  private lastTouchTimestamp: number = 0;\n  private lastTouchMoveMomentumX: number = 0;\n  private lastTouchMoveMomentumY: number = 0;\n  private lastMouseTimestamp: number = 0;\n  private lastMouseMoveMomentumX: number = 0;\n  private lastMouseMoveMomentumY: number = 0;\n  public experimentalHasBeenMoved: boolean = false;\n  constructor(\n    private camera: Camera,\n    private canvas: HTMLCanvasElement,\n    private scheduleRender: () => void,\n  ) {\n    canvas.addEventListener(\"mousedown\", this.onMouseStart.bind(this));\n    canvas.addEventListener(\"touchstart\", this.onTouchStart.bind(this));\n  }\n\n  // f is the fraction of the canvas traversed per ms.\n  temperMovement(f: number): number {\n    // This is scaled to be linear for small values, but to reduce large values\n    // by a significant factor.\n    return (Math.sign(f) * Math.log(Math.abs(f * 10) + 1)) / 6;\n  }\n\n  onMouseStart(e: MouseEvent): void {\n    window.addEventListener(\"mousemove\", this.onMouseMoveBound);\n    window.addEventListener(\"mouseup\", this.onMouseEndBound);\n    this.onStart(e);\n\n    this.lastMouseTimestamp = e.timeStamp;\n  }\n\n  onMouseMove(e: MouseEvent): void {\n    if (e.buttons === 0) {\n      // Certain elements (e.g. disabled buttons) can capture the `mouseup`\n      // event. So if we notice that there are no mouse buttons pressed, we stop\n      // the movement.\n      this.onMouseEnd(e);\n      return;\n    }\n    const minDim = Math.min(this.canvas.offsetWidth, this.canvas.offsetHeight);\n    const movementX = this.temperMovement(e.movementX / minDim);\n    const movementY = this.temperMovement(\n      (e.movementY / minDim) * VERTICAL_MOVEMENT_BASE_SCALE,\n    );\n    this.onMove(movementX, movementY);\n\n    this.lastMouseMoveMomentumX =\n      movementX / (e.timeStamp - this.lastMouseTimestamp);\n    this.lastMouseMoveMomentumY =\n      movementY / (e.timeStamp - this.lastMouseTimestamp);\n    this.lastMouseTimestamp = e.timeStamp;\n  }\n\n  onMouseEnd(e: MouseEvent): void {\n    window.removeEventListener(\"mousemove\", this.onMouseMoveBound);\n    window.removeEventListener(\"mouseup\", this.onMouseEndBound);\n    this.onEnd(e);\n\n    if (this.experimentalInertia) {\n      new Inertia(\n        this.lastMouseTimestamp,\n        this.lastMouseMoveMomentumX,\n        this.lastMouseMoveMomentumY,\n        this.onMoveBound,\n      );\n    }\n  }\n\n  onTouchStart(e: TouchEvent): void {\n    if (this.currentTouchID === null) {\n      this.currentTouchID = e.changedTouches[0].identifier;\n      this.lastTouchClientX = e.touches[0].clientX;\n      this.lastTouchClientY = e.touches[0].clientY;\n      window.addEventListener(\"touchmove\", this.onTouchMoveBound);\n      window.addEventListener(\"touchend\", this.onTouchEndBound);\n      window.addEventListener(\"touchcanel\", this.onTouchEndBound);\n      this.onStart(e);\n\n      this.lastTouchTimestamp = e.timeStamp;\n    }\n  }\n\n  onTouchMove(e: TouchEvent): void {\n    for (let i = 0; i < e.changedTouches.length; i++) {\n      const touch = e.changedTouches[i];\n      if (touch.identifier === this.currentTouchID) {\n        const minDim = Math.min(\n          this.canvas.offsetWidth,\n          this.canvas.offsetHeight,\n        );\n        const movementX = this.temperMovement(\n          (touch.clientX - this.lastTouchClientX) / minDim,\n        );\n        const movementY = this.temperMovement(\n          ((touch.clientY - this.lastTouchClientY) / minDim) *\n            VERTICAL_MOVEMENT_BASE_SCALE,\n        );\n        this.onMove(movementX, movementY);\n        this.lastTouchClientX = touch.clientX;\n        this.lastTouchClientY = touch.clientY;\n\n        this.lastTouchMoveMomentumX =\n          movementX / (e.timeStamp - this.lastTouchTimestamp);\n        this.lastTouchMoveMomentumY =\n          movementY / (e.timeStamp - this.lastTouchTimestamp);\n        this.lastTouchTimestamp = e.timeStamp;\n      }\n    }\n  }\n\n  onTouchEnd(e: TouchEvent): void {\n    for (let i = 0; i < e.changedTouches.length; i++) {\n      const touch = e.changedTouches[i];\n      if (touch.identifier === this.currentTouchID) {\n        this.currentTouchID = null;\n        window.removeEventListener(\"touchmove\", this.onTouchMoveBound);\n        window.removeEventListener(\"touchend\", this.onTouchEndBound);\n        window.removeEventListener(\"touchcancel\", this.onTouchEndBound);\n        this.onEnd(e);\n      }\n    }\n\n    if (this.experimentalInertia) {\n      new Inertia(\n        this.lastTouchTimestamp,\n        this.lastTouchMoveMomentumX,\n        this.lastTouchMoveMomentumY,\n        this.onMoveBound,\n      );\n    }\n  }\n\n  onStart(e: MouseEvent | TouchEvent): void {\n    e.preventDefault();\n  }\n\n  onMove(movementX: number, movementY: number): void {\n    // TODO: optimize, e.g. by caching or using the spherical coordinates\n    // directly if they are still fresh.\n    this.tempSpherical.setFromVector3(this.camera.position);\n\n    this.tempSpherical.theta += -2 * movementX;\n    this.tempSpherical.phi += -2 * movementY;\n    if (this.experimentalLatitudeLimits) {\n      this.tempSpherical.phi = Math.max(this.tempSpherical.phi, Math.PI * 0.3);\n      this.tempSpherical.phi = Math.min(this.tempSpherical.phi, Math.PI * 0.7);\n    } else {\n      this.tempSpherical.phi = Math.max(this.tempSpherical.phi, EPSILON);\n      this.tempSpherical.phi = Math.min(\n        this.tempSpherical.phi,\n        Math.PI - EPSILON,\n      );\n    }\n\n    this.camera.position.setFromSpherical(this.tempSpherical);\n    this.camera.lookAt(new Vector3(0, 0, 0));\n    this.experimentalHasBeenMoved = true;\n\n    this.scheduleRender();\n    this.mirrorControls?.updateMirroredCamera(this.camera);\n    // We would take the event in the arguments, and try to call\n    // `preventDefault()` on it, but Chrome logs an error event if we try to\n    // catch it, because it enforces a passive listener.\n  }\n\n  onEnd(e: MouseEvent | TouchEvent): void {\n    e.preventDefault();\n  }\n\n  public setMirror(m: TwistyOrbitControls): void {\n    this.mirrorControls = m;\n  }\n\n  updateMirroredCamera(c: Camera): void {\n    this.camera.position.copy(c.position);\n    this.camera.position.multiplyScalar(-1);\n    this.camera.lookAt(new Vector3(0, 0, 0));\n    this.scheduleRender();\n  }\n}\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nvar Stats = function () {\n  var mode = 0;\n\n  var container = document.createElement(\"div\");\n  container.style.cssText =\n    \"position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000\";\n  container.addEventListener(\n    \"click\",\n    function (event) {\n      event.preventDefault();\n      showPanel(++mode % container.children.length);\n    },\n    false,\n  );\n\n  //\n\n  function addPanel(panel) {\n    container.appendChild(panel.dom);\n    return panel;\n  }\n\n  function showPanel(id) {\n    for (var i = 0; i < container.children.length; i++) {\n      container.children[i].style.display = i === id ? \"block\" : \"none\";\n    }\n\n    mode = id;\n  }\n\n  //\n\n  var beginTime = (performance || Date).now(),\n    prevTime = beginTime,\n    frames = 0;\n\n  var fpsPanel = addPanel(new Stats.Panel(\"FPS\", \"#0ff\", \"#002\"));\n  var msPanel = addPanel(new Stats.Panel(\"MS\", \"#0f0\", \"#020\"));\n\n  if (self.performance && self.performance.memory) {\n    var memPanel = addPanel(new Stats.Panel(\"MB\", \"#f08\", \"#201\"));\n  }\n\n  showPanel(0);\n\n  return {\n    REVISION: 16,\n\n    dom: container,\n\n    addPanel: addPanel,\n    showPanel: showPanel,\n\n    begin: function () {\n      beginTime = (performance || Date).now();\n    },\n\n    end: function () {\n      frames++;\n\n      var time = (performance || Date).now();\n\n      msPanel.update(time - beginTime, 200);\n\n      if (time >= prevTime + 1000) {\n        fpsPanel.update((frames * 1000) / (time - prevTime), 100);\n\n        prevTime = time;\n        frames = 0;\n\n        if (memPanel) {\n          var memory = performance.memory;\n          memPanel.update(\n            memory.usedJSHeapSize / 1048576,\n            memory.jsHeapSizeLimit / 1048576,\n          );\n        }\n      }\n\n      return time;\n    },\n\n    update: function () {\n      beginTime = this.end();\n    },\n\n    // Backwards Compatibility\n\n    domElement: container,\n    setMode: showPanel,\n  };\n};\n\nStats.Panel = function (name, fg, bg) {\n  var min = Infinity,\n    max = 0,\n    round = Math.round;\n  var PR = round(window.devicePixelRatio || 1);\n\n  var WIDTH = 80 * PR,\n    HEIGHT = 48 * PR,\n    TEXT_X = 3 * PR,\n    TEXT_Y = 2 * PR,\n    GRAPH_X = 3 * PR,\n    GRAPH_Y = 15 * PR,\n    GRAPH_WIDTH = 74 * PR,\n    GRAPH_HEIGHT = 30 * PR;\n\n  var canvas = document.createElement(\"canvas\");\n  canvas.width = WIDTH;\n  canvas.height = HEIGHT;\n  canvas.style.cssText = \"width:80px;height:48px\";\n\n  var context = canvas.getContext(\"2d\");\n  context.font = \"bold \" + 9 * PR + \"px Helvetica,Arial,sans-serif\";\n  context.textBaseline = \"top\";\n\n  context.fillStyle = bg;\n  context.fillRect(0, 0, WIDTH, HEIGHT);\n\n  context.fillStyle = fg;\n  context.fillText(name, TEXT_X, TEXT_Y);\n  context.fillRect(GRAPH_X, GRAPH_Y, GRAPH_WIDTH, GRAPH_HEIGHT);\n\n  context.fillStyle = bg;\n  context.globalAlpha = 0.9;\n  context.fillRect(GRAPH_X, GRAPH_Y, GRAPH_WIDTH, GRAPH_HEIGHT);\n\n  return {\n    dom: canvas,\n\n    update: function (value, maxValue) {\n      min = Math.min(min, value);\n      max = Math.max(max, value);\n\n      context.fillStyle = bg;\n      context.globalAlpha = 1;\n      context.fillRect(0, 0, WIDTH, GRAPH_Y);\n      context.fillStyle = fg;\n      context.fillText(\n        round(value) + \" \" + name + \" (\" + round(min) + \"-\" + round(max) + \")\",\n        TEXT_X,\n        TEXT_Y,\n      );\n\n      context.drawImage(\n        canvas,\n        GRAPH_X + PR,\n        GRAPH_Y,\n        GRAPH_WIDTH - PR,\n        GRAPH_HEIGHT,\n        GRAPH_X,\n        GRAPH_Y,\n        GRAPH_WIDTH - PR,\n        GRAPH_HEIGHT,\n      );\n\n      context.fillRect(GRAPH_X + GRAPH_WIDTH - PR, GRAPH_Y, PR, GRAPH_HEIGHT);\n\n      context.fillStyle = bg;\n      context.globalAlpha = 0.9;\n      context.fillRect(\n        GRAPH_X + GRAPH_WIDTH - PR,\n        GRAPH_Y,\n        PR,\n        round((1 - value / maxValue) * GRAPH_HEIGHT),\n      );\n    },\n  };\n};\n\n// This has been changed from `export default` because otherwise `npx jest`\n// trips up on it.\nmodule.exports = Stats;\n","// Note: this folder is purposely not built as a package entry point (yet).\n\nexport { countMoves } from \"./CountMoves\";\nexport { countAnimatedMoves } from \"./CountAnimatedMoves\";\n","// TODO: move this file somewhere permanent.\nimport {\n  Alg,\n  Grouping,\n  LineComment,\n  Commutator,\n  Conjugate,\n  Move,\n  Newline,\n  Pause,\n  TraversalUp,\n} from \"../alg\";\n\n/*\n *   For movecount, that understands puzzle rotations.  This code\n *   should be moved to the alg class, probably.\n */\nclass CountMoves extends TraversalUp<number> {\n  constructor(private metric: (move: Move) => number) {\n    super();\n  }\n\n  public traverseAlg(alg: Alg): number {\n    let r = 0;\n    for (const unit of alg.units()) {\n      r += this.traverseUnit(unit);\n    }\n    return r;\n  }\n\n  public traverseGrouping(grouping: Grouping): number {\n    // const unit: Unit = Alg.fromString(\"SDf\");\n    // console.log(unit);\n    const alg: Alg = grouping.experimentalAlg;\n    return (\n      this.traverseAlg(alg) * Math.abs(grouping.experimentalEffectiveAmount)\n    );\n  }\n\n  public traverseMove(move: Move): number {\n    return this.metric(move);\n  }\n\n  public traverseCommutator(commutator: Commutator): number {\n    return (\n      Math.abs(commutator.experimentalEffectiveAmount) *\n      2 *\n      (this.traverseAlg(commutator.A) + this.traverseAlg(commutator.B))\n    );\n  }\n\n  public traverseConjugate(conjugate: Conjugate): number {\n    return (\n      Math.abs(conjugate.experimentalEffectiveAmount) *\n      (2 * this.traverseAlg(conjugate.A) + this.traverseAlg(conjugate.B))\n    );\n  }\n\n  // TODO: Remove spaces between repeated pauses (in traverseSequence)\n  public traversePause(_pause: Pause): number {\n    return 0;\n  }\n\n  public traverseNewline(_newLine: Newline): number {\n    return 0;\n  }\n\n  // TODO: Enforce being followed by a newline (or the end of the alg)?\n  public traverseLineComment(_comment: LineComment): number {\n    return 0;\n  }\n}\n\nfunction isCharUppercase(c: string): boolean {\n  return \"A\" <= c && c <= \"Z\";\n}\n\n// TODO: Implement a puzzle-specific way to calculate this.\nfunction baseMetric(move: Move): number {\n  const fam = move.family;\n  if (\n    (isCharUppercase(fam[0]) && fam[fam.length - 1] === \"v\") ||\n    fam === \"x\" ||\n    fam === \"y\" ||\n    fam === \"z\" ||\n    fam === \"T\"\n  ) {\n    return 0;\n  } else {\n    return 1;\n  }\n}\n\nconst countMovesInstance = new CountMoves(baseMetric);\nexport const countMoves: (\n  alg: Alg,\n) => number = countMovesInstance.traverseAlg.bind(countMovesInstance);\n","import {\n  Alg,\n  Commutator,\n  Conjugate,\n  Grouping,\n  LineComment,\n  Move,\n  Newline,\n  Pause,\n  TraversalUp,\n} from \"../alg\";\n\n// TODO: Include Pause, include amounts\nclass CountAnimatedMoves extends TraversalUp<number, number> {\n  public traverseAlg(alg: Alg): number {\n    let total = 0;\n    for (const part of alg.units()) {\n      total += this.traverseUnit(part);\n    }\n    return total;\n  }\n\n  public traverseGrouping(grouping: Grouping): number {\n    return (\n      this.traverseAlg(grouping.experimentalAlg) *\n      Math.abs(grouping.experimentalEffectiveAmount)\n    );\n  }\n\n  public traverseMove(_move: Move): number {\n    return 1;\n  }\n\n  public traverseCommutator(commutator: Commutator): number {\n    return (\n      2 * (this.traverseAlg(commutator.A) + this.traverseAlg(commutator.B))\n    );\n  }\n\n  public traverseConjugate(conjugate: Conjugate): number {\n    return 2 * this.traverseAlg(conjugate.A) + this.traverseAlg(conjugate.B);\n  }\n\n  public traversePause(_pause: Pause): number {\n    return 0;\n  }\n\n  public traverseNewline(_newline: Newline): number {\n    return 0;\n  }\n\n  public traverseLineComment(_comment: LineComment): number {\n    return 0;\n  }\n}\n\nconst countAnimatedMovesInstance = new CountAnimatedMoves();\nexport const countAnimatedMoves: (\n  alg: Alg,\n) => number = countAnimatedMovesInstance.traverseAlg.bind(\n  countAnimatedMovesInstance,\n);\n","import { Vector3 } from \"three\";\nimport { Alg } from \"../../alg\";\nimport {\n  AlgAttribute,\n  StringEnumAttribute,\n  Vector3Attribute,\n} from \"./element/ElementConfig\";\nimport type { TwistyPlayer } from \"./TwistyPlayer\";\nimport { BackViewLayout, backViewLayouts } from \"./viewers/TwistyViewerWrapper\";\n\nconst DEFAULT_CAMERA_Z = 5;\n// Golden ratio is perfect for FTO and Megaminx.\nconst DEFAULT_CAMERA_Y = DEFAULT_CAMERA_Z * (2 / (1 + Math.sqrt(5)));\n\nexport const centeredCameraPosition = new Vector3(\n  0,\n  DEFAULT_CAMERA_Y,\n  DEFAULT_CAMERA_Z,\n);\n\n// TODO\nexport const cubeCameraPosition = new Vector3(3, 4, 5);\n\n// TODO: turn these maps into lists?\nexport const setupToLocations = {\n  start: true, // default // TODO: \"beginning\"\n  end: true,\n};\nexport type SetupToLocation = keyof typeof setupToLocations;\n\n// TODO: turn these maps into lists?\nexport const visualizationFormats = {\n  \"3D\": true, // default\n  \"2D\": true,\n  \"experimental-2D-LL\": true, // TODO\n  \"PG3D\": true,\n};\nexport type VisualizationFormat = keyof typeof visualizationFormats;\n\nexport const backgroundThemes = {\n  checkered: true, // default\n  none: true,\n};\nexport type BackgroundTheme = keyof typeof backgroundThemes;\n\n// TODO: turn these maps into lists?\nexport const hintFaceletStyles = {\n  floating: true, // default\n  none: true,\n};\nexport type HintFaceletStyle = keyof typeof hintFaceletStyles;\n\n// TODO: turn these maps into lists?\n// TODO: alg.cubing.net parity\nexport const experimentalStickerings = {\n  \"full\": true, // default\n  \"centers-only\": true, // TODO\n  \"PLL\": true,\n  \"CLS\": true,\n  \"OLL\": true,\n  \"COLL\": true,\n  \"OCLL\": true,\n  \"CLL\": true,\n  \"ELL\": true,\n  \"ELS\": true,\n  \"LL\": true,\n  \"F2L\": true,\n  \"ZBLL\": true,\n  \"ZBLS\": true,\n  \"WVLS\": true,\n  \"VLS\": true,\n  \"LS\": true,\n  \"EO\": true,\n  \"CMLL\": true,\n  \"L6E\": true,\n  \"L6EO\": true,\n  \"Daisy\": true,\n  \"Cross\": true,\n  \"2x2x2\": true,\n  \"2x2x3\": true,\n  \"Void Cube\": true,\n  \"invisible\": true,\n  \"picture\": true,\n  \"experimental-centers-U\": true,\n  \"experimental-centers-U-D\": true,\n  \"experimental-centers-U-L-D\": true,\n  \"experimental-centers-U-L-B-D\": true,\n  \"experimental-centers\": true,\n  \"experimental-fto-fc\": true,\n  \"experimental-fto-f2t\": true,\n  \"experimental-fto-sc\": true,\n  \"experimental-fto-l2c\": true,\n  \"experimental-fto-lbt\": true,\n};\nexport type ExperimentalStickering = keyof typeof experimentalStickerings;\n\nexport const controlsLocations = {\n  \"bottom-row\": true, // default\n  \"none\": true,\n};\nexport type ControlsLocation = keyof typeof controlsLocations;\n\nexport const puzzleIDs = {\n  \"3x3x3\": true, // default\n  \"custom\": true,\n  \"2x2x2\": true,\n  \"4x4x4\": true,\n  \"5x5x5\": true,\n  \"6x6x6\": true,\n  \"7x7x7\": true,\n  \"40x40x40\": true,\n  \"megaminx\": true,\n  \"pyraminx\": true,\n  \"square1\": true,\n  \"clock\": true,\n  \"skewb\": true,\n  \"fto\": true,\n  \"gigaminx\": true,\n};\nexport type PuzzleID = keyof typeof puzzleIDs;\n\nexport const viewerLinkPages = {\n  twizzle: true, // default\n  none: true,\n};\nexport type ViewerLinkPage = keyof typeof viewerLinkPages;\n\n// TODO: templatize\nexport interface ManagedAttribute<K> {\n  string: string;\n  value: K;\n  setString(s: string): boolean;\n  setValue(v: K): boolean;\n}\n\ntype AnyManagedAttribute = ManagedAttribute<any>;\n\ninterface TwistyPlayerAttributes extends Record<string, AnyManagedAttribute> {\n  // Alg\n  \"alg\": AlgAttribute;\n  \"experimental-setup-alg\": AlgAttribute;\n  \"experimental-setup-anchor\": StringEnumAttribute<SetupToLocation>;\n\n  // Puzzle\n  \"puzzle\": StringEnumAttribute<PuzzleID>;\n  \"visualization\": StringEnumAttribute<VisualizationFormat>;\n  \"hint-facelets\": StringEnumAttribute<HintFaceletStyle>;\n  \"experimental-stickering\": StringEnumAttribute<ExperimentalStickering>;\n\n  // Background\n  \"background\": StringEnumAttribute<BackgroundTheme>;\n  \"control-panel\": StringEnumAttribute<ControlsLocation>;\n\n  // 3D config\n  \"back-view\": StringEnumAttribute<BackViewLayout>;\n  \"experimental-camera-position\": Vector3Attribute;\n\n  // Interaction\n  \"viewer-link\": StringEnumAttribute<ViewerLinkPage>;\n}\n\nexport interface TwistyPlayerConfigValues {\n  alg: Alg | string;\n  experimentalSetupAlg: Alg | string;\n  experimentalSetupAnchor: SetupToLocation;\n\n  puzzle: PuzzleID;\n  visualization: VisualizationFormat;\n  hintFacelets: HintFaceletStyle;\n  experimentalStickering: ExperimentalStickering;\n\n  background: BackgroundTheme;\n  controlPanel: ControlsLocation;\n\n  backView: BackViewLayout;\n  experimentalCameraPosition: Vector3;\n\n  viewerLink: ViewerLinkPage;\n}\n\nexport type TwistyPlayerInitialConfig = Partial<TwistyPlayerConfigValues>;\n\nconst twistyPlayerAttributeMap: Record<\n  keyof TwistyPlayerAttributes,\n  keyof TwistyPlayerConfigValues\n> = {\n  \"alg\": \"alg\",\n  \"experimental-setup-alg\": \"experimentalSetupAlg\",\n  \"experimental-setup-anchor\": \"experimentalSetupAnchor\",\n\n  \"puzzle\": \"puzzle\",\n  \"visualization\": \"visualization\",\n  \"hint-facelets\": \"hintFacelets\",\n  \"experimental-stickering\": \"experimentalStickering\",\n\n  \"background\": \"background\",\n  \"control-panel\": \"controlPanel\",\n\n  \"back-view\": \"backView\",\n  \"experimental-camera-position\": \"experimentalCameraPosition\",\n\n  \"viewer-link\": \"viewerLink\",\n};\n\n// TODO: Can we avoid instantiating a new class for each attribute, and would it help performance?\nexport class TwistyPlayerConfig {\n  attributes: TwistyPlayerAttributes;\n  constructor(\n    private twistyPlayer: TwistyPlayer, // TODO\n    initialValues: TwistyPlayerInitialConfig,\n  ) {\n    this.attributes = {\n      \"alg\": new AlgAttribute(initialValues.alg),\n      \"experimental-setup-alg\": new AlgAttribute(\n        initialValues.experimentalSetupAlg,\n      ),\n      \"experimental-setup-anchor\": new StringEnumAttribute(\n        setupToLocations,\n        initialValues.experimentalSetupAnchor,\n      ),\n\n      \"puzzle\": new StringEnumAttribute(puzzleIDs, initialValues.puzzle),\n      \"visualization\": new StringEnumAttribute(\n        visualizationFormats,\n        initialValues.visualization,\n      ),\n      \"hint-facelets\": new StringEnumAttribute(\n        hintFaceletStyles,\n        initialValues.hintFacelets,\n      ),\n      \"experimental-stickering\": new StringEnumAttribute(\n        experimentalStickerings,\n        initialValues.experimentalStickering,\n      ),\n\n      \"background\": new StringEnumAttribute(\n        backgroundThemes,\n        initialValues.background,\n      ),\n      \"control-panel\": new StringEnumAttribute(\n        controlsLocations,\n        initialValues.controlPanel,\n      ),\n      \"back-view\": new StringEnumAttribute(\n        backViewLayouts,\n        initialValues[\"backView\"],\n      ),\n      \"experimental-camera-position\": new Vector3Attribute(\n        null,\n        initialValues[\"experimentalCameraPosition\"],\n      ),\n      \"viewer-link\": new StringEnumAttribute(\n        viewerLinkPages,\n        initialValues.viewerLink,\n      ),\n    };\n  }\n\n  static get observedAttributes(): (keyof TwistyPlayerAttributes & string)[] {\n    return Object.keys(twistyPlayerAttributeMap);\n  }\n\n  attributeChangedCallback(\n    attributeName: string,\n    oldValue: string,\n    newValue: string,\n  ): void {\n    const managedAttribute = this.attributes[attributeName];\n    if (managedAttribute) {\n      // TODO: Handle `null` better.\n      if (oldValue !== null && managedAttribute.string !== oldValue) {\n        console.warn(\n          \"Attribute out of sync!\",\n          attributeName,\n          managedAttribute.string,\n          oldValue,\n        );\n      }\n      managedAttribute.setString(newValue);\n\n      // TODO: can we make this type-safe?\n      // TODO: avoid double-setting in recursive calls\n      const propertyName: keyof TwistyPlayerConfigValues =\n        twistyPlayerAttributeMap[attributeName];\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      this.twistyPlayer[propertyName] = managedAttribute.value;\n    }\n  }\n}\n","// // type ConfigAttributes = Record<string, any>;\n\nimport { Vector3 } from \"three\";\nimport { Alg } from \"../../../alg\";\n\nexport class AlgAttribute {\n  string: string;\n  value: Alg;\n  constructor(initialValue?: Alg | string) {\n    if (initialValue) {\n      if (typeof initialValue === \"string\") {\n        this.setString(initialValue);\n      } else {\n        this.setValue(initialValue);\n      }\n    } else {\n      this.setValue(this.defaultValue());\n    }\n  }\n\n  // Return value indicates if the attribute changed.\n  setString(str: string): boolean {\n    if (this.string === str) {\n      return false;\n    }\n    this.string = str;\n    this.value = this.toValue(str);\n    return true;\n  }\n\n  // Return value indicates if the attribute changed.\n  setValue(val: Alg): boolean {\n    const str = this.toString(val);\n    if (this.string === str) {\n      return false;\n    }\n    this.string = str;\n    this.value = val;\n    return true;\n  }\n\n  private defaultValue(): Alg {\n    return new Alg([]);\n  }\n\n  private toValue(s: string): Alg {\n    return Alg.fromString(s);\n  }\n\n  private toString(val: Alg): string {\n    return val.toString();\n  }\n}\n\n// TODO: subset of string rather than `extends`\nexport class StringEnumAttribute<E extends string> {\n  string: string;\n  value: E;\n  valid: boolean;\n  constructor(private enumVal: { [key: string]: boolean }, initialValue?: E) {\n    this.setString(initialValue ?? this.defaultValue());\n  }\n\n  // Return value indicates if the attribute changed.\n  setString(str: string): boolean {\n    if (this.string === str) {\n      return false;\n    }\n    if (!(str in this.enumVal)) {\n      throw new Error(`Invalid string for attribute!: ${str}`);\n    }\n    this.string = str;\n    this.value = this.toValue(str);\n    return true;\n  }\n\n  // Return value indicates if the attribute changed.\n  setValue(val: string): boolean {\n    return this.setString(val);\n  }\n\n  private defaultValue(): string {\n    return Object.keys(this.enumVal)[0]; // TODO\n  }\n\n  private toValue(s: string): E {\n    return s as E;\n  }\n\n  // private toString(s: string): string {\n  //   return s;\n  // }\n}\n\n// TODO: subset of string rather than `extends`\nexport class StringFakeEnumAttribute<E extends string> {\n  string: string;\n  value: E;\n  valid: boolean;\n  constructor(private validStrings: string[], initialValue?: E) {\n    this.setString(initialValue ?? this.defaultValue());\n  }\n\n  // Return value indicates if the attribute changed.\n  setString(str: string): boolean {\n    if (this.string === str) {\n      return false;\n    }\n    if (!this.validStrings.includes(str)) {\n      throw new Error(`Invalid string for attribute!: ${str}`);\n    }\n    this.string = str;\n    this.value = this.toValue(str);\n    return true;\n  }\n\n  // Return value indicates if the attribute changed.\n  setValue(val: string): boolean {\n    return this.setString(val);\n  }\n\n  private defaultValue(): string {\n    return this.validStrings[0];\n  }\n\n  private toValue(s: string): E {\n    return s as E;\n  }\n\n  // private toString(s: string): string {\n  //   return s;\n  // }\n}\n\nexport class Vector3Attribute {\n  string: string;\n  value: Vector3 | null;\n  #defaultValue: Vector3 | null;\n  constructor(defaultValue: Vector3 | null, initialValue?: Vector3 | null) {\n    this.#defaultValue = defaultValue;\n    this.setValue(initialValue ?? this.defaultValue());\n  }\n\n  // Return value indicates if the attribute changed.\n  setString(str: string): boolean {\n    return this.setValue(str === \"\" ? null : this.toValue(str)); // TODO: test empty string\n  }\n\n  // Return value indicates if the attribute changed.\n  setValue(val: Vector3 | null): boolean {\n    const str = this.toString(val);\n    if (this.string === str) {\n      return false;\n    }\n    this.string = str;\n    this.value = val;\n    return true;\n  }\n\n  private defaultValue(): Vector3 | null {\n    return this.#defaultValue;\n  }\n\n  private toValue(s: string): Vector3 | null {\n    if (!s.startsWith(\"[\")) {\n      throw new Error(\"TODO\");\n    }\n    if (!s.endsWith(\"]\")) {\n      throw new Error(\"TODO\");\n    }\n    const coords = s.slice(1, s.length - 1).split(\",\");\n    if (coords.length !== 3) {\n      throw new Error(\"TODO\");\n    }\n    const [x, y, z] = coords.map((c) => parseInt(c, 10));\n    return new Vector3(x, y, z);\n  }\n\n  private toString(v: Vector3 | null): string {\n    return v ? `[${v.x}, ${v.y}, ${v.z}]` : \"\"; // TODO: empty string is not null\n  }\n}\n","import { ClassListManager } from \"../element/ClassListManager\";\nimport { ManagedCustomElement } from \"../element/ManagedCustomElement\";\nimport { customElementsShim } from \"../element/node-custom-element-shims\";\nimport { twistyViewerWrapperCSS } from \"./TwistyViewerWrapper.css\";\n\nexport const backViewLayouts = {\n  \"none\": true, // default\n  \"side-by-side\": true,\n  \"top-right\": true,\n};\nexport type BackViewLayout = keyof typeof backViewLayouts;\n\nexport interface TwistyViewerWrapperConfig {\n  backView?: BackViewLayout;\n}\n\nexport class TwistyViewerWrapper extends ManagedCustomElement {\n  #backViewClassListManager: ClassListManager<BackViewLayout> = new ClassListManager(\n    this,\n    \"back-view-\",\n    [\"none\", \"side-by-side\", \"top-right\"],\n  );\n\n  constructor(config: TwistyViewerWrapperConfig = {}) {\n    super();\n    this.addCSS(twistyViewerWrapperCSS);\n\n    if (config.backView && config.backView in backViewLayouts) {\n      this.#backViewClassListManager.setValue(config.backView);\n    }\n  }\n\n  // Returns if the value changed\n  /** @deprecated */\n  setBackView(backView: BackViewLayout): boolean {\n    return this.#backViewClassListManager.setValue(backView);\n  }\n\n  clear(): void {\n    this.contentWrapper.innerHTML = \"\";\n  }\n}\n\ncustomElementsShim.define(\"twisty-viewer-wrapper\", TwistyViewerWrapper);\n","import { ManagedCustomElement } from \"./ManagedCustomElement\";\n\nexport class ClassListManager<SuffixType extends string> {\n  #currentClassName: string | null = null;\n  // The prefix should ideally end in a dash.\n  constructor(\n    private elem: ManagedCustomElement,\n    private prefix: string,\n    private validSuffixes: SuffixType[],\n  ) {}\n\n  // Does nothing if there was no value.\n  clearValue(): void {\n    if (this.#currentClassName) {\n      this.elem.contentWrapper.classList.remove(this.#currentClassName);\n    }\n    this.#currentClassName = null; // TODO: add test for this behaviour.\n  }\n\n  // Returns if the value changed\n  setValue(suffix: SuffixType): boolean {\n    if (!this.validSuffixes.includes(suffix)) {\n      throw new Error(`Invalid suffix: ${suffix}`);\n    }\n    const newClassName = `${this.prefix}${suffix}`;\n    const changed = this.#currentClassName !== newClassName;\n    if (changed) {\n      this.clearValue();\n      this.elem.contentWrapper.classList.add(newClassName);\n      this.#currentClassName = newClassName;\n    }\n    return changed;\n  }\n}\n","import { CSSSource } from \"../element/ManagedCustomElement\";\n\nexport const twistyViewerWrapperCSS = new CSSSource(`\n:host {\n  width: 384px;\n  height: 256px;\n  display: grid;\n}\n\n.wrapper {\n  width: 100%;\n  height: 100%;\n  display: grid;\n  overflow: hidden;\n}\n\n.wrapper > * {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n\n.wrapper.back-view-side-by-side {\n  grid-template-columns: 1fr 1fr;\n}\n\n.wrapper.back-view-top-right {\n  grid-template-columns: 3fr 1fr;\n  grid-template-rows: 1fr 3fr;\n}\n\n.wrapper.back-view-top-right > :nth-child(1) {\n  grid-row: 1 / 3;\n  grid-column: 1 / 3;\n}\n\n.wrapper.back-view-top-right > :nth-child(2) {\n  grid-row: 1 / 2;\n  grid-column: 2 / 3;\n}\n`);\n","import { Vector3 } from \"three\";\nimport { Alg, Move } from \"../../alg\";\nimport { experimentalAppendMove } from \"../../alg\";\nimport { KPuzzleDefinition, Transformation } from \"../../kpuzzle\";\nimport type { StickerDat } from \"../../puzzle-geometry\";\nimport { puzzles } from \"../../puzzles\";\nimport { PuzzleLoader } from \"../../puzzles/PuzzleLoader\";\nimport { Cube3D } from \"../3D/puzzles/Cube3D\";\nimport { PG3D, PG3DOptions } from \"../3D/puzzles/PG3D\";\nimport { Twisty3DPuzzle } from \"../3D/puzzles/Twisty3DPuzzle\";\nimport { Twisty3DScene } from \"../3D/Twisty3DScene\";\nimport { AlgCursor, IndexerConstructor } from \"../animation/cursor/AlgCursor\";\nimport { SimpleAlgIndexer } from \"../animation/indexer/SimpleAlgIndexer\";\nimport { SimultaneousMoveIndexer } from \"../animation/indexer/simultaneous-moves/SimultaneousMoveIndexer\";\nimport { TreeAlgIndexer } from \"../animation/indexer/tree/TreeAlgIndexer\";\nimport {\n  Timeline,\n  TimelineAction,\n  TimelineActionEvent,\n  TimestampLocationType,\n} from \"../animation/Timeline\";\nimport { countMoves } from \"../../notation\"; // TODO\nimport { TwistyControlButtonPanel } from \"./controls/buttons\";\nimport { TwistyControlElement } from \"./controls/TwistyControlElement.ts\";\nimport { TwistyScrubber } from \"./controls/TwistyScrubber\";\nimport { ClassListManager } from \"./element/ClassListManager\";\nimport { ManagedCustomElement } from \"./element/ManagedCustomElement\";\nimport { customElementsShim } from \"./element/node-custom-element-shims\";\nimport { twistyPlayerCSS } from \"./TwistyPlayer.css\";\nimport {\n  BackgroundTheme,\n  centeredCameraPosition,\n  ControlsLocation,\n  cubeCameraPosition,\n  ExperimentalStickering,\n  HintFaceletStyle,\n  PuzzleID,\n  SetupToLocation,\n  TwistyPlayerConfig,\n  TwistyPlayerInitialConfig,\n  ViewerLinkPage,\n  VisualizationFormat,\n} from \"./TwistyPlayerConfig\";\nimport { Twisty2DSVG, Twisty2DSVGOptions } from \"./viewers/Twisty2DSVG\";\nimport { Twisty3DCanvas } from \"./viewers/Twisty3DCanvas\";\nimport { TwistyViewerElement } from \"./viewers/TwistyViewerElement\";\nimport {\n  BackViewLayout,\n  TwistyViewerWrapper,\n} from \"./viewers/TwistyViewerWrapper\";\nimport { PuzzleAppearance } from \"../../puzzles/stickerings/appearance\";\n\nexport interface LegacyExperimentalPG3DViewConfig {\n  def: KPuzzleDefinition;\n  stickerDat: StickerDat;\n  experimentalPolarVantages?: boolean;\n  showFoundation?: boolean;\n  hintStickers?: boolean;\n}\n\nfunction is3DVisualization(visualizationFormat: VisualizationFormat): boolean {\n  return [\"3D\", \"PG3D\"].includes(visualizationFormat);\n}\n\ninterface PendingPuzzleUpdate {\n  cancelled: boolean;\n}\n\nconst indexerMap = {\n  simple: SimpleAlgIndexer,\n  tree: TreeAlgIndexer,\n  simultaneous: SimultaneousMoveIndexer,\n};\n\n// <twisty-player>\nexport class TwistyPlayer extends ManagedCustomElement {\n  #config: TwistyPlayerConfig;\n\n  timeline: Timeline;\n  cursor: AlgCursor | null;\n  scene: Twisty3DScene | null = null;\n  twisty3D: Twisty3DPuzzle | null = null;\n\n  #connected: boolean = false;\n  #legacyExperimentalPG3DViewConfig: LegacyExperimentalPG3DViewConfig | null = null;\n  /** @deprecated */\n  public legacyExperimentalPG3D: PG3D | null = null;\n  #experimentalStartStateOverride: Transformation | null = null;\n\n  viewerElems: TwistyViewerElement[] = []; // TODO: can we represent the intermediate state better?\n  controlElems: TwistyControlElement[] = []; // TODO: can we represent the intermediate state better?\n\n  #hackyPendingFinalMoveCoalesce: boolean = false;\n\n  #viewerWrapper: TwistyViewerWrapper;\n  public legacyExperimentalCoalesceModFunc: (move: Move) => number = (\n    _move: Move,\n  ): number => 0;\n\n  #controlsClassListManager: ClassListManager<ControlsLocation> = new ClassListManager(\n    this,\n    \"controls-\",\n    [\"none\", \"bottom-row\"],\n  );\n\n  // TODO: support config from DOM.\n  constructor(\n    initialConfig: TwistyPlayerInitialConfig = {},\n    legacyExperimentalPG3DViewConfig: LegacyExperimentalPG3DViewConfig | null = null,\n    private experimentalInvalidInitialAlgCallback: (alg: Alg) => void = () => {\n      // stub\n    },\n  ) {\n    super();\n    this.addCSS(twistyPlayerCSS);\n    this.#config = new TwistyPlayerConfig(this, initialConfig);\n\n    this.timeline = new Timeline();\n    this.timeline.addActionListener(this);\n\n    // We also do this in connectedCallback, but for now we also do it here so\n    // that there is some visual change even if the rest of construction or\n    // initialization fails.\n    this.contentWrapper.classList.add(\"checkered\");\n\n    this.#legacyExperimentalPG3DViewConfig = legacyExperimentalPG3DViewConfig;\n  }\n\n  // TODO(https://github.com/microsoft/TypeScript/pull/42425): Allow setting string in the type decl.\n  set alg(newAlg: Alg /* | string*/) {\n    // TODO: do validation for other algs as well.\n    if (typeof newAlg === \"string\") {\n      newAlg = Alg.fromString(newAlg);\n    }\n    this.#config.attributes[\"alg\"].setValue(newAlg);\n    this.cursor?.setAlg(newAlg, this.indexerConstructor()); // TODO: can we ensure the cursor already exists?\n    this.setCursorStartState();\n  }\n\n  get alg(): Alg {\n    return this.#config.attributes[\"alg\"].value;\n  }\n\n  /** @deprecated */\n  set experimentalSetupAlg(newAlg: Alg) {\n    // TODO: do validation for other algs as well.\n    if (typeof newAlg === \"string\") {\n      console.warn(\n        \"`experimentalSetupAlg` for a `TwistyPlayer` was set using a string. It should be set using a `Sequence`!\",\n      );\n      newAlg = new Alg((newAlg as unknown) as string);\n    }\n    this.#config.attributes[\"experimental-setup-alg\"].setValue(newAlg);\n    this.setCursorStartState();\n  }\n\n  /** @deprecated */\n  get experimentalSetupAlg(): Alg {\n    return this.#config.attributes[\"experimental-setup-alg\"].value;\n  }\n\n  private setCursorStartState(): void {\n    if (this.cursor) {\n      this.cursor.setStartState(\n        this.#experimentalStartStateOverride ??\n          this.cursor.algToState(this.cursorStartAlg()),\n      ); // TODO\n    }\n  }\n\n  private cursorStartAlg(): Alg {\n    let startAlg = this.experimentalSetupAlg;\n    if (this.experimentalSetupAnchor === \"end\") {\n      startAlg = startAlg.concat(this.alg.invert());\n    }\n    return startAlg; // TODO\n  }\n\n  /** @deprecated */\n  set experimentalSetupAnchor(setupToLocation: SetupToLocation) {\n    this.#config.attributes[\"experimental-setup-anchor\"].setValue(\n      setupToLocation,\n    );\n    this.setCursorStartState();\n  }\n\n  /** @deprecated */\n  get experimentalSetupAnchor(): SetupToLocation {\n    return this.#config.attributes[\"experimental-setup-anchor\"]\n      .value as SetupToLocation;\n  }\n\n  set puzzle(puzzle: PuzzleID) {\n    if (this.#config.attributes[\"puzzle\"].setValue(puzzle)) {\n      this.updatePuzzleDOM();\n    }\n  }\n\n  get puzzle(): PuzzleID {\n    return this.#config.attributes[\"puzzle\"].value as PuzzleID;\n  }\n\n  set visualization(visualization: VisualizationFormat) {\n    if (this.#config.attributes[\"visualization\"].setValue(visualization)) {\n      this.updatePuzzleDOM();\n    }\n  }\n\n  get visualization(): VisualizationFormat {\n    return this.#config.attributes[\"visualization\"]\n      .value as VisualizationFormat;\n  }\n\n  set hintFacelets(hintFacelets: HintFaceletStyle) {\n    // TODO: implement this for PG3D.\n    if (this.#config.attributes[\"hint-facelets\"].setValue(hintFacelets)) {\n      if (this.twisty3D instanceof Cube3D) {\n        this.twisty3D.experimentalUpdateOptions({ hintFacelets });\n      }\n    }\n  }\n\n  get hintFacelets(): HintFaceletStyle {\n    return this.#config.attributes[\"hint-facelets\"].value as HintFaceletStyle;\n  }\n\n  // TODO: Implement for PG3D\n  /** @deprecated */\n  get experimentalStickering(): ExperimentalStickering {\n    return this.#config.attributes[\"experimental-stickering\"]\n      .value as ExperimentalStickering;\n  }\n\n  // TODO: Implement for PG3D\n  /** @deprecated */\n  set experimentalStickering(experimentalStickering: ExperimentalStickering) {\n    if (\n      this.#config.attributes[\"experimental-stickering\"].setValue(\n        experimentalStickering,\n      )\n    ) {\n      const twisty3D = this.twisty3D;\n      if (twisty3D instanceof Cube3D) {\n        twisty3D.experimentalUpdateOptions({\n          experimentalStickering,\n        });\n      }\n      if (twisty3D instanceof PG3D) {\n        (async () => {\n          const appearance = await this.getPG3DAppearance();\n          twisty3D.experimentalSetAppearance(appearance!); // TODO\n        })();\n      }\n      if (this.viewerElems[0] instanceof Twisty2DSVG) {\n        (this.viewerElems[0] as Twisty2DSVG).experimentalSetStickering(\n          this.experimentalStickering,\n        );\n      }\n    }\n  }\n\n  set background(background: BackgroundTheme) {\n    if (this.#config.attributes[\"background\"].setValue(background)) {\n      this.contentWrapper.classList.toggle(\n        \"checkered\",\n        background === \"checkered\",\n      );\n    }\n  }\n\n  get background(): BackgroundTheme {\n    return this.#config.attributes[\"background\"].value as BackgroundTheme;\n  }\n\n  set controlPanel(controlPanel: ControlsLocation) {\n    this.#config.attributes[\"control-panel\"].setValue(controlPanel);\n    this.#controlsClassListManager.setValue(controlPanel);\n  }\n\n  get controlPanel(): ControlsLocation {\n    return this.#config.attributes[\"control-panel\"].value as ControlsLocation;\n  }\n\n  /** @deprecated use `controlPanel */\n  set controls(controls: ControlsLocation) {\n    this.controlPanel = controls;\n  }\n\n  /** @deprecated use `controlPanel */\n  get controls(): ControlsLocation {\n    return this.controlPanel;\n  }\n\n  set backView(backView: BackViewLayout) {\n    this.#config.attributes[\"back-view\"].setValue(backView);\n    if (backView !== \"none\" && this.viewerElems.length === 1) {\n      this.createBackViewer();\n    }\n    if (backView === \"none\" && this.viewerElems.length > 1) {\n      this.removeBackViewerElem();\n    }\n    if (this.#viewerWrapper && this.#viewerWrapper.setBackView(backView)) {\n      for (const viewer of this.viewerElems as Twisty3DCanvas[]) {\n        viewer.makeInvisibleUntilRender(); // TODO: can we do this more elegantly?\n      }\n    }\n  }\n\n  get backView(): BackViewLayout {\n    return this.#config.attributes[\"back-view\"].value as BackViewLayout;\n  }\n\n  set experimentalCameraPosition(cameraPosition: Vector3 | null) {\n    this.#config.attributes[\"experimental-camera-position\"].setValue(\n      cameraPosition,\n    );\n    if (\n      this.viewerElems &&\n      [\"3D\", \"PG3D\"].includes(this.#config.attributes[\"visualization\"].value)\n    ) {\n      (this.viewerElems[0] as Twisty3DCanvas)?.camera.position.copy(\n        this.effectiveCameraPosition,\n      );\n      (this.viewerElems[0] as Twisty3DCanvas)?.camera.lookAt(\n        new Vector3(0, 0, 0),\n      );\n      this.viewerElems[0]?.scheduleRender();\n      // Back view may or may not exist.\n      (this.viewerElems[1] as Twisty3DCanvas)?.camera.position\n        .copy(this.effectiveCameraPosition)\n        .multiplyScalar(-1);\n      (this.viewerElems[1] as Twisty3DCanvas)?.camera.lookAt(\n        new Vector3(0, 0, 0),\n      );\n      this.viewerElems[1]?.scheduleRender();\n    }\n  }\n\n  get experimentalCameraPosition(): Vector3 | null {\n    return this.#config.attributes[\"experimental-camera-position\"].value;\n  }\n\n  set viewerLink(viewerLinkPage: ViewerLinkPage) {\n    this.#config.attributes[\"viewer-link\"].setValue(viewerLinkPage);\n    const maybePanel = this.controlElems[1] as\n      | TwistyControlButtonPanel\n      | undefined;\n    if (maybePanel?.setViewerLink) {\n      maybePanel.setViewerLink(viewerLinkPage);\n    }\n  }\n\n  get viewerLink(): ViewerLinkPage {\n    return this.#config.attributes[\"viewer-link\"].value;\n  }\n\n  get effectiveCameraPosition(): Vector3 {\n    return this.experimentalCameraPosition ?? this.defaultCameraPosition;\n  }\n\n  // TODO\n  get defaultCameraPosition(): Vector3 {\n    return this.puzzle[1] === \"x\" ? cubeCameraPosition : centeredCameraPosition;\n  }\n\n  static get observedAttributes(): string[] {\n    return TwistyPlayerConfig.observedAttributes;\n  }\n\n  attributeChangedCallback(\n    attributeName: string,\n    oldValue: string,\n    newValue: string,\n  ): void {\n    this.#config.attributeChangedCallback(attributeName, oldValue, newValue);\n  }\n\n  experimentalSetStartStateOverride(state: Transformation): void {\n    this.#experimentalStartStateOverride = state;\n    this.setCursorStartState();\n  }\n\n  #cursorIndexerName: \"simple\" | \"tree\" | \"simultaneous\" = \"tree\";\n  /** @deprecated */\n  public experimentalSetCursorIndexer(\n    cursorName: \"simple\" | \"tree\" | \"simultaneous\",\n  ): void {\n    if (this.#cursorIndexerName === cursorName) {\n      // TODO: This is a hacky optimization.\n      return;\n    }\n    this.#cursorIndexerName = cursorName;\n    this.cursor?.experimentalSetIndexer(this.indexerConstructor());\n  }\n\n  private indexerConstructor(): IndexerConstructor {\n    return indexerMap[this.#cursorIndexerName];\n  }\n\n  // TODO: It seems this called after the `attributeChangedCallback`s for initial values. Can we rely on this?\n  protected connectedCallback(): void {\n    this.contentWrapper.classList.toggle(\n      \"checkered\",\n      this.background === \"checkered\",\n    );\n\n    // TODO: specify exactly when back views are possible.\n    // TODO: Are there any SVGs where we'd want a separate back view?\n    const setBackView: boolean =\n      this.backView && is3DVisualization(this.visualization);\n    const backView: BackViewLayout = setBackView\n      ? (this.backView as BackViewLayout)\n      : \"none\";\n    this.#viewerWrapper = new TwistyViewerWrapper({\n      backView,\n    });\n    this.addElement(this.#viewerWrapper);\n\n    const scrubber = new TwistyScrubber(this.timeline);\n    const controlButtonGrid = new TwistyControlButtonPanel(this.timeline, {\n      fullscreenElement: this,\n      viewerLinkCallback: this.visitTwizzleLink.bind(this),\n      viewerLink: this.viewerLink,\n    });\n\n    this.controlElems = [scrubber, controlButtonGrid];\n\n    this.#controlsClassListManager.setValue(this.controlPanel);\n\n    this.addElement(this.controlElems[0]);\n    this.addElement(this.controlElems[1]);\n\n    this.#connected = true;\n    this.updatePuzzleDOM(true);\n  }\n\n  public twizzleLink(): string {\n    const url = new URL(\n      \"https://experiments.cubing.net/cubing.js/alg.cubing.net/index.html\",\n    );\n    // const url = new URL(\"http://localhost:3333/alg.cubing.net/index.html\");\n    if (!this.alg.experimentalIsEmpty()) {\n      url.searchParams.set(\"alg\", this.alg.toString());\n    }\n    if (!this.experimentalSetupAlg.experimentalIsEmpty()) {\n      url.searchParams.set(\n        \"experimental-setup-alg\",\n        this.experimentalSetupAlg.toString(),\n      );\n    }\n    if (this.experimentalSetupAnchor !== \"start\") {\n      url.searchParams.set(\n        \"experimental-setup-anchor\",\n        this.experimentalSetupAnchor,\n      );\n    }\n    if (this.experimentalStickering !== \"full\") {\n      url.searchParams.set(\n        \"experimental-stickering\",\n        this.experimentalStickering,\n      );\n    }\n    if (this.puzzle !== \"3x3x3\") {\n      url.searchParams.set(\"puzzle\", this.puzzle);\n    }\n    return url.toString();\n  }\n\n  public visitTwizzleLink(): void {\n    const a = document.createElement(\"a\");\n    a.href = this.twizzleLink();\n    a.target = \"_blank\";\n    a.click();\n  }\n\n  #pendingPuzzleUpdates: PendingPuzzleUpdate[] = [];\n  #renderMode: \"2D\" | \"3D\" | null = null;\n\n  // Idempotent\n  private clearRenderMode(): void {\n    switch (this.#renderMode) {\n      case \"3D\":\n        this.scene = null;\n        this.twisty3D = null;\n        this.legacyExperimentalPG3D = null;\n        this.viewerElems = [];\n        this.#viewerWrapper.clear();\n        break;\n      case \"2D\":\n        this.viewerElems = [];\n        this.#viewerWrapper.clear();\n        break;\n    }\n    this.#renderMode = null;\n  }\n\n  private setRenderMode2D(): void {\n    if (this.#renderMode === \"2D\") {\n      return;\n    }\n    this.clearRenderMode();\n    this.#renderMode = \"2D\";\n  }\n\n  private setTwisty2DSVG(twisty2DSVG: Twisty2DSVG): void {\n    this.setRenderMode2D();\n\n    this.#viewerWrapper.clear();\n    this.#viewerWrapper.addElement(twisty2DSVG);\n    this.viewerElems.push(twisty2DSVG);\n  }\n\n  private setRenderMode3D(): void {\n    if (this.#renderMode === \"3D\") {\n      return;\n    }\n    this.clearRenderMode();\n\n    this.scene = new Twisty3DScene();\n    const mainViewer = new Twisty3DCanvas(this.scene, {\n      experimentalCameraPosition: this.effectiveCameraPosition,\n    });\n    this.viewerElems.push(mainViewer);\n    this.#viewerWrapper.addElement(mainViewer);\n\n    if (this.backView !== \"none\") {\n      this.createBackViewer();\n    }\n    this.#renderMode = \"3D\";\n  }\n\n  private setTwisty3D(twisty3D: Twisty3DPuzzle): void {\n    if (this.twisty3D) {\n      this.scene!.removeTwisty3DPuzzle(this.twisty3D);\n      if (this.twisty3D instanceof PG3D) {\n        this.twisty3D.dispose();\n      }\n      this.twisty3D = null;\n    }\n    this.twisty3D = twisty3D;\n    this.scene!.addTwisty3DPuzzle(twisty3D);\n  }\n\n  private setCursor(cursor: AlgCursor): void {\n    const oldCursor = this.cursor;\n    this.cursor = cursor;\n    try {\n      this.cursor.setAlg(this.alg, this.indexerConstructor());\n      this.setCursorStartState();\n    } catch (e) {\n      this.cursor.setAlg(new Alg(), this.indexerConstructor());\n      this.cursor.setStartState(this.cursor.algToState(new Alg()));\n      this.experimentalInvalidInitialAlgCallback(this.alg);\n    }\n    this.setCursorStartState();\n    this.timeline.addCursor(cursor);\n    if (oldCursor) {\n      this.timeline.removeCursor(oldCursor);\n      this.timeline.removeTimestampListener(oldCursor);\n    }\n    this.experimentalSetCursorIndexer(this.#cursorIndexerName);\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars-experimental\n  async updatePuzzleDOM(initial: boolean = false): Promise<void> {\n    if (!this.#connected) {\n      return;\n    }\n\n    let puzzleLoader: PuzzleLoader;\n    if (this.puzzle === \"custom\") {\n      puzzleLoader = {\n        id: \"custom\",\n        fullName: \"Custom (PG3D)\",\n        def: () => Promise.resolve(this.#legacyExperimentalPG3DViewConfig!.def),\n        svg: async () => {\n          throw \"unimplemented\";\n        },\n      };\n    } else {\n      puzzleLoader = puzzles[this.puzzle];\n    }\n\n    for (const pendingPuzzleUpdate of this.#pendingPuzzleUpdates) {\n      pendingPuzzleUpdate.cancelled = true;\n    }\n    this.#pendingPuzzleUpdates = [];\n    const pendingPuzzleUpdate: PendingPuzzleUpdate = { cancelled: false };\n    this.#pendingPuzzleUpdates.push(pendingPuzzleUpdate);\n\n    const def: KPuzzleDefinition = await puzzleLoader.def();\n    if (pendingPuzzleUpdate.cancelled) {\n      return;\n    }\n\n    let cursor: AlgCursor;\n    try {\n      cursor = new AlgCursor(\n        this.timeline,\n        def,\n        this.alg,\n        this.cursorStartAlg(),\n        this.indexerConstructor(),\n      ); // TODO: validate more directly if the alg is okay for the puzzle.\n      this.setCursor(cursor);\n    } catch (e) {\n      if (initial) {\n        // TODO: also take into account setup alg.\n        this.experimentalInvalidInitialAlgCallback(this.alg);\n      }\n      cursor = new AlgCursor(\n        this.timeline,\n        def,\n        new Alg(),\n        new Alg(),\n        this.indexerConstructor(),\n      );\n      this.setCursor(cursor);\n    }\n    if (\n      initial &&\n      this.experimentalSetupAlg.experimentalIsEmpty() &&\n      this.experimentalSetupAnchor !== \"end\"\n    ) {\n      this.timeline.jumpToEnd();\n    }\n    switch (this.visualization) {\n      case \"2D\":\n      case \"experimental-2D-LL\":\n        {\n          const options: Twisty2DSVGOptions = {};\n          if (this.experimentalStickering) {\n            options.experimentalStickering = this.experimentalStickering;\n          }\n\n          this.setRenderMode2D();\n          const svgPromiseFn =\n            this.visualization === \"2D\"\n              ? puzzleLoader.svg\n              : puzzleLoader.llSVG ?? puzzleLoader.svg;\n          const mainViewer = new Twisty2DSVG(\n            cursor,\n            def,\n            await svgPromiseFn(),\n            options,\n            puzzleLoader,\n          );\n          if (!pendingPuzzleUpdate.cancelled) {\n            this.setTwisty2DSVG(mainViewer);\n          }\n        }\n        break;\n      case \"3D\":\n      case \"PG3D\":\n        {\n          this.setRenderMode3D();\n          const scene = this.scene!;\n\n          let twisty3D: Twisty3DPuzzle;\n          if (this.visualization === \"3D\" && this.puzzle === \"3x3x3\") {\n            twisty3D = new Cube3D(\n              def,\n              cursor,\n              scene.scheduleRender.bind(scene),\n              {\n                hintFacelets: this.hintFacelets,\n                experimentalStickering: this.experimentalStickering,\n              },\n            );\n          } else {\n            let def: KPuzzleDefinition;\n            let stickerDat: StickerDat;\n            const pgGetter = puzzleLoader.pg;\n            if (this.puzzle === \"custom\") {\n              def = this.#legacyExperimentalPG3DViewConfig!.def;\n              stickerDat = this.#legacyExperimentalPG3DViewConfig!.stickerDat;\n            } else if (pgGetter) {\n              const pg = await pgGetter();\n              if (pendingPuzzleUpdate.cancelled) {\n                return;\n              }\n              def = pg.writekpuzzle(true) as KPuzzleDefinition; // TODO\n              stickerDat = pg.get3d();\n            } else {\n              throw \"Unimplemented!\";\n            }\n            const options: PG3DOptions = {};\n            const pg3d = new PG3D(\n              cursor,\n              scene.scheduleRender.bind(scene),\n              def,\n              stickerDat,\n              this.#legacyExperimentalPG3DViewConfig?.showFoundation ?? true,\n              this.#legacyExperimentalPG3DViewConfig?.hintStickers ??\n                this.hintFacelets === \"floating\",\n              options,\n            );\n            (async () => {\n              const appearance = await this.getPG3DAppearance();\n              if (appearance) {\n                pg3d.experimentalSetAppearance(appearance);\n              }\n            })();\n            this.legacyExperimentalPG3D = pg3d;\n            twisty3D = pg3d;\n          }\n          this.setTwisty3D(twisty3D);\n        }\n        break;\n    }\n  }\n\n  private async getPG3DAppearance(): Promise<PuzzleAppearance | null> {\n    const puzzleLoader = puzzles[this.puzzle];\n    if (puzzleLoader?.appearance) {\n      return puzzleLoader.appearance(this.experimentalStickering ?? \"full\");\n    }\n    return null;\n  }\n\n  private createBackViewer(): void {\n    if (!is3DVisualization(this.visualization)) {\n      throw new Error(\"Back viewer requires a 3D visualization\");\n    }\n\n    const backViewer = new Twisty3DCanvas(this.scene!, {\n      experimentalCameraPosition: this.effectiveCameraPosition,\n      negateCameraPosition: true,\n    });\n    this.viewerElems.push(backViewer);\n    (this.viewerElems[0] as Twisty3DCanvas).setMirror(backViewer);\n    this.#viewerWrapper.addElement(backViewer);\n  }\n\n  private removeBackViewerElem(): void {\n    // TODO: Validate visualization.\n    if (this.viewerElems.length !== 2) {\n      throw new Error(\"Tried to remove non-existent back view!\");\n    }\n    this.#viewerWrapper.removeElement(this.viewerElems.pop()!);\n  }\n\n  async setCustomPuzzleGeometry(\n    legacyExperimentalPG3DViewConfig: LegacyExperimentalPG3DViewConfig,\n  ): Promise<void> {\n    this.puzzle = \"custom\";\n    this.#legacyExperimentalPG3DViewConfig = legacyExperimentalPG3DViewConfig;\n    await this.updatePuzzleDOM();\n  }\n\n  // TODO: Handle playing the new move vs. just modying the alg.\n  // Note: setting `coalesce`\n  experimentalAddMove(\n    move: Move,\n    coalesce: boolean = false,\n    coalesceDelayed: boolean = false,\n  ): void {\n    if (this.#hackyPendingFinalMoveCoalesce) {\n      this.hackyCoalescePending();\n    }\n    const oldNumMoves = countMoves(this.alg); // TODO\n    const newAlg = experimentalAppendMove(this.alg, move, {\n      coalesce: coalesce && !coalesceDelayed,\n      mod: this.legacyExperimentalCoalesceModFunc(move),\n    });\n    // const newAlg = experimentalAppendBlockMove(\n    //   this.alg,\n    //   move,\n    //   coalesce && !coalesceDelayed,\n    //   this.legacyExperimentalCoalesceModFunc(move),\n    // );\n    if (coalesce && coalesceDelayed) {\n      this.#hackyPendingFinalMoveCoalesce = true;\n    }\n\n    this.alg = newAlg;\n    // TODO\n    if (oldNumMoves <= countMoves(newAlg)) {\n      this.timeline.experimentalJumpToLastMove();\n    } else {\n      this.timeline.jumpToEnd();\n    }\n    this.timeline.play();\n  }\n\n  onTimelineAction(actionEvent: TimelineActionEvent): void {\n    if (\n      actionEvent.action === TimelineAction.Pausing &&\n      actionEvent.locationType === TimestampLocationType.EndOfTimeline &&\n      this.#hackyPendingFinalMoveCoalesce\n    ) {\n      this.hackyCoalescePending();\n      this.timeline.jumpToEnd();\n    }\n  }\n\n  private hackyCoalescePending(): void {\n    const units = Array.from(this.alg.units());\n    const length = units.length;\n    const pending = this.#hackyPendingFinalMoveCoalesce;\n    this.#hackyPendingFinalMoveCoalesce = false;\n    if (pending && length > 1 && units[length - 1].is(Move)) {\n      const finalMove = units[length - 1] as Move;\n      const newAlg = experimentalAppendMove(\n        new Alg(units.slice(0, length - 1)),\n        finalMove,\n        {\n          coalesce: true,\n          mod: this.legacyExperimentalCoalesceModFunc(finalMove),\n        },\n      );\n      this.alg = newAlg;\n    }\n  }\n\n  fullscreen(): void {\n    this.requestFullscreen();\n  }\n}\n\ncustomElementsShim.define(\"twisty-player\", TwistyPlayer);\n","import {\n  BackSide,\n  BoxGeometry,\n  BufferAttribute,\n  BufferGeometry,\n  DoubleSide,\n  Euler,\n  Group,\n  Matrix4,\n  Mesh,\n  MeshBasicMaterial,\n  Object3D,\n  Quaternion,\n  Texture,\n  TextureLoader,\n  Vector2,\n  Vector3,\n} from \"three\";\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport { BlockMove } from \"../../../alg\";\nimport { KPuzzleDefinition, Transformation } from \"../../../kpuzzle\";\nimport { puzzles } from \"../../../puzzles\";\nimport {\n  FaceletMeshAppearance,\n  PuzzleAppearance,\n} from \"../../../puzzles/stickerings/appearance\";\nimport { AlgCursor } from \"../../animation/cursor/AlgCursor\";\nimport { PuzzlePosition } from \"../../animation/cursor/CursorTypes\";\nimport { smootherStep } from \"../../animation/easing\";\nimport {\n  ExperimentalStickering,\n  experimentalStickerings,\n  HintFaceletStyle,\n  hintFaceletStyles,\n} from \"../../dom/TwistyPlayerConfig\";\nimport { TAU } from \"../TAU\";\nimport { Twisty3DPuzzle } from \"./Twisty3DPuzzle\";\n\nconst svgLoader = new TextureLoader();\n\nconst ignoredMaterial = new MeshBasicMaterial({\n  color: 0x444444,\n  side: DoubleSide,\n});\n\nconst ignoredMaterialHint = new MeshBasicMaterial({\n  color: 0xcccccc,\n  side: BackSide,\n});\n\nconst invisibleMaterial = new MeshBasicMaterial({\n  visible: false,\n});\n\nconst orientedMaterial = new MeshBasicMaterial({\n  color: 0xff88ff,\n});\n\nconst orientedMaterialHint = new MeshBasicMaterial({\n  color: 0xff88ff,\n  side: BackSide,\n});\n\ninterface MaterialMap extends Record<FaceletMeshAppearance, MeshBasicMaterial> {\n  regular: MeshBasicMaterial;\n  dim: MeshBasicMaterial;\n  ignored: MeshBasicMaterial;\n  invisible: MeshBasicMaterial;\n}\n\nclass AxisInfo {\n  public stickerMaterial: MaterialMap;\n  public hintStickerMaterial: MaterialMap;\n  constructor(\n    public vector: Vector3,\n    public fromZ: Euler,\n    public color: number,\n    public dimColor: number,\n  ) {\n    // TODO: Make sticker material single-sided when cubie foundation is opaque?\n    this.stickerMaterial = {\n      regular: new MeshBasicMaterial({\n        color,\n        side: DoubleSide,\n      }),\n      dim: new MeshBasicMaterial({\n        color: dimColor,\n        side: DoubleSide,\n      }),\n      oriented: orientedMaterial,\n      ignored: ignoredMaterial,\n      invisible: invisibleMaterial,\n    };\n    this.hintStickerMaterial = {\n      regular: new MeshBasicMaterial({\n        color,\n        side: BackSide,\n      }),\n      dim: new MeshBasicMaterial({\n        color: dimColor,\n        side: BackSide,\n        transparent: true,\n        opacity: 0.75,\n      }),\n      oriented: orientedMaterialHint,\n      ignored: ignoredMaterialHint,\n      invisible: invisibleMaterial,\n    };\n  }\n}\n\nconst axesInfo: AxisInfo[] = [\n  new AxisInfo(\n    new Vector3(0, 1, 0),\n    new Euler(-TAU / 4, 0, 0),\n    0xffffff,\n    0xdddddd,\n  ),\n  new AxisInfo(\n    new Vector3(-1, 0, 0),\n    new Euler(0, -TAU / 4, 0),\n    0xff8800,\n    0x884400,\n  ),\n  new AxisInfo(new Vector3(0, 0, 1), new Euler(0, 0, 0), 0x00ff00, 0x008800),\n  new AxisInfo(\n    new Vector3(1, 0, 0),\n    new Euler(0, TAU / 4, 0),\n    0xff0000,\n    0x660000,\n  ),\n  new AxisInfo(\n    new Vector3(0, 0, -1),\n    new Euler(0, TAU / 2, 0),\n    0x0000ff,\n    0x000088,\n  ),\n  new AxisInfo(\n    new Vector3(0, -1, 0),\n    new Euler(TAU / 4, 0, 0),\n    0xffff00,\n    0x888800,\n  ),\n];\n\nconst face: { [s: string]: number } = {\n  U: 0,\n  L: 1,\n  F: 2,\n  R: 3,\n  B: 4,\n  D: 5,\n};\n\nconst familyToAxis: { [s: string]: number } = {\n  U: face.U,\n  u: face.U,\n  Uw: face.U,\n  y: face.U,\n  L: face.L,\n  l: face.L,\n  Lw: face.L,\n  M: face.L,\n  F: face.F,\n  f: face.F,\n  Fw: face.F,\n  S: face.F,\n  z: face.F,\n  R: face.R,\n  r: face.R,\n  Rw: face.R,\n  x: face.R,\n  B: face.B,\n  b: face.B,\n  Bw: face.B,\n  D: face.D,\n  d: face.D,\n  Dw: face.D,\n  E: face.D,\n};\n\nconst cubieDimensions = {\n  stickerWidth: 0.85,\n  stickerElevation: 0.503,\n  foundationWidth: 1,\n  hintStickerElevation: 1.45,\n};\nconst EXPERIMENTAL_PICTURE_CUBE_HINT_ELEVATION = 2;\n\n/** @deprecated */\nexport function experimentalSetDefaultStickerElevation(\n  stickerElevation: number,\n): void {\n  cubieDimensions.stickerElevation = stickerElevation;\n}\n\ninterface Cube3DOptions {\n  showMainStickers?: boolean;\n  hintFacelets?: HintFaceletStyle;\n  showFoundation?: boolean; // TODO: better name\n  experimentalStickering?: ExperimentalStickering;\n}\n\nconst cube3DOptionsDefaults: Cube3DOptions = {\n  showMainStickers: true,\n  hintFacelets: \"floating\",\n  showFoundation: true,\n  experimentalStickering: \"full\",\n};\n\n// TODO: Make internal foundation faces one-sided, facing to the outside of the cube.\nconst blackMesh = new MeshBasicMaterial({\n  color: 0x000000,\n  opacity: 1,\n  transparent: true,\n});\n\nconst blackTranslucentMesh = new MeshBasicMaterial({\n  color: 0x000000,\n  opacity: 0.3,\n  transparent: true,\n});\n\nclass CubieDef {\n  public matrix: Matrix4;\n  public stickerFaces: number[];\n  // stickerFaceNames can be e.g. [\"U\", \"F\", \"R\"], \"UFR\" if every face is a single letter.\n  constructor(\n    public orbit: string,\n    stickerFaceNames: string[] | string,\n    q: Quaternion,\n  ) {\n    const individualStickerFaceNames =\n      typeof stickerFaceNames === \"string\"\n        ? stickerFaceNames.split(\"\")\n        : stickerFaceNames;\n    this.stickerFaces = individualStickerFaceNames.map((s) => face[s]);\n    this.matrix = new Matrix4();\n    this.matrix.setPosition(firstPiecePosition[orbit]);\n    this.matrix.premultiply(new Matrix4().makeRotationFromQuaternion(q));\n  }\n}\n\nfunction t(v: Vector3, t4: number): Quaternion {\n  return new Quaternion().setFromAxisAngle(v, (TAU * t4) / 4);\n}\n\nconst r = {\n  O: new Vector3(0, 0, 0),\n  U: new Vector3(0, -1, 0),\n  L: new Vector3(1, 0, 0),\n  F: new Vector3(0, 0, -1),\n  R: new Vector3(-1, 0, 0),\n  B: new Vector3(0, 0, 1),\n  D: new Vector3(0, 1, 0),\n};\n\ninterface OrbitIndexed<T> {\n  [s: string]: T;\n}\ntype PieceIndexed<T> = OrbitIndexed<T[]>;\n\nconst firstPiecePosition: OrbitIndexed<Vector3> = {\n  EDGES: new Vector3(0, 1, 1),\n  CORNERS: new Vector3(1, 1, 1),\n  CENTERS: new Vector3(0, 1, 0),\n};\nconst orientationRotation: OrbitIndexed<Matrix4[]> = {\n  EDGES: [0, 1].map((i) =>\n    new Matrix4().makeRotationAxis(\n      firstPiecePosition.EDGES.clone().normalize(),\n      (-i * TAU) / 2,\n    ),\n  ),\n  CORNERS: [0, 1, 2].map((i) =>\n    new Matrix4().makeRotationAxis(\n      firstPiecePosition.CORNERS.clone().normalize(),\n      (-i * TAU) / 3,\n    ),\n  ),\n  CENTERS: [0, 1, 2, 3].map((i) =>\n    new Matrix4().makeRotationAxis(\n      firstPiecePosition.CENTERS.clone().normalize(),\n      (-i * TAU) / 4,\n    ),\n  ),\n};\nconst cubieStickerOrder = [face.U, face.F, face.R];\n\nconst pieceDefs: PieceIndexed<CubieDef> = {\n  EDGES: [\n    new CubieDef(\"EDGES\", \"UF\", t(r.O, 0)),\n    new CubieDef(\"EDGES\", \"UR\", t(r.U, 3)),\n    new CubieDef(\"EDGES\", \"UB\", t(r.U, 2)),\n    new CubieDef(\"EDGES\", \"UL\", t(r.U, 1)),\n    new CubieDef(\"EDGES\", \"DF\", t(r.F, 2)),\n    new CubieDef(\"EDGES\", \"DR\", t(r.F, 2).premultiply(t(r.D, 1))),\n    new CubieDef(\"EDGES\", \"DB\", t(r.F, 2).premultiply(t(r.D, 2))),\n    new CubieDef(\"EDGES\", \"DL\", t(r.F, 2).premultiply(t(r.D, 3))),\n    new CubieDef(\"EDGES\", \"FR\", t(r.U, 3).premultiply(t(r.R, 3))),\n    new CubieDef(\"EDGES\", \"FL\", t(r.U, 1).premultiply(t(r.R, 3))),\n    new CubieDef(\"EDGES\", \"BR\", t(r.U, 3).premultiply(t(r.R, 1))),\n    new CubieDef(\"EDGES\", \"BL\", t(r.U, 1).premultiply(t(r.R, 1))),\n  ],\n  CORNERS: [\n    new CubieDef(\"CORNERS\", \"UFR\", t(r.O, 0)),\n    new CubieDef(\"CORNERS\", \"URB\", t(r.U, 3)),\n    new CubieDef(\"CORNERS\", \"UBL\", t(r.U, 2)),\n    new CubieDef(\"CORNERS\", \"ULF\", t(r.U, 1)),\n    new CubieDef(\"CORNERS\", \"DRF\", t(r.F, 2).premultiply(t(r.D, 1))),\n    new CubieDef(\"CORNERS\", \"DFL\", t(r.F, 2).premultiply(t(r.D, 0))),\n    new CubieDef(\"CORNERS\", \"DLB\", t(r.F, 2).premultiply(t(r.D, 3))),\n    new CubieDef(\"CORNERS\", \"DBR\", t(r.F, 2).premultiply(t(r.D, 2))),\n  ],\n  CENTERS: [\n    new CubieDef(\"CENTERS\", \"U\", t(r.O, 0)),\n    new CubieDef(\"CENTERS\", \"L\", t(r.R, 3).premultiply(t(r.U, 1))),\n    new CubieDef(\"CENTERS\", \"F\", t(r.R, 3)),\n    new CubieDef(\"CENTERS\", \"R\", t(r.R, 3).premultiply(t(r.D, 1))),\n    new CubieDef(\"CENTERS\", \"B\", t(r.R, 3).premultiply(t(r.D, 2))),\n    new CubieDef(\"CENTERS\", \"D\", t(r.R, 2)),\n  ],\n};\n\nconst CUBE_SCALE = 1 / 3;\n\ninterface FaceletInfo {\n  faceIdx: number;\n  facelet: Mesh;\n  hintFacelet?: Mesh;\n}\n\n// TODO: Compatibility with Randelshofer or standard net layout? Offer a\n// conversion function?\nconst pictureStickerCoords: Record<string, number[][][]> = {\n  EDGES: [\n    [\n      [0, 4, 6],\n      [0, 4, 5],\n    ],\n    [\n      [3, 5, 7],\n      [0, 7, 5],\n    ],\n    [\n      [2, 4, 8],\n      [0, 10, 5],\n    ],\n    [\n      [1, 3, 7],\n      [0, 1, 5],\n    ],\n    [\n      [2, 4, 2],\n      [2, 4, 3],\n    ],\n    [\n      [3, 5, 1],\n      [2, 7, 3],\n    ],\n    [\n      [2, 4, 2],\n      [2, 10, 3],\n    ],\n    [\n      [1, 3, 1],\n      [2, 1, 3],\n    ],\n    [\n      [3, 5, 4],\n      [3, 6, 4],\n    ],\n    [\n      [1, 3, 4],\n      [1, 2, 4],\n    ],\n    [\n      [1, 9, 4],\n      [1, 8, 4],\n    ],\n    [\n      [3, 11, 4],\n      [3, 0, 4],\n    ],\n  ],\n  CORNERS: [\n    [\n      [0, 5, 6],\n      [0, 5, 5],\n      [0, 6, 5],\n    ],\n    [\n      [3, 5, 8],\n      [0, 8, 5],\n      [0, 9, 5],\n    ],\n    [\n      [2, 3, 8],\n      [0, 11, 5],\n      [0, 0, 5],\n    ],\n    [\n      [1, 3, 6],\n      [0, 2, 5],\n      [0, 3, 5],\n    ],\n    [\n      [3, 5, 2],\n      [2, 6, 3],\n      [2, 5, 3],\n    ],\n    [\n      [2, 3, 2],\n      [2, 3, 3],\n      [2, 2, 3],\n    ],\n    [\n      [1, 3, 0],\n      [2, 0, 3],\n      [2, 11, 3],\n    ],\n    [\n      [0, 5, 0],\n      [2, 9, 3],\n      [2, 8, 3],\n    ],\n  ],\n  CENTERS: [\n    [[0, 4, 7]],\n    [[0, 1, 4]],\n    [[0, 4, 4]],\n    [[0, 7, 4]],\n    [[0, 10, 4]],\n    [[0, 4, 1]],\n  ],\n};\n\nlet sharedCubieFoundationGeometryCache: BoxGeometry | null = null;\nfunction sharedCubieFoundationGeometry(): BoxGeometry {\n  return (\n    sharedCubieFoundationGeometryCache ??\n    (sharedCubieFoundationGeometryCache = new BoxGeometry(\n      cubieDimensions.foundationWidth,\n      cubieDimensions.foundationWidth,\n      cubieDimensions.foundationWidth,\n    ))\n  );\n}\n\nfunction newStickerGeometry(): BufferGeometry {\n  const r = new BufferGeometry();\n  const half = 0.5 * cubieDimensions.stickerWidth;\n  r.setAttribute(\n    \"position\",\n    new BufferAttribute(\n      new Float32Array([\n        half,\n        half,\n        0,\n        -half,\n        half,\n        0,\n        half,\n        -half,\n        0,\n        -half,\n        half,\n        0,\n        -half,\n        -half,\n        0,\n        half,\n        -half,\n        0,\n      ]),\n      3,\n    ),\n  );\n  r.setAttribute(\n    \"uv\",\n    new BufferAttribute(\n      new Float32Array([\n        1,\n        1,\n        0,\n        1,\n        1,\n        0,\n        0,\n        1,\n        0,\n        0,\n        1,\n        0,\n        0,\n        1,\n        0,\n        0,\n        1,\n        1,\n        0,\n        0,\n        1,\n        0,\n        1,\n        1,\n      ]),\n      2,\n    ),\n  );\n  //  r.setAttribute('normals', new BufferAttribute(new Float32Array([0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1]), 3));\n  return r;\n}\n\nlet sharedStickerGeometryCache: BufferGeometry | null = null;\nfunction sharedStickerGeometry(): BufferGeometry {\n  return (\n    sharedStickerGeometryCache ??\n    (sharedStickerGeometryCache = newStickerGeometry())\n  );\n}\n\n// TODO: Split into \"scene model\" and \"view\".\nexport class Cube3D extends Object3D implements Twisty3DPuzzle {\n  kpuzzleFaceletInfo: Record<string, FaceletInfo[][]>;\n  private pieces: PieceIndexed<Object3D> = {};\n  private options: Cube3DOptions;\n  // TODO: Keep track of option-based meshes better.\n  private experimentalHintStickerMeshes: Mesh[] = [];\n  private experimentalFoundationMeshes: Mesh[] = [];\n\n  private setSpriteURL: (url: string) => void;\n  private sprite: Promise<Texture> = new Promise((resolve) => {\n    this.setSpriteURL = (url: string): void => {\n      svgLoader.load(url, resolve);\n    };\n  });\n\n  private setHintSpriteURL: (url: string) => void;\n  private hintSprite: Promise<Texture> = new Promise((resolve) => {\n    this.setHintSpriteURL = (url: string): void => {\n      svgLoader.load(url, resolve);\n    };\n  });\n\n  constructor(\n    private def: KPuzzleDefinition,\n    cursor?: AlgCursor,\n    private scheduleRenderCallback?: () => void,\n    options: Cube3DOptions = {},\n  ) {\n    super();\n\n    this.options = { ...cube3DOptionsDefaults };\n    Object.assign(this.options, options); // TODO: check if this works\n\n    if (this.def.name !== \"3x3x3\") {\n      throw new Error(\n        `Invalid puzzle for this Cube3D implementation: ${this.def.name}`,\n      );\n    }\n    this.kpuzzleFaceletInfo = {};\n    for (const orbit in pieceDefs) {\n      const orbitFaceletInfo: FaceletInfo[][] = [];\n      this.kpuzzleFaceletInfo[orbit] = orbitFaceletInfo;\n      this.pieces[orbit] = pieceDefs[orbit].map(\n        this.createCubie.bind(this, orbit, orbitFaceletInfo),\n      );\n    }\n    this.scale.set(CUBE_SCALE, CUBE_SCALE, CUBE_SCALE);\n\n    // TODO: Can we construct this directly instead of applying it later? Would that be more code-efficient?\n    if (this.options.experimentalStickering) {\n      this.setStickering(this.options.experimentalStickering);\n    }\n\n    cursor?.addPositionListener(this);\n  }\n\n  // Can only be called once.\n  /** @deprecated */\n  experimentalSetStickerSpriteURL(stickerSpriteURL: string): void {\n    this.setSpriteURL(stickerSpriteURL);\n  }\n\n  // Can only be called once.\n  /** @deprecated */\n  experimentalSetHintStickerSpriteURL(hintStickerSpriteURL: string): void {\n    this.setHintSpriteURL(hintStickerSpriteURL);\n  }\n\n  setStickering(stickering: ExperimentalStickering): void {\n    // TODO\n    (async () => {\n      // TODO\n      const appearance = await puzzles[\"3x3x3\"].appearance!(\n        stickering ?? \"full\",\n      );\n      this.setAppearance(\n        appearance ?? (await puzzles[\"3x3x3\"].appearance!(\"full\")),\n      );\n    })();\n  }\n\n  setAppearance(appearance: PuzzleAppearance): void {\n    for (const [orbitName, orbitAppearance] of Object.entries(\n      appearance.orbits,\n    )) {\n      for (\n        let pieceIdx = 0;\n        pieceIdx < orbitAppearance.pieces.length;\n        pieceIdx++\n      ) {\n        const pieceAppearance = orbitAppearance.pieces[pieceIdx];\n        if (pieceAppearance) {\n          const pieceInfo = this.kpuzzleFaceletInfo[orbitName][pieceIdx];\n          for (\n            let faceletIdx = 0;\n            faceletIdx < pieceInfo.length;\n            faceletIdx++\n          ) {\n            const faceletAppearance = pieceAppearance.facelets[faceletIdx];\n            if (faceletAppearance) {\n              const faceletInfo = pieceInfo[faceletIdx];\n\n              const appearance =\n                typeof faceletAppearance === \"string\"\n                  ? faceletAppearance\n                  : faceletAppearance?.appearance;\n\n              faceletInfo.facelet.material =\n                axesInfo[faceletInfo.faceIdx].stickerMaterial[appearance];\n              // TODO\n              const hintAppearance =\n                typeof faceletAppearance === \"string\"\n                  ? appearance\n                  : faceletAppearance.hintAppearance ?? appearance;\n              if (faceletInfo.hintFacelet) {\n                faceletInfo.hintFacelet.material =\n                  axesInfo[faceletInfo.faceIdx].hintStickerMaterial[\n                    hintAppearance\n                  ];\n              }\n            }\n          }\n        }\n      }\n    }\n    if (this.scheduleRenderCallback) {\n      this.scheduleRenderCallback();\n    }\n  }\n\n  /** @deprecated */\n  public experimentalUpdateOptions(options: Cube3DOptions): void {\n    if (\"showMainStickers\" in options) {\n      throw new Error(\"Unimplemented\");\n    }\n\n    const showFoundation = options.showFoundation;\n    if (\n      typeof showFoundation !== \"undefined\" &&\n      this.options.showFoundation !== showFoundation\n    ) {\n      this.options.showFoundation = showFoundation;\n      for (const foundation of this.experimentalFoundationMeshes) {\n        foundation.visible = showFoundation;\n      }\n    }\n\n    const hintFacelets = options.hintFacelets;\n    if (\n      typeof hintFacelets !== \"undefined\" &&\n      this.options.hintFacelets !== hintFacelets &&\n      hintFaceletStyles[hintFacelets] // TODO: test this\n    ) {\n      this.options.hintFacelets = hintFacelets;\n      for (const hintSticker of this.experimentalHintStickerMeshes) {\n        hintSticker.visible = hintFacelets === \"floating\";\n      }\n      this.scheduleRenderCallback!(); // TODO\n    }\n\n    const experimentalStickering = options.experimentalStickering;\n    if (\n      typeof experimentalStickering !== \"undefined\" &&\n      this.options.experimentalStickering !== experimentalStickering &&\n      experimentalStickerings[experimentalStickering] // TODO: test this\n    ) {\n      this.options.experimentalStickering = experimentalStickering;\n      // TODO\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      this.setStickering(experimentalStickering);\n      this.scheduleRenderCallback!(); // TODO\n    }\n  }\n\n  public onPositionChange(p: PuzzlePosition): void {\n    const reid333 = p.state as Transformation;\n    for (const orbit in pieceDefs) {\n      const pieces = pieceDefs[orbit];\n      for (let i = 0; i < pieces.length; i++) {\n        const j = reid333[orbit].permutation[i];\n        this.pieces[orbit][j].matrix.copy(pieceDefs[orbit][i].matrix);\n        this.pieces[orbit][j].matrix.multiply(\n          orientationRotation[orbit][reid333[orbit].orientation[i]],\n        );\n      }\n      for (const moveProgress of p.movesInProgress) {\n        const move = moveProgress.move;\n        const turnNormal = axesInfo[familyToAxis[move.family]].vector;\n        const moveMatrix = new Matrix4().makeRotationAxis(\n          turnNormal,\n          (-this.ease(moveProgress.fraction) *\n            moveProgress.direction *\n            move.effectiveAmount *\n            TAU) /\n            4,\n        );\n        for (let i = 0; i < pieces.length; i++) {\n          const k = this.def.moves[move.family][orbit].permutation[i];\n          if (\n            i !== k ||\n            this.def.moves[move.family][orbit].orientation[i] !== 0\n          ) {\n            const j = reid333[orbit].permutation[i];\n            this.pieces[orbit][j].matrix.premultiply(moveMatrix);\n          }\n        }\n      }\n    }\n    this.scheduleRenderCallback!();\n  }\n\n  // TODO: Always create (but sometimes hide parts) so we can show them later,\n  // or (better) support creating puzzle parts on demand.\n  private createCubie(\n    orbit: string,\n    orbitFacelets: FaceletInfo[][],\n    piece: CubieDef,\n    orbitPieceIdx: number,\n  ): Object3D {\n    const cubieFaceletInfo: FaceletInfo[] = [];\n    orbitFacelets.push(cubieFaceletInfo);\n    const cubie = new Group();\n    if (this.options.showFoundation) {\n      const foundation = this.createCubieFoundation();\n      cubie.add(foundation);\n      this.experimentalFoundationMeshes.push(foundation);\n    }\n    for (let i = 0; i < piece.stickerFaces.length; i++) {\n      const sticker = this.createSticker(\n        axesInfo[cubieStickerOrder[i]],\n        axesInfo[piece.stickerFaces[i]],\n        false,\n      );\n      const faceletInfo: FaceletInfo = {\n        faceIdx: piece.stickerFaces[i],\n        facelet: sticker,\n      };\n      cubie.add(sticker);\n      if (this.options.hintFacelets === \"floating\") {\n        const hintSticker = this.createSticker(\n          axesInfo[cubieStickerOrder[i]],\n          axesInfo[piece.stickerFaces[i]],\n          true,\n        );\n        cubie.add(hintSticker);\n        faceletInfo.hintFacelet = hintSticker;\n        this.experimentalHintStickerMeshes.push(hintSticker);\n      }\n\n      if (\n        this.options.experimentalStickering === \"picture\" &&\n        pictureStickerCoords[orbit] &&\n        pictureStickerCoords[orbit][orbitPieceIdx] &&\n        pictureStickerCoords[orbit][orbitPieceIdx][i]\n      ) {\n        const [rotate, offsetX, offsetY] = pictureStickerCoords[orbit][\n          orbitPieceIdx\n        ][i];\n        (async () => {\n          const addImageSticker = async (hint: boolean) => {\n            const texture: Texture = await (hint\n              ? this.hintSprite\n              : this.sprite);\n\n            const mesh = this.createSticker(\n              axesInfo[cubieStickerOrder[i]],\n              axesInfo[piece.stickerFaces[i]],\n              hint,\n            );\n            mesh.material = new MeshBasicMaterial({\n              map: texture,\n              side: hint ? BackSide : DoubleSide,\n              transparent: true,\n            });\n\n            const x1 = offsetX / 12;\n            const x2 = (offsetX + 1) / 12;\n            const y1 = offsetY / 9;\n            const y2 = (offsetY + 1) / 9;\n\n            let v1 = new Vector2(x1, y1);\n            let v2 = new Vector2(x1, y2);\n            let v3 = new Vector2(x2, y2);\n            let v4 = new Vector2(x2, y1);\n\n            switch (rotate) {\n              case 1:\n                [v1, v2, v3, v4] = [v2, v3, v4, v1];\n                break;\n              case 2:\n                [v1, v2, v3, v4] = [v3, v4, v1, v2];\n                break;\n              case 3:\n                [v1, v2, v3, v4] = [v4, v1, v2, v3];\n                break;\n            }\n            (mesh.geometry as BufferGeometry).setAttribute(\n              \"uv\",\n              new BufferAttribute(\n                new Float32Array([\n                  v3.x,\n                  v3.y,\n                  v2.x,\n                  v2.y,\n                  v4.x,\n                  v4.y,\n                  v2.x,\n                  v2.y,\n                  v1.x,\n                  v1.y,\n                  v4.x,\n                  v4.y,\n                ]),\n                2,\n              ),\n            );\n            cubie.add(mesh);\n          };\n          // const delay: number = ({\n          //   CENTERS: 1000,\n          //   EDGES: 2000,\n          //   CORNERS: 3500,\n          // } as Record<string, number>)[orbit];\n          // if (orbit === \"CENTERS\" && orbitPieceIdx === 5) {\n          addImageSticker(true);\n          addImageSticker(false);\n          // } else {\n          //   await this.sprite;\n          //   await this.hintSprite;\n          //   setTimeout(\n          //     () => addImageSticker(true),\n          //     delay + orbitPieceIdx * 100,\n          //   );\n          //   setTimeout(\n          //     () => addImageSticker(false),\n          //     delay + orbitPieceIdx * 100,\n          //   );\n          // }\n        })();\n      }\n\n      cubieFaceletInfo.push(faceletInfo);\n    }\n    cubie.matrix.copy(piece.matrix);\n    cubie.matrixAutoUpdate = false;\n    this.add(cubie);\n    return cubie;\n  }\n\n  // TODO: Support creating only the outward-facing parts?\n  private createCubieFoundation(): Mesh {\n    const box = sharedCubieFoundationGeometry();\n    return new Mesh(\n      box,\n      this.options.experimentalStickering === \"picture\"\n        ? blackMesh\n        : blackTranslucentMesh,\n    );\n  }\n\n  private createSticker(\n    posAxisInfo: AxisInfo,\n    materialAxisInfo: AxisInfo,\n    isHint: boolean,\n  ): Mesh {\n    const geo =\n      this.options.experimentalStickering === \"picture\"\n        ? newStickerGeometry()\n        : sharedStickerGeometry();\n    const stickerMesh = new Mesh(\n      geo,\n      isHint\n        ? materialAxisInfo.hintStickerMaterial.regular\n        : materialAxisInfo.stickerMaterial.regular,\n    );\n    stickerMesh.setRotationFromEuler(posAxisInfo.fromZ);\n    stickerMesh.position.copy(posAxisInfo.vector);\n    stickerMesh.position.multiplyScalar(\n      isHint\n        ? this.options.experimentalStickering === \"picture\"\n          ? EXPERIMENTAL_PICTURE_CUBE_HINT_ELEVATION\n          : cubieDimensions.hintStickerElevation\n        : cubieDimensions.stickerElevation,\n    );\n    return stickerMesh;\n  }\n\n  /** @deprecated */\n  experimentalSetFoundationOpacity(opacity: number): void {\n    (this.experimentalFoundationMeshes[0]\n      .material as MeshBasicMaterial).opacity = opacity;\n  }\n\n  /** @deprecated */\n  experimentalSetStickerWidth(width: number): void {\n    for (const orbitInfo of Object.values(this.kpuzzleFaceletInfo)) {\n      for (const pieceInfo of orbitInfo) {\n        for (const faceletInfo of pieceInfo) {\n          faceletInfo.facelet.scale.setScalar(\n            width / cubieDimensions.stickerWidth,\n          );\n          // faceletInfo.facelet.setRotationFromAxisAngle(new Vector3(0, 1, 0), 0);\n          // faceletInfo.facelet.rotateOnAxis(new Vector3(1, 0, 1), TAU / 6);\n        }\n      }\n    }\n  }\n\n  /** @deprecated */\n  experimentalSetCenterStickerWidth(width: number): void {\n    for (const orbitInfo of [this.kpuzzleFaceletInfo[\"CENTERS\"]]) {\n      for (const pieceInfo of orbitInfo) {\n        for (const faceletInfo of pieceInfo) {\n          faceletInfo.facelet.scale.setScalar(\n            width / cubieDimensions.stickerWidth,\n          );\n          // faceletInfo.facelet.setRotationFromAxisAngle(new Vector3(0, 1, 0), 0);\n          // faceletInfo.facelet.rotateOnAxis(new Vector3(1, 0, 1), TAU / 6);\n        }\n      }\n    }\n  }\n\n  private ease(fraction: number): number {\n    return smootherStep(fraction);\n  }\n}\n","export function smootherStep(x: number): number {\n  return x * x * x * (10 - x * (15 - 6 * x));\n}\n","export const TAU = Math.PI * 2;\n","import {\n  BufferAttribute,\n  BufferGeometry,\n  Color,\n  DoubleSide,\n  Euler,\n  Group,\n  Mesh,\n  MeshBasicMaterial,\n  Object3D,\n  Triangle,\n  Vector3,\n} from \"three\";\nimport {\n  areTransformationsEquivalent,\n  KPuzzleDefinition,\n  Transformation,\n} from \"../../../kpuzzle\";\nimport { experimentalTransformationForQuantumMove } from \"../../../kpuzzle\";\nimport { StickerDat, StickerDatSticker } from \"../../../puzzle-geometry\";\nimport {\n  ExperimentalFaceletMeshAppearance,\n  experimentalGetFaceletAppearance,\n  ExperimentalPuzzleAppearance,\n} from \"../../../puzzles\";\nimport { AlgCursor } from \"../../animation/cursor/AlgCursor\";\nimport { PuzzlePosition } from \"../../animation/cursor/CursorTypes\";\nimport { smootherStep } from \"../../animation/easing\";\nimport { TAU } from \"../TAU\";\n\nimport { Twisty3DPuzzle } from \"./Twisty3DPuzzle\";\n\nconst foundationMaterial = new MeshBasicMaterial({\n  side: DoubleSide,\n  color: 0x000000,\n  // transparency doesn't work very well here\n  // with duplicated center stickers\n  //  transparent: true,\n  //  opacity: 0.75,\n});\nconst stickerMaterial = new MeshBasicMaterial({\n  vertexColors: true,\n  //    side: DoubleSide,\n});\nconst polyMaterial = new MeshBasicMaterial({\n  visible: false,\n});\n\nclass Filler {\n  pos: number;\n  ipos: number;\n  vertices: Float32Array;\n  colors: Uint8Array;\n  ind: Uint8Array;\n  constructor(public sz: number, public colored: boolean = true) {\n    this.vertices = new Float32Array(9 * sz);\n    if (colored) {\n      this.colors = new Uint8Array(9 * sz);\n      this.ind = new Uint8Array(sz);\n    }\n    this.pos = 0;\n    this.ipos = 0;\n  }\n\n  add(pt: number[], c: number) {\n    this.vertices[this.pos] = pt[0];\n    this.vertices[this.pos + 1] = pt[1];\n    this.vertices[this.pos + 2] = pt[2];\n    this.colors[this.pos] = c >> 16;\n    this.colors[this.pos + 1] = (c >> 8) & 255;\n    this.colors[this.pos + 2] = c & 255;\n    this.pos += 3;\n  }\n\n  addUncolored(pt: number[]) {\n    this.vertices[this.pos] = pt[0];\n    this.vertices[this.pos + 1] = pt[1];\n    this.vertices[this.pos + 2] = pt[2];\n    this.pos += 3;\n  }\n\n  setind(i: number) {\n    this.ind[this.ipos++] = i;\n  }\n\n  setAttributes(geo: BufferGeometry) {\n    geo.setAttribute(\"position\", new BufferAttribute(this.vertices, 3));\n    if (this.colored) {\n      geo.setAttribute(\"color\", new BufferAttribute(this.colors, 3, true));\n    }\n  }\n\n  makeGroups(geo: BufferGeometry) {\n    geo.clearGroups();\n    for (let i = 0; i < this.ipos; ) {\n      const si = i++;\n      const iv = this.ind[si];\n      while (this.ind[i] === iv) {\n        i++;\n      }\n      geo.addGroup(3 * si, 3 * (i - si), iv);\n    }\n  }\n}\n\nfunction makePoly(\n  filler: Filler,\n  coords: number[][],\n  color: number,\n  scale: number,\n  ind: number,\n  faceArray: number[],\n): void {\n  let ncoords: number[][] = coords;\n  if (scale !== 1) {\n    ncoords = [];\n    for (const v of coords) {\n      const v2 = [v[0] * scale, v[1] * scale, v[2] * scale];\n      ncoords.push(v2);\n    }\n  }\n  for (let g = 1; g + 1 < ncoords.length; g++) {\n    faceArray.push(filler.ipos);\n    filler.add(ncoords[0], color);\n    filler.add(ncoords[g], color);\n    filler.add(ncoords[g + 1], color);\n    filler.setind(ind);\n  }\n}\n\nclass StickerDef {\n  public origColor: number;\n  public origColorAppearance: number;\n  public faceColor: number;\n  public faceArray: number[] = [];\n  public twistVal: number = -1;\n  constructor(\n    public filler: Filler,\n    stickerDat: StickerDatSticker,\n    hintStickers: boolean,\n    options?: {\n      appearance?: ExperimentalFaceletMeshAppearance;\n    },\n  ) {\n    const sdColor = new Color(stickerDat.color).getHex();\n    this.origColor = sdColor;\n    this.origColorAppearance = sdColor;\n    if (options?.appearance) {\n      this.setAppearance(options.appearance);\n    }\n    this.faceColor = sdColor;\n    const coords = stickerDat.coords as number[][];\n    makePoly(filler, coords, this.faceColor, 1, 0, this.faceArray);\n    if (hintStickers) {\n      let highArea = 0;\n      let goodFace = null;\n      for (const f of this.faceArray) {\n        const t = new Triangle(\n          new Vector3(\n            filler.vertices[9 * f],\n            filler.vertices[9 * f + 1],\n            filler.vertices[9 * f + 2],\n          ),\n          new Vector3(\n            filler.vertices[9 * f + 3],\n            filler.vertices[9 * f + 4],\n            filler.vertices[9 * f + 5],\n          ),\n          new Vector3(\n            filler.vertices[9 * f + 6],\n            filler.vertices[9 * f + 7],\n            filler.vertices[9 * f + 8],\n          ),\n        );\n        const a = t.getArea();\n        if (a > highArea) {\n          highArea = a;\n          goodFace = t;\n        }\n      }\n      const norm = new Vector3();\n      goodFace!.getNormal(norm);\n      norm.multiplyScalar(0.5);\n      const hintCoords = [];\n      for (let i = 0; i < coords.length; i++) {\n        const j = coords.length - 1 - i;\n        hintCoords.push([\n          coords[j][0] + norm.x,\n          coords[j][1] + norm.y,\n          coords[j][2] + norm.z,\n        ]);\n      }\n      makePoly(filler, hintCoords, this.faceColor, 1, 0, this.faceArray);\n    }\n  }\n\n  public addFoundation(\n    filler: Filler,\n    foundationDat: StickerDatSticker,\n    black: number,\n  ) {\n    makePoly(\n      filler,\n      foundationDat.coords as number[][],\n      black,\n      0.999,\n      2,\n      this.faceArray,\n    );\n  }\n\n  public setAppearance(\n    faceletMeshAppearance: ExperimentalFaceletMeshAppearance,\n  ): void {\n    switch (faceletMeshAppearance) {\n      case \"regular\":\n        this.origColorAppearance = this.origColor;\n        break;\n      case \"dim\":\n        if (this.origColor === 0xffffff) {\n          this.origColorAppearance = 0xdddddd;\n        } else {\n          this.origColorAppearance = new Color(this.origColor)\n            .multiplyScalar(0.5)\n            .getHex();\n        }\n        break;\n      case \"oriented\":\n        this.origColorAppearance = 0xff88ff;\n        break;\n      case \"ignored\":\n        this.origColorAppearance = 0x444444;\n        break;\n      case \"invisible\":\n        throw new Error(\"unimplemented\");\n    }\n  }\n\n  public setColor(c: number): number {\n    if (this.faceColor !== c) {\n      this.faceColor = c;\n      const r = c >> 16;\n      const g = (c >> 8) & 255;\n      const b = c & 255;\n      for (const f of this.faceArray) {\n        for (let i = 0; i < 9; i += 3) {\n          this.filler.colors[9 * f + i] = r;\n          this.filler.colors[9 * f + i + 1] = g;\n          this.filler.colors[9 * f + i + 2] = b;\n        }\n      }\n      return 1;\n    } else {\n      return 0;\n    }\n  }\n}\n\nclass HitPlaneDef {\n  public cubie: Group;\n  protected geo: BufferGeometry;\n  constructor(hitface: any) {\n    this.cubie = new Group();\n    const coords = hitface.coords as number[][];\n    const filler = new Filler(coords.length - 2, true);\n    for (let g = 1; g + 1 < coords.length; g++) {\n      filler.addUncolored(coords[0]);\n      filler.addUncolored(coords[g]);\n      filler.addUncolored(coords[g + 1]);\n    }\n    this.geo = new BufferGeometry();\n    filler.setAttributes(this.geo);\n    const obj = new Mesh(this.geo, polyMaterial);\n    obj.userData.name = hitface.name;\n    this.cubie.scale.setScalar(0.99);\n    this.cubie.add(obj);\n  }\n}\n\nclass AxisInfo {\n  public axis: Vector3;\n  public order: number;\n  constructor(axisDat: any) {\n    const vec = axisDat[0] as number[];\n    this.axis = new Vector3(vec[0], vec[1], vec[2]);\n    this.order = axisDat[2];\n  }\n}\n\nexport interface PG3DOptions {\n  appearance?: ExperimentalPuzzleAppearance;\n}\n\nconst PG_SCALE = 0.5;\n\n// TODO: Split into \"scene model\" and \"view\".\n/*\n *  PG3D uses a single geometry for the puzzle, with all the faces for\n *  each sticker (including the foundation stickers) in a single\n *  geometry.  We use the materialIndex in the face to point to a\n *  specific entry, which is either a colored sticker, invisible, or\n *  black (foundation).\n *\n *  To support general twisting of a subset of the puzzle, we then\n *  instantiate this same geometry in two different meshes with two\n *  distinct material arrays.  One, the fixed mesh, has the material\n *  array set up like:  [colored, invisible, black, invisible].\n *  The twisting mesh has the material array set up as\n *  [invisible, colored, invislble, black].  When not twisted, the\n *  two meshes are directly coincident, and the (shared) materialIndex\n *  in each face points to a non-invisible material in exactly one of\n *  the two meshes.  When we decide to twist some cubies, we make\n *  the cubies that move point to visible materials in the moving\n *  mesh (which makes them point to invisible materials in the static\n *  mesh).  This way, we only need to rotate the moving mesh as a\n *  single object---this should be very fast, and occur entirely in\n *  the GPU.  Unfortunately this doesn't quite work as fast as we'd\n *  like because three.js makes a draw call every time we have a change\n *  in the material index.  By moving the foundation triangles separate\n *  from the sticker triangles, we enhance the probability that many\n *  triangles can be rendered in one call speeding up the render.\n *\n *  When we decide to support multiple subsets moving at distinct\n *  angular velocities, we will use more than two meshes, with\n *  larger material arrays, maintaining the invariant that each cubie\n *  is visible in only a single mesh.\n */\nexport class PG3D extends Object3D implements Twisty3DPuzzle {\n  private stickers: { [key: string]: StickerDef[][] };\n  private axesInfo: { [key: string]: AxisInfo };\n\n  private stickerTargets: Object3D[] = [];\n  private controlTargets: Object3D[] = [];\n\n  protected movingObj: Object3D;\n  protected filler: Filler;\n  protected foundationBound: number; // before this: colored; after: black\n  protected fixedGeo: BufferGeometry;\n  protected lastPos: PuzzlePosition;\n  protected lastMove: Transformation;\n\n  #pendingStickeringUpdate: boolean = false;\n\n  constructor(\n    cursor: AlgCursor,\n    private scheduleRenderCallback: () => void,\n    private definition: KPuzzleDefinition,\n    private pgdat: StickerDat,\n    showFoundation: boolean = false,\n    hintStickers: boolean = false,\n    private params: PG3DOptions = {},\n  ) {\n    super();\n\n    this.axesInfo = {};\n    const axesDef = this.pgdat.axis as any[];\n    for (const axis of axesDef) {\n      this.axesInfo[axis[1]] = new AxisInfo(axis);\n    }\n    const stickers = this.pgdat.stickers as any[];\n    this.stickers = {};\n    const materialArray1 = [\n      stickerMaterial,\n      polyMaterial,\n      foundationMaterial,\n      polyMaterial,\n    ];\n    const materialArray2 = [\n      polyMaterial,\n      stickerMaterial,\n      polyMaterial,\n      foundationMaterial,\n    ];\n    let triangleCount = 0;\n    let multiplier = 1;\n    if (hintStickers) {\n      multiplier++;\n    }\n    if (showFoundation) {\n      multiplier++;\n    }\n    for (let si = 0; si < stickers.length; si++) {\n      const sides = stickers[si].coords.length;\n      triangleCount += multiplier * (sides - 2);\n    }\n    const filler = new Filler(triangleCount);\n    const black = 0;\n    for (let si = 0; si < stickers.length; si++) {\n      const sticker = stickers[si];\n      const orbit = sticker.orbit as string;\n      const ord = sticker.ord as number;\n      const ori = sticker.ori as number;\n      if (!this.stickers[orbit]) {\n        this.stickers[orbit] = [];\n      }\n      if (!this.stickers[orbit][ori]) {\n        this.stickers[orbit][ori] = [];\n      }\n      const options: { appearance?: ExperimentalFaceletMeshAppearance } = {};\n      if (params.appearance) {\n        options.appearance = experimentalGetFaceletAppearance(\n          params.appearance,\n          orbit,\n          ord,\n          ori,\n          false,\n        );\n      }\n      const stickerdef = new StickerDef(filler, sticker, hintStickers, options);\n      this.stickers[orbit][ori][ord] = stickerdef;\n    }\n    this.foundationBound = filler.ipos;\n    if (showFoundation) {\n      for (let si = 0; si < stickers.length; si++) {\n        const sticker = stickers[si];\n        const foundation = this.pgdat.foundations[si];\n        const orbit = sticker.orbit as number;\n        const ord = sticker.ord as number;\n        const ori = sticker.ori as number;\n        this.stickers[orbit][ori][ord].addFoundation(filler, foundation, black);\n      }\n    }\n    const fixedGeo = new BufferGeometry();\n    filler.setAttributes(fixedGeo);\n    filler.makeGroups(fixedGeo);\n    const obj = new Mesh(fixedGeo, materialArray1);\n    obj.scale.set(PG_SCALE, PG_SCALE, PG_SCALE);\n    this.add(obj);\n    const obj2 = new Mesh(fixedGeo, materialArray2);\n    obj2.scale.set(PG_SCALE, PG_SCALE, PG_SCALE);\n    this.add(obj2);\n    const hitfaces = this.pgdat.faces as any[];\n    this.movingObj = obj2;\n    this.fixedGeo = fixedGeo;\n    this.filler = filler;\n    for (const hitface of hitfaces) {\n      const facedef = new HitPlaneDef(hitface);\n      facedef.cubie.scale.set(PG_SCALE, PG_SCALE, PG_SCALE);\n      this.add(facedef.cubie);\n      this.controlTargets.push(facedef.cubie.children[0]);\n    }\n    cursor!.addPositionListener(this);\n  }\n\n  public dispose(): void {\n    if (this.fixedGeo) {\n      this.fixedGeo.dispose();\n    }\n  }\n\n  public experimentalGetStickerTargets(): Object3D[] {\n    return this.stickerTargets;\n  }\n\n  public experimentalGetControlTargets(): Object3D[] {\n    return this.controlTargets;\n  }\n\n  experimentalSetAppearance(appearance: ExperimentalPuzzleAppearance): void {\n    this.params.appearance = appearance;\n    for (const orbitName in this.definition.orbits) {\n      const { numPieces, orientations } = this.definition.orbits[orbitName];\n      for (let pieceIdx = 0; pieceIdx < numPieces; pieceIdx++) {\n        for (let faceletIdx = 0; faceletIdx < orientations; faceletIdx++) {\n          const faceletAppearance = experimentalGetFaceletAppearance(\n            appearance,\n            orbitName,\n            pieceIdx,\n            faceletIdx,\n            false,\n          );\n          const stickerDef = this.stickers[orbitName][faceletIdx][pieceIdx];\n          stickerDef.setAppearance(faceletAppearance);\n        }\n      }\n    }\n    if (this.scheduleRenderCallback) {\n      this.#pendingStickeringUpdate = true;\n      this.onPositionChange(this.lastPos);\n      this.scheduleRenderCallback();\n    }\n  }\n\n  public onPositionChange(p: PuzzlePosition): void {\n    const state = p.state as Transformation;\n    const noRotation = new Euler();\n    this.movingObj.rotation.copy(noRotation);\n    let colormods = 0;\n    if (\n      !this.lastPos ||\n      this.#pendingStickeringUpdate ||\n      !areTransformationsEquivalent(this.definition, this.lastPos.state, state)\n    ) {\n      for (const orbit in this.stickers) {\n        const pieces = this.stickers[orbit];\n        const pos2 = state[orbit];\n        const orin = pieces.length;\n        if (orin === 1) {\n          const pieces2 = pieces[0];\n          for (let i = 0; i < pieces2.length; i++) {\n            const ni = pos2.permutation[i];\n            colormods += pieces2[i].setColor(pieces2[ni].origColorAppearance);\n          }\n        } else {\n          for (let ori = 0; ori < orin; ori++) {\n            const pieces2 = pieces[ori];\n            for (let i = 0; i < pieces2.length; i++) {\n              const nori = (ori + orin - pos2.orientation[i]) % orin;\n              const ni = pos2.permutation[i];\n              colormods += pieces2[i].setColor(\n                pieces[nori][ni].origColorAppearance,\n              );\n            }\n          }\n        }\n      }\n      this.lastPos = p;\n      this.#pendingStickeringUpdate = false;\n    }\n    let vismods = 0;\n    for (const moveProgress of p.movesInProgress) {\n      const externalMove = moveProgress.move;\n      // TODO: unswizzle goes external to internal, and so does the call after that\n      // and so does the stateForBlockMove call\n      const unswizzled = this.pgdat.unswizzle(externalMove);\n      const move = this.pgdat.notationMapper.notationToInternal(externalMove);\n      if (move === null) {\n        throw Error(\"Bad blockmove \" + externalMove.family);\n      }\n      const quantumTransformation = experimentalTransformationForQuantumMove(\n        this.definition,\n        externalMove.quantum,\n      );\n      const ax = this.axesInfo[unswizzled];\n      const turnNormal = ax.axis;\n      const angle =\n        (-this.ease(moveProgress.fraction) *\n          moveProgress.direction *\n          move.effectiveAmount *\n          TAU) /\n        ax.order;\n      this.movingObj.rotateOnAxis(turnNormal, angle);\n      if (this.lastMove !== quantumTransformation) {\n        for (const orbit in this.stickers) {\n          const pieces = this.stickers[orbit];\n          const orin = pieces.length;\n          const bmv = quantumTransformation[orbit];\n          for (let ori = 0; ori < orin; ori++) {\n            const pieces2 = pieces[ori];\n            for (let i = 0; i < pieces2.length; i++) {\n              const ni = bmv.permutation[i];\n              let tv = 0;\n              if (ni !== i || bmv.orientation[i] !== 0) {\n                tv = 1;\n              }\n              if (tv !== pieces2[i].twistVal) {\n                if (tv) {\n                  for (const f of pieces2[i].faceArray) {\n                    this.filler.ind[f] |= 1;\n                  }\n                } else {\n                  for (const f of pieces2[i].faceArray) {\n                    this.filler.ind[f] &= ~1;\n                  }\n                }\n                pieces2[i].twistVal = tv;\n                vismods++;\n              }\n            }\n          }\n        }\n        this.lastMove = quantumTransformation;\n      }\n    }\n    if (vismods) {\n      this.filler.makeGroups(this.fixedGeo);\n    }\n    if (colormods) {\n      (this.fixedGeo.getAttribute(\"color\") as BufferAttribute).updateRange = {\n        offset: 0,\n        count: 9 * this.foundationBound,\n      };\n      (this.fixedGeo.getAttribute(\n        \"color\",\n      ) as BufferAttribute).needsUpdate = true;\n    }\n    this.scheduleRenderCallback!();\n  }\n\n  private ease(fraction: number): number {\n    return smootherStep(fraction);\n  }\n}\n","import { Scene as ThreeScene } from \"three\";\nimport { Twisty3DPuzzle } from \"./puzzles/Twisty3DPuzzle\";\nimport { Twisty3DRenderTarget } from \"./Twisty3DRenderTarget\";\n\nexport class Twisty3DScene extends ThreeScene implements Twisty3DRenderTarget {\n  private renderTargets: Set<Twisty3DRenderTarget> = new Set();\n  public twisty3Ds: Set<Twisty3DPuzzle> = new Set();\n\n  constructor() {\n    super();\n  }\n\n  addRenderTarget(renderTarget: Twisty3DRenderTarget): void {\n    this.renderTargets.add(renderTarget);\n  }\n\n  scheduleRender(): void {\n    for (const renderTarget of this.renderTargets) {\n      renderTarget.scheduleRender();\n    }\n  }\n\n  addTwisty3DPuzzle(twisty3DPuzzle: Twisty3DPuzzle): void {\n    this.twisty3Ds.add(twisty3DPuzzle);\n    this.add(twisty3DPuzzle);\n    // TODO: scheduleRender?\n  }\n\n  removeTwisty3DPuzzle(twisty3DPuzzle: Twisty3DPuzzle): void {\n    this.twisty3Ds.delete(twisty3DPuzzle);\n    this.remove(twisty3DPuzzle);\n    // TODO: scheduleRender?\n  }\n\n  clearPuzzles(): void {\n    for (const puz of this.twisty3Ds) {\n      this.remove(puz);\n    }\n    this.twisty3Ds.clear();\n    // TODO: scheduleRender?\n  }\n}\n","/* eslint-disable no-case-declarations */\n// TODO: private vs. public properties/methods.\n// TODO: optional construtor arguments for DOM elements\n// TODO: figure out what can be moved into a worker using OffscreenCanvas https://developers.google.com/web/updates/2018/08/offscreen-canvas\n\n/* eslint-disable @typescript-eslint/no-empty-interface */\n\n// start of imports\nimport { Alg } from \"../../../alg\";\nimport { KPuzzle, KPuzzleDefinition, Transformation } from \"../../../kpuzzle\";\nimport { KPuzzleWrapper } from \"../../3D/puzzles/KPuzzleWrapper\";\nimport { AlgIndexer } from \"../indexer/AlgIndexer\";\nimport { TreeAlgIndexer } from \"../indexer/tree/TreeAlgIndexer\";\nimport { Timeline, TimelineTimestampListener } from \"../Timeline\";\nimport {\n  Direction,\n  directionScalar,\n  MillisecondTimestamp,\n  PuzzlePosition,\n} from \"./CursorTypes\";\n// end of imports\n\n// Model\n\nexport interface PositionListener {\n  onPositionChange(position: PuzzlePosition): void;\n}\n\nexport interface PositionDispatcher {\n  addPositionListener(positionListener: PositionListener): void;\n}\n\nexport interface TimeRange {\n  start: MillisecondTimestamp;\n  end: MillisecondTimestamp;\n}\n\nexport type IndexerConstructor = new (\n  puzzle: KPuzzleWrapper,\n  alg: Alg,\n) => AlgIndexer<KPuzzleWrapper>;\n\nexport class AlgCursor\n  implements TimelineTimestampListener, PositionDispatcher {\n  private indexer: AlgIndexer<KPuzzleWrapper>;\n  private positionListeners: Set<PositionListener> = new Set(); // TODO: accessor instead of direct access\n  private ksolvePuzzle: KPuzzleWrapper;\n  private startState: Transformation;\n  private indexerConstructor: IndexerConstructor = TreeAlgIndexer;\n  constructor(\n    private timeline: Timeline,\n    private def: KPuzzleDefinition,\n    private alg: Alg,\n    startStateAlg?: Alg, // TODO: accept actual start state\n    indexerConstructor?: IndexerConstructor,\n  ) {\n    this.ksolvePuzzle = new KPuzzleWrapper(def);\n    if (indexerConstructor) {\n      this.indexerConstructor = this.indexerConstructor;\n    }\n    this.instantiateIndexer(alg);\n    this.startState = startStateAlg\n      ? this.algToState(startStateAlg)\n      : this.ksolvePuzzle.startState();\n    timeline.addTimestampListener(this);\n  }\n\n  setStartState(startState: Transformation): void {\n    this.startState = startState;\n    this.dispatchPositionForTimestamp(this.timeline.timestamp);\n  }\n\n  /** @deprecated */\n  public experimentalSetIndexer(indexerConstructor: IndexerConstructor): void {\n    this.indexerConstructor = indexerConstructor;\n    this.instantiateIndexer(this.alg);\n    this.timeline.onCursorChange(this);\n    this.dispatchPositionForTimestamp(this.timeline.timestamp);\n  }\n\n  private instantiateIndexer(alg: Alg): void {\n    this.indexer = new this.indexerConstructor(this.ksolvePuzzle, alg);\n  }\n\n  /** @deprecated */\n  algToState(s: Alg): Transformation {\n    const kpuzzle = new KPuzzle(this.def);\n    kpuzzle.applyAlg(s);\n    return this.ksolvePuzzle.combine(this.def.startPieces, kpuzzle.state);\n  }\n\n  timeRange(): TimeRange {\n    return {\n      start: 0,\n      end: this.indexer.algDuration(),\n    };\n  }\n\n  /** @deprecated */\n  experimentalTimestampForStartOfLastMove(): MillisecondTimestamp {\n    const numMoves = this.indexer.numMoves();\n    if (numMoves > 0) {\n      return this.indexer.indexToMoveStartTimestamp(numMoves - 1);\n    }\n    return 0;\n  }\n\n  addPositionListener(positionListener: PositionListener): void {\n    this.positionListeners.add(positionListener);\n    this.dispatchPositionForTimestamp(this.timeline.timestamp, [\n      positionListener,\n    ]); // TODO: should this be a separate dispatch, or should the listener manually ask for the position?\n  }\n\n  removePositionListener(positionListener: PositionListener): void {\n    this.positionListeners.delete(positionListener);\n  }\n\n  onTimelineTimestampChange(timestamp: MillisecondTimestamp): void {\n    this.dispatchPositionForTimestamp(timestamp);\n  }\n\n  private dispatchPositionForTimestamp(\n    timestamp: MillisecondTimestamp,\n    listeners: PositionListener[] | Set<PositionListener> = this\n      .positionListeners,\n  ): void {\n    let position: PuzzlePosition;\n    if (this.indexer.timestampToPosition) {\n      position = this.indexer.timestampToPosition(timestamp, this.startState);\n    } else {\n      const idx = this.indexer.timestampToIndex(timestamp);\n      const state = this.indexer.stateAtIndex(idx, this.startState) as any; // TODO\n      position = {\n        state,\n        movesInProgress: [],\n      };\n\n      if (this.indexer.numMoves() > 0) {\n        const fraction =\n          (timestamp - this.indexer.indexToMoveStartTimestamp(idx)) /\n          this.indexer.moveDuration(idx);\n        if (fraction === 1) {\n          // TODO: push this into the indexer\n          position.state = this.ksolvePuzzle.combine(\n            state,\n            this.ksolvePuzzle.stateFromMove(this.indexer.getMove(idx)!),\n          ) as Transformation;\n        } else if (fraction > 0) {\n          const move = this.indexer.getMove(idx);\n          if (move) {\n            position.movesInProgress.push({\n              move,\n              direction: Direction.Forwards,\n              fraction,\n            });\n          }\n        }\n      }\n    }\n\n    for (const listener of listeners) {\n      listener.onPositionChange(position);\n    }\n  }\n\n  onTimeRangeChange(_timeRange: TimeRange): void {\n    // nothing to do\n  }\n\n  setAlg(alg: Alg, indexerConstructor?: IndexerConstructor): void {\n    indexerConstructor ??= this.indexerConstructor;\n    if (\n      alg.isIdentical(this.alg) &&\n      this.indexerConstructor === indexerConstructor\n    ) {\n      // TODO: this is a hacky optimization.\n      return;\n    }\n    this.indexerConstructor = indexerConstructor;\n    this.alg = alg;\n    this.instantiateIndexer(alg);\n    this.timeline.onCursorChange(this);\n    this.dispatchPositionForTimestamp(this.timeline.timestamp);\n    // TODO: Handle state change.\n  }\n\n  moveBoundary(\n    timestamp: MillisecondTimestamp,\n    direction: Direction.Backwards | Direction.Forwards,\n  ): MillisecondTimestamp | null {\n    if (this.indexer.numMoves() === 0) {\n      return null;\n    }\n    // TODO: define semantics of indexing edge cases and remove this hack.\n    const offsetHack = directionScalar(direction) * 0.001;\n    const idx = this.indexer.timestampToIndex(timestamp + offsetHack);\n    const moveStart = this.indexer.indexToMoveStartTimestamp(idx);\n\n    if (direction === Direction.Backwards) {\n      return timestamp >= moveStart ? moveStart : null;\n    } else {\n      const moveEnd = moveStart + this.indexer.moveDuration(idx);\n      return timestamp <= moveEnd ? moveEnd : null;\n    }\n  }\n\n  setPuzzle(\n    def: KPuzzleDefinition,\n    alg: Alg = this.alg,\n    startStateAlg?: Alg,\n  ): void {\n    this.ksolvePuzzle = new KPuzzleWrapper(def);\n    this.def = def;\n    this.indexer = new this.indexerConstructor(this.ksolvePuzzle, alg);\n    if (alg !== this.alg) {\n      this.timeline.onCursorChange(this);\n    }\n    this.setStartState(\n      startStateAlg\n        ? this.algToState(startStateAlg)\n        : this.ksolvePuzzle.startState(),\n    );\n    this.alg = alg;\n  }\n\n  /** @deprecated */\n  experimentalTimestampFromIndex(index: number): MillisecondTimestamp {\n    return this.indexer.indexToMoveStartTimestamp(index);\n  }\n\n  /** @deprecated */\n  experimentalIndexFromTimestamp(timestamp: MillisecondTimestamp): number {\n    return this.indexer.timestampToIndex(timestamp);\n  }\n}\n","import { Move } from \"../../../alg\";\nimport {\n  combineTransformations,\n  areStatesEquivalent,\n  identityTransformation,\n  invertTransformation,\n  KPuzzleDefinition,\n  transformationForMove,\n  Transformation,\n} from \"../../../kpuzzle\";\nimport { puzzles } from \"../../../puzzles\";\n\nexport type MoveName = string;\n\nexport interface MoveProgress {\n  move: Move;\n  fraction: number;\n}\n\n// tslint:disable-next-line no-empty-interfaces\n// eslint-disable-next-line @typescript-eslint/no-empty-interface, @typescript-eslint/no-unused-vars-experimental\nexport interface State<T extends PuzzleWrapper> {}\n\nexport abstract class PuzzleWrapper {\n  public abstract startState(): State<PuzzleWrapper>;\n  public abstract invert(state: State<PuzzleWrapper>): State<PuzzleWrapper>;\n  public abstract combine(\n    s1: State<PuzzleWrapper>,\n    s2: State<PuzzleWrapper>,\n  ): State<PuzzleWrapper>;\n\n  public multiply(\n    state: State<PuzzleWrapper>,\n    amount: number,\n  ): State<PuzzleWrapper> {\n    if (amount < 0) {\n      return this.invert(this.multiply(state, -amount));\n    }\n    if (amount === 0) {\n      return this.identity();\n    }\n    while (amount % 2 === 0) {\n      amount = amount / 2;\n      state = this.combine(state, state);\n    }\n    let newState = state;\n    amount--;\n    while (amount > 0) {\n      if (amount % 2 === 1) {\n        newState = this.combine(newState, state);\n      }\n      amount = Math.floor(amount / 2);\n      if (amount > 0) {\n        state = this.combine(state, state);\n      }\n    }\n    return newState;\n  }\n\n  public abstract stateFromMove(move: Move): State<PuzzleWrapper>;\n  public abstract identity(): State<PuzzleWrapper>;\n  public abstract equivalent(\n    s1: State<PuzzleWrapper>,\n    s2: State<PuzzleWrapper>,\n  ): boolean;\n}\n\ninterface KSolvePuzzleState extends Transformation, State<KPuzzleWrapper> {}\n\nexport class KPuzzleWrapper extends PuzzleWrapper {\n  // don't work the underlying kdefinition/multiply so hard\n  public static async fromID(id: string): Promise<KPuzzleWrapper> {\n    return new KPuzzleWrapper(await puzzles[id].def());\n  }\n\n  public moveCache: { [key: string]: Transformation } = {};\n  constructor(private definition: KPuzzleDefinition) {\n    super();\n  }\n\n  public startState(): KSolvePuzzleState {\n    return this.definition.startPieces;\n  }\n\n  public invert(state: KSolvePuzzleState): KSolvePuzzleState {\n    return invertTransformation(this.definition, state);\n  }\n\n  public combine(\n    s1: KSolvePuzzleState,\n    s2: KSolvePuzzleState,\n  ): KSolvePuzzleState {\n    return combineTransformations(this.definition, s1, s2);\n  }\n\n  public stateFromMove(move: Move): KSolvePuzzleState {\n    const key = move.toString();\n    if (!this.moveCache[key]) {\n      this.moveCache[key] = transformationForMove(this.definition, move);\n    }\n    return this.moveCache[key];\n  }\n\n  public identity(): KSolvePuzzleState {\n    return identityTransformation(this.definition);\n  }\n\n  public equivalent(s1: KSolvePuzzleState, s2: KSolvePuzzleState): boolean {\n    return areStatesEquivalent(this.definition, s1, s2);\n  }\n}\n\nclass QTMCounterState implements State<QTMCounterPuzzle> {\n  constructor(public value: number) {}\n}\n\nexport class QTMCounterPuzzle extends PuzzleWrapper {\n  public startState(): QTMCounterState {\n    return new QTMCounterState(0);\n  }\n\n  public invert(state: QTMCounterState): QTMCounterState {\n    return new QTMCounterState(-state.value);\n  }\n\n  public combine(s1: QTMCounterState, s2: QTMCounterState): QTMCounterState {\n    return new QTMCounterState(s1.value + s2.value);\n  }\n\n  public stateFromMove(move: Move): QTMCounterState {\n    return new QTMCounterState(Math.abs(move.effectiveAmount));\n  }\n\n  public identity(): QTMCounterState {\n    return new QTMCounterState(0);\n  }\n\n  public equivalent(s1: QTMCounterState, s2: QTMCounterState): boolean {\n    return s1.value === s2.value;\n  }\n}\n","import { Alg, Move } from \"../../../../alg\";\nimport { PuzzleWrapper, State } from \"../../../3D/puzzles/KPuzzleWrapper\";\nimport { Duration, Timestamp } from \"../../cursor/CursorTypes\";\nimport { AlgIndexer } from \"../AlgIndexer\";\nimport { chunkAlgs } from \"./chunkAlgs\";\nimport {\n  AlgPartDecoration,\n  AlgWalker,\n  DecoratorConstructor,\n} from \"./AlgWalker\";\n\nexport class TreeAlgIndexer implements AlgIndexer<PuzzleWrapper> {\n  private decoration: AlgPartDecoration<PuzzleWrapper>;\n  private walker: AlgWalker<PuzzleWrapper>;\n  constructor(private puzzle: PuzzleWrapper, alg: Alg) {\n    const deccon = new DecoratorConstructor<PuzzleWrapper>(this.puzzle);\n\n    const chunkedAlg = chunkAlgs(alg);\n\n    this.decoration = deccon.traverseAlg(chunkedAlg);\n    this.walker = new AlgWalker<PuzzleWrapper>(\n      this.puzzle,\n      chunkedAlg,\n      this.decoration,\n    );\n  }\n\n  public getMove(index: number): Move | null {\n    // FIXME need to support Pause\n    if (this.walker.moveByIndex(index)) {\n      if (!this.walker.move) {\n        throw new Error(\"`this.walker.mv` missing\");\n      }\n      const move = this.walker.move as Move;\n      // TODO: this type of negation needs to be in alg\n      if (this.walker.back) {\n        return move.invert();\n      }\n      return move;\n    }\n    return null;\n  }\n\n  public indexToMoveStartTimestamp(index: number): Timestamp {\n    if (this.walker.moveByIndex(index) || this.walker.i === index) {\n      return this.walker.dur;\n    }\n    throw new Error(\"Out of algorithm: index \" + index);\n  }\n\n  public indexToMovesInProgress(index: number): Timestamp {\n    if (this.walker.moveByIndex(index) || this.walker.i === index) {\n      return this.walker.dur;\n    }\n    throw new Error(\"Out of algorithm: index \" + index);\n  }\n\n  public stateAtIndex(\n    index: number,\n    startTransformation?: State<PuzzleWrapper>,\n  ): State<PuzzleWrapper> {\n    this.walker.moveByIndex(index);\n    return this.puzzle.combine(\n      startTransformation ?? this.puzzle.startState(),\n      this.walker.st,\n    );\n  }\n\n  // TransformAtIndex does not reflect the start state; it only reflects\n  // the change from the start state to the current move index.  If you\n  // want the actual state, use stateAtIndex.\n  public transformAtIndex(index: number): State<PuzzleWrapper> {\n    this.walker.moveByIndex(index);\n    return this.walker.st;\n  }\n\n  public numMoves(): number {\n    return this.decoration.moveCount;\n  }\n\n  public timestampToIndex(timestamp: Timestamp): number {\n    this.walker.moveByDuration(timestamp);\n    return this.walker.i;\n  }\n\n  public algDuration(): Duration {\n    return this.decoration.duration;\n  }\n\n  public moveDuration(index: number): number {\n    this.walker.moveByIndex(index);\n    return this.walker.moveDuration;\n  }\n}\n","import {\n  Alg,\n  Commutator,\n  Conjugate,\n  Grouping,\n  LineComment,\n  Move,\n  Newline,\n  Pause,\n  TraversalUp,\n  Unit,\n} from \"../../../../alg\";\nimport { AlgBuilder } from \"../../../../alg\";\n\nconst MIN_CHUNKING_THRESHOLD = 16;\n\nfunction chunkifyAlg(alg: Alg, chunkMaxLength: number): Alg {\n  const mainAlgBuilder = new AlgBuilder();\n  const chunkAlgBuilder = new AlgBuilder();\n  for (const unit of alg.units()) {\n    chunkAlgBuilder.push(unit);\n    if (chunkAlgBuilder.experimentalNumUnits() >= chunkMaxLength) {\n      mainAlgBuilder.push(new Grouping(chunkAlgBuilder.toAlg()));\n      chunkAlgBuilder.reset();\n    }\n  }\n  mainAlgBuilder.push(new Grouping(chunkAlgBuilder.toAlg()));\n  return mainAlgBuilder.toAlg();\n}\n\nclass ChunkAlgs extends TraversalUp<Alg, Unit> {\n  traverseAlg(alg: Alg): Alg {\n    const algLength = alg.experimentalNumUnits();\n    if (algLength < MIN_CHUNKING_THRESHOLD) {\n      return alg;\n    }\n    return chunkifyAlg(alg, Math.ceil(Math.sqrt(algLength)));\n  }\n\n  traverseGrouping(grouping: Grouping): Unit {\n    return new Grouping(\n      this.traverseAlg(grouping.experimentalAlg),\n      grouping.experimentalEffectiveAmount, // TODO\n    );\n  }\n\n  traverseMove(move: Move): Unit {\n    return move;\n  }\n\n  traverseCommutator(commutator: Commutator): Unit {\n    return new Conjugate(\n      this.traverseAlg(commutator.A),\n      this.traverseAlg(commutator.B),\n      commutator.experimentalEffectiveAmount, // TODO\n    );\n  }\n\n  traverseConjugate(conjugate: Conjugate): Unit {\n    return new Conjugate(\n      this.traverseAlg(conjugate.A),\n      this.traverseAlg(conjugate.B),\n      conjugate.experimentalEffectiveAmount, // TODO\n    );\n  }\n\n  traversePause(pause: Pause): Unit {\n    return pause;\n  }\n\n  traverseNewline(newline: Newline): Unit {\n    return newline;\n  }\n\n  traverseLineComment(comment: LineComment): Unit {\n    return comment;\n  }\n}\n\nconst chunkAlgsInstance = new ChunkAlgs();\nexport const chunkAlgs = chunkAlgsInstance.traverseAlg.bind(\n  chunkAlgsInstance,\n) as (alg: Alg) => Alg;\n","import {\n  Alg,\n  Grouping,\n  LineComment,\n  Commutator,\n  Conjugate,\n  Move,\n  Newline,\n  Pause,\n  TraversalDownUp,\n  TraversalUp,\n  Unit,\n} from \"../../../../alg\";\nimport {\n  experimentalDirectedGenerator,\n  ExperimentalIterationDirection,\n} from \"../../../../alg\";\nimport { PuzzleWrapper, State } from \"../../../3D/puzzles/KPuzzleWrapper\";\nimport { Duration } from \"../../cursor/CursorTypes\";\nimport { AlgDuration, defaultDurationForAmount } from \"../AlgDuration\";\n\nexport class AlgPartDecoration<P extends PuzzleWrapper> {\n  constructor(\n    _puz: PuzzleWrapper,\n    public moveCount: number,\n    public duration: number,\n    public forward: State<P>,\n    public backward: State<P>,\n    public children: Array<AlgPartDecoration<P>> = [],\n  ) {}\n}\nexport class DecoratorConstructor<P extends PuzzleWrapper> extends TraversalUp<\n  AlgPartDecoration<P>\n> {\n  private identity: State<P>;\n  private dummyLeaf: AlgPartDecoration<P>;\n  private durationFn: TraversalUp<Duration> = new AlgDuration(\n    defaultDurationForAmount,\n  );\n\n  private cache: { [key: string]: AlgPartDecoration<P> } = {};\n\n  constructor(private puz: PuzzleWrapper) {\n    super();\n    this.identity = puz.identity();\n    this.dummyLeaf = new AlgPartDecoration<P>(\n      puz,\n      0,\n      0,\n      this.identity,\n      this.identity,\n      [],\n    );\n  }\n\n  public traverseAlg(alg: Alg): AlgPartDecoration<P> {\n    let moveCount = 0;\n    let duration = 0;\n    let state = this.identity;\n    const child: Array<AlgPartDecoration<P>> = [];\n    for (const unit of alg.units()) {\n      const apd = this.traverseUnit(unit);\n      moveCount += apd.moveCount;\n      duration += apd.duration;\n      if (state === this.identity) {\n        state = apd.forward;\n      } else {\n        state = this.puz.combine(state, apd.forward);\n      }\n      child.push(apd);\n    }\n    return new AlgPartDecoration<P>(\n      this.puz,\n      moveCount,\n      duration,\n      state,\n      this.puz.invert(state),\n      child,\n    );\n  }\n\n  public traverseGrouping(grouping: Grouping): AlgPartDecoration<P> {\n    const dec = this.traverseAlg(grouping.experimentalAlg);\n    return this.mult(dec, grouping.experimentalEffectiveAmount, [dec]);\n  }\n\n  public traverseMove(move: Move): AlgPartDecoration<P> {\n    const key = move.toString();\n    let r: AlgPartDecoration<P> | undefined = this.cache[key];\n    if (r) {\n      return r;\n    }\n    r = new AlgPartDecoration<P>(\n      this.puz,\n      1,\n      this.durationFn.traverseUnit(move),\n      this.puz.stateFromMove(move),\n      this.puz.stateFromMove(move.invert()),\n    );\n    this.cache[key] = r;\n    return r;\n  }\n\n  public traverseCommutator(commutator: Commutator): AlgPartDecoration<P> {\n    const decA = this.traverseAlg(commutator.A);\n    const decB = this.traverseAlg(commutator.B);\n    const AB = this.puz.combine(decA.forward, decB.forward);\n    const ApBp = this.puz.combine(decA.backward, decB.backward);\n    const ABApBp = this.puz.combine(AB, ApBp);\n    const dec = new AlgPartDecoration<P>(\n      this.puz,\n      2 * (decA.moveCount + decB.moveCount),\n      2 * (decA.duration + decB.duration),\n      ABApBp,\n      this.puz.invert(ABApBp),\n      [decA, decB],\n    );\n    return this.mult(dec, commutator.experimentalEffectiveAmount, [\n      dec,\n      decA,\n      decB,\n    ]);\n  }\n\n  public traverseConjugate(conjugate: Conjugate): AlgPartDecoration<P> {\n    const decA = this.traverseAlg(conjugate.A);\n    const decB = this.traverseAlg(conjugate.B);\n    const AB = this.puz.combine(decA.forward, decB.forward);\n    const ABAp = this.puz.combine(AB, decA.backward);\n    const dec = new AlgPartDecoration<P>(\n      this.puz,\n      2 * decA.moveCount + decB.moveCount,\n      2 * decA.duration + decB.duration,\n      ABAp,\n      this.puz.invert(ABAp),\n      [decA, decB],\n    );\n    return this.mult(dec, conjugate.experimentalEffectiveAmount, [\n      dec,\n      decA,\n      decB,\n    ]);\n  }\n\n  public traversePause(pause: Pause): AlgPartDecoration<P> {\n    return new AlgPartDecoration<P>(\n      this.puz,\n      1,\n      this.durationFn.traverseUnit(pause),\n      this.identity,\n      this.identity,\n    );\n  }\n\n  public traverseNewline(_newline: Newline): AlgPartDecoration<P> {\n    return this.dummyLeaf;\n  }\n\n  public traverseLineComment(_comment: LineComment): AlgPartDecoration<P> {\n    return this.dummyLeaf;\n  }\n\n  private mult(\n    apd: AlgPartDecoration<P>,\n    n: number,\n    child: Array<AlgPartDecoration<P>>,\n  ): AlgPartDecoration<P> {\n    const absn = Math.abs(n);\n    const st = this.puz.multiply(apd.forward, n);\n    return new AlgPartDecoration<P>(\n      this.puz,\n      apd.moveCount * absn,\n      apd.duration * absn,\n      st,\n      this.puz.invert(st),\n      child,\n    );\n  }\n}\nclass WalkerDown<P extends PuzzleWrapper> {\n  constructor(public apd: AlgPartDecoration<P>, public back: boolean) {\n    /**/\n  }\n}\nexport class AlgWalker<P extends PuzzleWrapper> extends TraversalDownUp<\n  WalkerDown<P>,\n  boolean\n> {\n  public move?: Unit;\n  public moveDuration: number;\n  public back: boolean;\n  public st: State<P>;\n  public root: WalkerDown<P>;\n  public i: number;\n  public dur: number;\n  private goali: number;\n  private goaldur: number;\n  constructor(\n    public puz: P,\n    public algOrUnit: Alg | Unit, // TODO: can we keep these separate?\n    public apd: AlgPartDecoration<P>,\n  ) {\n    super();\n    this.i = -1;\n    this.dur = -1;\n    this.goali = -1;\n    this.goaldur = -1;\n    this.move = undefined;\n    this.back = false;\n    this.moveDuration = 0;\n    this.st = this.puz.identity();\n    this.root = new WalkerDown(this.apd, false);\n  }\n\n  public moveByIndex(loc: number): boolean {\n    if (this.i >= 0 && this.i === loc) {\n      return this.move !== undefined;\n    }\n    return this.dosearch(loc, Infinity);\n  }\n\n  public moveByDuration(dur: number): boolean {\n    if (\n      this.dur >= 0 &&\n      this.dur < dur &&\n      this.dur + this.moveDuration >= dur\n    ) {\n      return this.move !== undefined;\n    }\n    return this.dosearch(Infinity, dur);\n  }\n\n  public dosearch(loc: number, dur: number): boolean {\n    this.goali = loc;\n    this.goaldur = dur;\n    this.i = 0;\n    this.dur = 0;\n    this.move = undefined;\n    this.moveDuration = 0;\n    this.back = false;\n    this.st = this.puz.identity();\n    const r = this.algOrUnit.is(Alg)\n      ? this.traverseAlg(this.algOrUnit as Alg, this.root)\n      : this.traverseUnit(this.algOrUnit as Unit, this.root); // TODO\n    return r;\n  }\n\n  public traverseAlg(alg: Alg, wd: WalkerDown<P>): boolean {\n    if (!this.firstcheck(wd)) {\n      return false;\n    }\n    let i = wd.back ? alg.experimentalNumUnits() - 1 : 0;\n    for (const unit of experimentalDirectedGenerator(\n      alg.units(),\n      wd.back\n        ? ExperimentalIterationDirection.Backwards\n        : ExperimentalIterationDirection.Forwards,\n    )) {\n      if (\n        this.traverseUnit(unit, new WalkerDown(wd.apd.children[i], wd.back))\n      ) {\n        return true;\n      }\n      i += wd.back ? -1 : 1;\n    }\n    return false;\n  }\n\n  public traverseGrouping(grouping: Grouping, wd: WalkerDown<P>): boolean {\n    if (!this.firstcheck(wd)) {\n      return false;\n    }\n    const back = this.domult(wd, grouping.experimentalEffectiveAmount);\n    return this.traverseAlg(\n      grouping.experimentalAlg,\n      new WalkerDown(wd.apd.children[0], back),\n    );\n  }\n\n  public traverseMove(move: Move, wd: WalkerDown<P>): boolean {\n    if (!this.firstcheck(wd)) {\n      return false;\n    }\n    this.move = move;\n    this.moveDuration = wd.apd.duration;\n    this.back = wd.back;\n    return true;\n  }\n\n  public traverseCommutator(\n    commutator: Commutator,\n    wd: WalkerDown<P>,\n  ): boolean {\n    if (!this.firstcheck(wd)) {\n      return false;\n    }\n    const back = this.domult(wd, commutator.experimentalEffectiveAmount);\n    if (back) {\n      return (\n        this.traverseAlg(\n          commutator.B,\n          new WalkerDown(wd.apd.children[2], !back),\n        ) ||\n        this.traverseAlg(\n          commutator.A,\n          new WalkerDown(wd.apd.children[1], !back),\n        ) ||\n        this.traverseAlg(\n          commutator.B,\n          new WalkerDown(wd.apd.children[2], back),\n        ) ||\n        this.traverseAlg(commutator.A, new WalkerDown(wd.apd.children[1], back))\n      );\n    } else {\n      return (\n        this.traverseAlg(\n          commutator.A,\n          new WalkerDown(wd.apd.children[1], back),\n        ) ||\n        this.traverseAlg(\n          commutator.B,\n          new WalkerDown(wd.apd.children[2], back),\n        ) ||\n        this.traverseAlg(\n          commutator.A,\n          new WalkerDown(wd.apd.children[1], !back),\n        ) ||\n        this.traverseAlg(\n          commutator.B,\n          new WalkerDown(wd.apd.children[2], !back),\n        )\n      );\n    }\n  }\n\n  public traverseConjugate(conjugate: Conjugate, wd: WalkerDown<P>): boolean {\n    if (!this.firstcheck(wd)) {\n      return false;\n    }\n    const back = this.domult(wd, conjugate.experimentalEffectiveAmount);\n    if (back) {\n      return (\n        this.traverseAlg(\n          conjugate.A,\n          new WalkerDown(wd.apd.children[1], !back),\n        ) ||\n        this.traverseAlg(\n          conjugate.B,\n          new WalkerDown(wd.apd.children[2], back),\n        ) ||\n        this.traverseAlg(conjugate.A, new WalkerDown(wd.apd.children[1], back))\n      );\n    } else {\n      return (\n        this.traverseAlg(\n          conjugate.A,\n          new WalkerDown(wd.apd.children[1], back),\n        ) ||\n        this.traverseAlg(\n          conjugate.B,\n          new WalkerDown(wd.apd.children[2], back),\n        ) ||\n        this.traverseAlg(conjugate.A, new WalkerDown(wd.apd.children[1], !back))\n      );\n    }\n  }\n\n  public traversePause(pause: Pause, wd: WalkerDown<P>): boolean {\n    if (!this.firstcheck(wd)) {\n      return false;\n    }\n    this.move = pause;\n    this.moveDuration = wd.apd.duration;\n    this.back = wd.back;\n    return true;\n  }\n\n  public traverseNewline(_newline: Newline, _wd: WalkerDown<P>): boolean {\n    return false;\n  }\n\n  public traverseLineComment(\n    _lineComment: LineComment,\n    _wd: WalkerDown<P>,\n  ): boolean {\n    return false;\n  }\n\n  private firstcheck(wd: WalkerDown<P>): boolean {\n    if (\n      wd.apd.moveCount + this.i <= this.goali &&\n      wd.apd.duration + this.dur < this.goaldur\n    ) {\n      return this.keepgoing(wd);\n    }\n    return true;\n  }\n\n  private domult(wd: WalkerDown<P>, amount: number): boolean {\n    let back = wd.back;\n    if (amount === 0) {\n      // I don't believe this will ever happen\n      return back;\n    }\n    if (amount < 0) {\n      back = !back;\n      amount = -amount;\n    }\n    const base = wd.apd.children[0];\n    const full = Math.min(\n      Math.floor((this.goali - this.i) / base.moveCount),\n      Math.ceil((this.goaldur - this.dur) / base.duration - 1),\n    );\n    if (full > 0) {\n      this.keepgoing(new WalkerDown<P>(base, back), full);\n    }\n    return back;\n  }\n\n  private keepgoing(wd: WalkerDown<P>, mul: number = 1): boolean {\n    this.i += mul * wd.apd.moveCount;\n    this.dur += mul * wd.apd.duration;\n    if (mul !== 1) {\n      if (wd.back) {\n        this.st = this.puz.combine(\n          this.st,\n          this.puz.multiply(wd.apd.backward, mul),\n        );\n      } else {\n        this.st = this.puz.combine(\n          this.st,\n          this.puz.multiply(wd.apd.forward, mul),\n        );\n      }\n    } else {\n      if (wd.back) {\n        this.st = this.puz.combine(this.st, wd.apd.backward);\n      } else {\n        this.st = this.puz.combine(this.st, wd.apd.forward);\n      }\n    }\n    return false;\n  }\n}\n","import {\n  Alg,\n  Grouping,\n  LineComment,\n  Commutator,\n  Conjugate,\n  Move,\n  Newline,\n  Pause,\n  TraversalUp,\n} from \"../../../alg\";\nimport { Duration } from \"../cursor/CursorTypes\";\n\nexport function constantDurationForAmount(_amount: number): Duration {\n  return 1000;\n}\n\nexport function defaultDurationForAmount(amount: number): Duration {\n  switch (Math.abs(amount)) {\n    case 0:\n      return 0;\n    case 1:\n      return 1000;\n    case 2:\n      return 1500;\n    default:\n      return 2000;\n  }\n}\n// eslint-disable-next-line no-inner-declarations\nexport function ExperimentalScaledDefaultDurationForAmount(\n  scale: number,\n  amount: number,\n): Duration {\n  switch (Math.abs(amount)) {\n    case 0:\n      return 0;\n    case 1:\n      return scale * 1000;\n    case 2:\n      return scale * 1500;\n    default:\n      return scale * 2000;\n  }\n}\n\nexport class AlgDuration extends TraversalUp<Duration> {\n  // TODO: Pass durationForAmount as Down type instead?\n  constructor(\n    public durationForAmount: (\n      amount: number,\n    ) => Duration = defaultDurationForAmount,\n  ) {\n    super();\n  }\n\n  public traverseAlg(alg: Alg): Duration {\n    let total = 0;\n    for (const unit of alg.units()) {\n      total += this.traverseUnit(unit);\n    }\n    return total;\n  }\n\n  public traverseGrouping(grouping: Grouping): Duration {\n    return (\n      grouping.experimentalEffectiveAmount *\n      this.traverseAlg(grouping.experimentalAlg)\n    );\n  }\n\n  public traverseMove(move: Move): Duration {\n    return this.durationForAmount(move.effectiveAmount);\n  }\n\n  public traverseCommutator(commutator: Commutator): Duration {\n    return (\n      commutator.experimentalEffectiveAmount *\n      2 *\n      (this.traverseAlg(commutator.A) + this.traverseAlg(commutator.B))\n    );\n  }\n\n  public traverseConjugate(conjugate: Conjugate): Duration {\n    return (\n      conjugate.experimentalEffectiveAmount *\n      (2 * this.traverseAlg(conjugate.A) + this.traverseAlg(conjugate.B))\n    );\n  }\n\n  public traversePause(_pause: Pause): Duration {\n    return this.durationForAmount(1);\n  }\n\n  public traverseNewline(_newline: Newline): Duration {\n    return this.durationForAmount(1);\n  }\n\n  public traverseLineComment(_comment: LineComment): Duration {\n    return this.durationForAmount(0);\n  }\n}\n","import { Move } from \"../../../alg\";\nimport { Transformation as KPuzzleState } from \"../../../kpuzzle\";\n\nexport type MillisecondTimestamp = number;\n\n// TODO: unify duration/timstamp types\nexport type Duration = MillisecondTimestamp; // Duration in milliseconds\n// TODO: Extend `number`, introduce MoveSequenceTimestamp vs. EpochTimestamp,\n// force Duration to be a difference.\nexport type Timestamp = MillisecondTimestamp; // Duration since a particular epoch.\n\nexport type Fraction = number; // Value from 0 to 1.\n\n// 1, 0, -1 are used as scalars for `directionScalar` below.\nexport enum Direction {\n  Forwards = 1,\n  Paused = 0,\n  Backwards = -1,\n}\n\nexport function directionScalar(direction: Direction): MillisecondTimestamp {\n  return direction;\n}\n\nexport interface MoveInProgress {\n  move: Move;\n  direction: Direction;\n  fraction: number;\n}\n\nexport type PuzzlePosition = {\n  state: KPuzzleState;\n  movesInProgress: MoveInProgress[];\n};\n\nexport enum BoundaryType {\n  Move,\n  EntireTimeline,\n}\n\n// export type DurationForAmount = (amount: number) => Duration;\n","import { Alg, Move, TraversalUp } from \"../../../alg\";\nimport { countAnimatedMoves } from \"../../../notation\";\nimport { PuzzleWrapper, State } from \"../../3D/puzzles/KPuzzleWrapper\";\nimport { Duration, Timestamp } from \"../cursor/CursorTypes\";\nimport { AlgDuration, defaultDurationForAmount } from \"./AlgDuration\";\nimport { AlgIndexer } from \"./AlgIndexer\";\n\nexport class SimpleAlgIndexer<P extends PuzzleWrapper>\n  implements AlgIndexer<P> {\n  private moves: Alg;\n  // TODO: Allow custom `durationFn`.\n  private durationFn: TraversalUp<Duration> = new AlgDuration(\n    defaultDurationForAmount,\n  );\n\n  constructor(private puzzle: P, alg: Alg) {\n    // TODO: Avoid assuming all base moves are block moves.\n    this.moves = new Alg(alg.experimentalExpand());\n  }\n\n  public getMove(index: number): Move {\n    return Array.from(this.moves.units())[index] as Move; // TODO: perf\n  }\n\n  public indexToMoveStartTimestamp(index: number): Timestamp {\n    const alg = new Alg(Array.from(this.moves.units()).slice(0, index)); // TODO\n    return this.durationFn.traverseAlg(alg);\n  }\n\n  public timestampToIndex(timestamp: Timestamp): number {\n    let cumulativeTime = 0;\n    let i;\n    for (i = 0; i < this.numMoves(); i++) {\n      cumulativeTime += this.durationFn.traverseMove(this.getMove(i));\n      if (cumulativeTime >= timestamp) {\n        return i;\n      }\n    }\n    return i;\n  }\n\n  public stateAtIndex(index: number): State<P> {\n    return this.puzzle.combine(\n      this.puzzle.startState(),\n      this.transformAtIndex(index),\n    );\n  }\n\n  public transformAtIndex(index: number): State<P> {\n    let state = this.puzzle.identity();\n    for (const move of Array.from(this.moves.units()).slice(0, index)) {\n      state = this.puzzle.combine(\n        state,\n        this.puzzle.stateFromMove(move as Move),\n      );\n    }\n    return state;\n  }\n\n  public algDuration(): Duration {\n    return this.durationFn.traverseAlg(this.moves);\n  }\n\n  public numMoves(): number {\n    // TODO: Cache internally once performance matters.\n    return countAnimatedMoves(this.moves);\n  }\n\n  public moveDuration(index: number): number {\n    return this.durationFn.traverseMove(this.getMove(index));\n  }\n}\n","import { Alg, Move } from \"../../../../alg\";\nimport { PuzzleWrapper, State } from \"../../../3D/puzzles/KPuzzleWrapper\";\nimport {\n  Direction,\n  Duration,\n  PuzzlePosition,\n  Timestamp,\n} from \"../../cursor/CursorTypes\";\nimport { AlgIndexer } from \"../AlgIndexer\";\nimport { MoveWithRange, simulMoves } from \"./simul-moves\";\n\nconst demos: Record<string, MoveWithRange[]> = {\n  \"y' y' U' E D R2 r2 F2 B2 U E D' R2 L2' z2 S2 U U D D S2 F2' B2\": [\n    { move: new Move(\"y\", -1), start: 0, end: 1000 },\n    { move: new Move(\"y\", -1), start: 1000, end: 2000 },\n    { move: new Move(\"U\", -1), start: 1000, end: 1600 },\n    { move: new Move(\"E\", 1), start: 1200, end: 1800 },\n    { move: new Move(\"D\"), start: 1400, end: 2000 },\n    { move: new Move(\"R\", 2), start: 2000, end: 3500 },\n    { move: new Move(\"r\", 2), start: 2000, end: 3500 },\n    { move: new Move(\"F\", 2), start: 3500, end: 4200 },\n    { move: new Move(\"B\", 2), start: 3800, end: 4500 },\n    { move: new Move(\"U\", 1), start: 4500, end: 5500 },\n    { move: new Move(\"E\", 1), start: 4500, end: 5500 },\n    { move: new Move(\"D\", -1), start: 4500, end: 5500 },\n    { move: new Move(\"R\", 2), start: 5500, end: 6500 },\n    { move: new Move(\"L\", -2), start: 5500, end: 6500 },\n    { move: new Move(\"z\", 2), start: 5500, end: 6500 },\n    { move: new Move(\"S\", 2), start: 6500, end: 7500 },\n    { move: new Move(\"U\"), start: 7500, end: 8000 },\n    { move: new Move(\"U\"), start: 8000, end: 8500 },\n    { move: new Move(\"D\"), start: 7750, end: 8250 },\n    { move: new Move(\"D\"), start: 8250, end: 8750 },\n    { move: new Move(\"S\", 2), start: 8750, end: 9250 },\n    { move: new Move(\"F\", -2), start: 8750, end: 10000 },\n    { move: new Move(\"B\", 2), start: 8750, end: 10000 },\n  ],\n  \"M' R' U' D' M R\": [\n    { move: new Move(\"M\", -1), start: 0, end: 1000 },\n    { move: new Move(\"R\", -1), start: 0, end: 1000 },\n    { move: new Move(\"U\", -1), start: 1000, end: 2000 },\n    { move: new Move(\"D\", -1), start: 1000, end: 2000 },\n    { move: new Move(\"M\"), start: 2000, end: 3000 },\n    { move: new Move(\"R\"), start: 2000, end: 3000 },\n  ],\n  \"U' E' r E r2' E r U E\": [\n    { move: new Move(\"U\", -1), start: 0, end: 1000 },\n    { move: new Move(\"E\", -1), start: 0, end: 1000 },\n    { move: new Move(\"r\"), start: 1000, end: 2500 },\n    { move: new Move(\"E\"), start: 2500, end: 3500 },\n    { move: new Move(\"r\", -2), start: 3500, end: 5000 },\n    { move: new Move(\"E\"), start: 5000, end: 6000 },\n    { move: new Move(\"r\"), start: 6000, end: 7000 },\n    { move: new Move(\"U\"), start: 7000, end: 8000 },\n    { move: new Move(\"E\"), start: 7000, end: 8000 },\n  ],\n};\n\nexport class SimultaneousMoveIndexer<P extends PuzzleWrapper>\n  implements AlgIndexer<P> {\n  private moves: MoveWithRange[];\n  // TODO: Allow custom `durationFn`.\n\n  constructor(private puzzle: P, alg: Alg) {\n    this.moves = demos[alg.toString()] ?? simulMoves(alg);\n    // TODO: Avoid assuming all base moves are block moves.\n  }\n\n  public getMove(index: number): Move {\n    return this.moves[Math.min(index, this.moves.length - 1)].move;\n  }\n\n  private getMoveWithRange(index: number): MoveWithRange {\n    return this.moves[Math.min(index, this.moves.length - 1)];\n  }\n\n  public indexToMoveStartTimestamp(index: number): Timestamp {\n    let start = 0;\n    if (this.moves.length > 0) {\n      start = this.moves[Math.min(index, this.moves.length - 1)].start;\n    }\n    return start;\n  }\n\n  public timestampToIndex(timestamp: Timestamp): number {\n    let i = 0;\n    for (i = 0; i < this.moves.length; i++) {\n      if (this.moves[i].start >= timestamp) {\n        return Math.max(0, i - 1);\n      }\n    }\n    return Math.max(0, i - 1);\n  }\n\n  public timestampToPosition(\n    timestamp: Timestamp,\n    startTransformation?: State<P>,\n  ): PuzzlePosition {\n    const position: PuzzlePosition = {\n      state: startTransformation ?? (this.puzzle.identity() as any),\n      movesInProgress: [],\n    };\n    for (const moveWithRange of this.moves) {\n      if (moveWithRange.end <= timestamp) {\n        position.state = this.puzzle.combine(\n          position.state,\n          this.puzzle.stateFromMove(moveWithRange.move),\n        ) as any;\n      } else if (\n        moveWithRange.start < timestamp &&\n        timestamp < moveWithRange.end\n      ) {\n        position.movesInProgress.push({\n          move: moveWithRange.move,\n          direction: Direction.Forwards,\n          fraction:\n            (timestamp - moveWithRange.start) /\n            (moveWithRange.end - moveWithRange.start),\n        });\n      } else if (timestamp < moveWithRange.start) {\n        continue;\n      }\n    }\n    return position;\n  }\n\n  public stateAtIndex(index: number, startTransformation?: State<P>): State<P> {\n    let state = startTransformation ?? this.puzzle.startState();\n    for (let i = 0; i < this.moves.length && i < index; i++) {\n      const moveWithRange = this.moves[i];\n      state = this.puzzle.combine(\n        state,\n        this.puzzle.stateFromMove(moveWithRange.move),\n      );\n    }\n    return state;\n  }\n\n  public transformAtIndex(index: number): State<P> {\n    let state = this.puzzle.identity();\n    for (const moveWithRange of this.moves.slice(0, index)) {\n      state = this.puzzle.combine(\n        state,\n        this.puzzle.stateFromMove(moveWithRange.move),\n      );\n    }\n    return state;\n  }\n\n  public algDuration(): Duration {\n    let max = 0;\n    for (const moveWithRange of this.moves) {\n      max = Math.max(max, moveWithRange.end);\n    }\n    return max;\n  }\n\n  public numMoves(): number {\n    // TODO: Cache internally once performance matters.\n    return this.moves.length;\n  }\n\n  public moveDuration(index: number): number {\n    const move = this.getMoveWithRange(index);\n    return move.end - move.start;\n  }\n}\n","import {\n  LineComment,\n  Commutator,\n  Conjugate,\n  Pause,\n  TraversalUp,\n  Move,\n  Alg,\n  Grouping,\n  Newline,\n} from \"../../../../alg\";\nimport { MillisecondTimestamp } from \"../../cursor/CursorTypes\";\nimport { defaultDurationForAmount } from \"../AlgDuration\";\n\nexport interface LocalMoveWithRange {\n  move: Move;\n  msUntilNext: MillisecondTimestamp;\n  duration: MillisecondTimestamp;\n}\n\nexport interface MoveWithRange {\n  move: Move;\n  start: MillisecondTimestamp;\n  end: MillisecondTimestamp;\n}\n\nconst axisLookup: Record<string, \"x\" | \"y\" | \"z\"> = {\n  u: \"y\",\n  l: \"x\",\n  f: \"z\",\n  r: \"x\",\n  b: \"z\",\n  d: \"y\",\n  m: \"x\",\n  e: \"y\",\n  s: \"z\",\n  x: \"x\",\n  y: \"y\",\n  z: \"z\",\n};\n\nfunction isSameAxis(move1: Move, move2: Move): boolean {\n  return (\n    axisLookup[move1.family[0].toLowerCase()] ===\n    axisLookup[move2.family[0].toLowerCase()]\n  );\n}\n\n// TODO: Replace this with an optimized implementation.\n// TODO: Consider `(x U)` and `(U x F)` to be simultaneous.\nexport class LocalSimulMoves extends TraversalUp<LocalMoveWithRange[]> {\n  public traverseAlg(alg: Alg): LocalMoveWithRange[] {\n    const processed: LocalMoveWithRange[][] = [];\n    for (const nestedUnit of alg.units()) {\n      processed.push(this.traverseUnit(nestedUnit));\n    }\n    return Array.prototype.concat(...processed);\n  }\n\n  public traverseGroupingOnce(alg: Alg): LocalMoveWithRange[] {\n    if (alg.experimentalIsEmpty()) {\n      return [];\n    }\n\n    for (const unit of alg.units()) {\n      if (!unit.is(Move))\n        // TODO: define the type statically on the class?\n        return this.traverseAlg(alg);\n    }\n\n    const moves = Array.from(alg.units()) as Move[];\n    let maxSimulDur = defaultDurationForAmount(moves[0].effectiveAmount);\n    for (let i = 0; i < moves.length - 1; i++) {\n      for (let j = 1; j < moves.length; j++) {\n        if (!isSameAxis(moves[i], moves[j])) {\n          return this.traverseAlg(alg);\n        }\n      }\n      maxSimulDur = Math.max(\n        maxSimulDur,\n        defaultDurationForAmount(moves[i].effectiveAmount),\n      );\n    }\n\n    const localMovesWithRange: LocalMoveWithRange[] = moves.map(\n      (blockMove): LocalMoveWithRange => {\n        return {\n          move: blockMove,\n          msUntilNext: 0,\n          duration: maxSimulDur,\n        };\n      },\n    );\n    localMovesWithRange[\n      localMovesWithRange.length - 1\n    ].msUntilNext = maxSimulDur;\n    return localMovesWithRange;\n  }\n\n  public traverseGrouping(grouping: Grouping): LocalMoveWithRange[] {\n    const processed: LocalMoveWithRange[][] = [];\n\n    const segmentOnce: Alg =\n      grouping.experimentalEffectiveAmount > 0\n        ? grouping.experimentalAlg\n        : grouping.experimentalAlg.invert();\n    for (let i = 0; i < Math.abs(grouping.experimentalEffectiveAmount); i++) {\n      processed.push(this.traverseGroupingOnce(segmentOnce));\n    }\n    return Array.prototype.concat(...processed);\n  }\n\n  public traverseMove(move: Move): LocalMoveWithRange[] {\n    const duration = defaultDurationForAmount(move.effectiveAmount);\n    return [\n      {\n        move: move,\n        msUntilNext: duration,\n        duration,\n      },\n    ];\n  }\n\n  public traverseCommutator(commutator: Commutator): LocalMoveWithRange[] {\n    const processed: LocalMoveWithRange[][] = [];\n    const segmentsOnce: Alg[] =\n      commutator.experimentalEffectiveAmount > 0\n        ? [\n            commutator.A,\n            commutator.B,\n            commutator.A.invert(),\n            commutator.B.invert(),\n          ]\n        : [\n            commutator.B,\n            commutator.A,\n            commutator.B.invert(),\n            commutator.A.invert(),\n          ];\n    for (let i = 0; i < Math.abs(commutator.experimentalEffectiveAmount); i++) {\n      for (const segment of segmentsOnce) {\n        processed.push(this.traverseGroupingOnce(segment));\n      }\n    }\n    return Array.prototype.concat(...processed);\n  }\n\n  public traverseConjugate(conjugate: Conjugate): LocalMoveWithRange[] {\n    const processed: LocalMoveWithRange[][] = [];\n    const segmentsOnce: Alg[] =\n      conjugate.experimentalEffectiveAmount > 0\n        ? [conjugate.A, conjugate.B, conjugate.A.invert()]\n        : [conjugate.A, conjugate.B.invert(), conjugate.A.invert()];\n    for (let i = 0; i < Math.abs(conjugate.experimentalEffectiveAmount); i++) {\n      for (const segment of segmentsOnce) {\n        processed.push(this.traverseGroupingOnce(segment));\n      }\n    }\n    return Array.prototype.concat(...processed);\n  }\n\n  public traversePause(_pause: Pause): LocalMoveWithRange[] {\n    return [];\n  }\n\n  public traverseNewline(_newline: Newline): LocalMoveWithRange[] {\n    return [];\n  }\n\n  public traverseLineComment(_comment: LineComment): LocalMoveWithRange[] {\n    return [];\n  }\n}\n\nconst localSimulMovesInstance = new LocalSimulMoves();\n\nconst localSimulMoves = localSimulMovesInstance.traverseAlg.bind(\n  localSimulMovesInstance,\n) as (a: Alg) => LocalMoveWithRange[];\n\nexport function simulMoves(a: Alg): MoveWithRange[] {\n  let timestamp = 0;\n  const l = localSimulMoves(a).map(\n    (localSimulMove: LocalMoveWithRange): MoveWithRange => {\n      const moveWithRange = {\n        move: localSimulMove.move,\n        start: timestamp,\n        end: timestamp + localSimulMove.duration,\n      };\n      timestamp += localSimulMove.msUntilNext;\n      return moveWithRange;\n    },\n  );\n  return l;\n}\n","import { RenderScheduler } from \"./RenderScheduler\";\nimport { AlgCursor, TimeRange } from \"./cursor/AlgCursor\";\nimport {\n  BoundaryType,\n  Direction,\n  directionScalar,\n  MillisecondTimestamp,\n} from \"./cursor/CursorTypes\";\n\n// YouTube keeps playing on jump, but it also stays frozen while the cursor is\n// down. So I think it would be good for this to be false, but only if we\n// implement a \"start jumping\" event that pauses until \"finish jumping\" while\n// the scrubber is active.\nconst PAUSE_ON_JUMP = true;\n\n// TODO: We use symbols to avoid exposing `number` values. Is this performant enough? Should/can we use symbols?\nexport enum TimelineAction {\n  StartingToPlay = \"StartingToPlay\", // TODO playing backwards.\n  Pausing = \"Pausing\",\n  Jumping = \"Jumping\",\n}\n\n// TODO: We use symbols to avoid exposing `number` values. Is this performant enough? Should/can we use symbols?\nexport enum TimestampLocationType {\n  StartOfTimeline = \"Start\",\n  EndOfTimeline = \"End\",\n  StartOfMove = \"StartOfMove\",\n  EndOfMove = \"EndOfMove\",\n  MiddleOfMove = \"MiddleOfMove\",\n  BetweenMoves = \"BetweenMoves\",\n}\n\nexport interface TimelineActionEvent {\n  action: TimelineAction;\n  locationType: TimestampLocationType;\n}\n\n// This should be used by classes that (directly or indirectly) update puzzle\n// state based on a timestamp. It fires every time the timestamp is changed for\n// a new render (e.g. 60 times a second during animation), and only fires if the\n// timestamp has changed since the last call. This means you can use it as a\n// reliable callback telling you when to schedule a new render.\nexport interface TimelineTimestampListener {\n  onTimelineTimestampChange(timestamp: MillisecondTimestamp): void;\n  onTimeRangeChange(timeRange: TimeRange): void;\n}\n\n// This should be used by classes that (directly or indirectly) update UI (e.g.\n// pause/play buttons).\n//\n// Note: the action events of a `Timeline` are not necessarily coordinated with\n// the timestamp events, since timestamp events are tied to animation frames.\n// For example, if you receive a \"pausing\" event, the final frame may already\n// have been drawn, or may be drawn in the near future.\nexport interface TimelineActionListener {\n  onTimelineAction(actionEvent: TimelineActionEvent): void;\n}\n\nexport interface TimelineTimestampDispatcher {\n  addTimestampListener(timestampListener: TimelineTimestampListener): void;\n}\n\nexport interface TimelineActionDispatcher {\n  addActionListener(actionListener: TimelineActionListener): void;\n}\n\n// `performance.now()` is rounded for security concerns, so it's usually not\n// accurate to the millisecond. So we round it, which lets us work with whole ms\n// everywhere.\nfunction getNow(): MillisecondTimestamp {\n  return Math.round(performance.now());\n}\n\nexport class Timeline\n  implements TimelineTimestampDispatcher, TimelineActionDispatcher {\n  animating: boolean = false;\n  tempoScale: number = 1;\n  private cursors: Set<AlgCursor> = new Set();\n  private timestampListeners: Set<TimelineTimestampListener> = new Set();\n  private actionListeners: Set<TimelineActionListener> = new Set();\n  timestamp: number = 0;\n  lastAnimFrameNow: DOMHighResTimeStamp = 0;\n  lastAnimFrameTimestamp: MillisecondTimestamp;\n  private scheduler: RenderScheduler;\n\n  direction: Direction.Backwards | Direction.Forwards = Direction.Forwards; // TODO: handle pausing here?\n\n  boundaryType: BoundaryType = BoundaryType.EntireTimeline;\n  cachedNextBoundary: MillisecondTimestamp;\n\n  constructor() {\n    const animFrame = (_now: MillisecondTimestamp): void => {\n      if (this.animating) {\n        const now = getNow(); // TODO: See if we can use the rAF value without monotonicity issues.;\n        this.timestamp =\n          this.timestamp +\n          this.tempoScale *\n            directionScalar(this.direction) *\n            (now - this.lastAnimFrameNow);\n        this.lastAnimFrameNow = now;\n\n        const atOrPastBoundary =\n          this.direction === Direction.Backwards\n            ? this.timestamp <= this.cachedNextBoundary\n            : this.timestamp >= this.cachedNextBoundary;\n        if (atOrPastBoundary) {\n          this.timestamp = this.cachedNextBoundary;\n          if (this.animating) {\n            this.animating = false;\n            this.dispatchAction(TimelineAction.Pausing);\n          }\n        }\n      }\n\n      if (this.timestamp !== this.lastAnimFrameTimestamp) {\n        this.dispatchTimestamp();\n        this.lastAnimFrameTimestamp = this.timestamp;\n      }\n\n      if (this.animating) {\n        this.scheduler.requestAnimFrame();\n      }\n    };\n    this.scheduler = new RenderScheduler(animFrame);\n  }\n\n  public addCursor(cursor: AlgCursor): void {\n    this.cursors.add(cursor);\n    this.dispatchTimeRange();\n  }\n\n  removeCursor(cursor: AlgCursor): void {\n    this.cursors.delete(cursor);\n    this.clampTimestampToRange();\n    this.dispatchTimeRange();\n  }\n\n  // TODO: test\n  private clampTimestampToRange(): void {\n    const timeRange = this.timeRange();\n    if (this.timestamp < timeRange.start) {\n      this.setTimestamp(timeRange.start);\n    }\n    if (this.timestamp > timeRange.end) {\n      this.setTimestamp(timeRange.end);\n    }\n  }\n\n  // In the future, this might do some calculations or caching.\n  public onCursorChange(_cursor: AlgCursor): void {\n    if (this.timestamp > this.maxTimestamp()) {\n      this.timestamp = this.maxTimestamp();\n    }\n    this.dispatchTimeRange();\n  }\n\n  timeRange(): TimeRange {\n    let start = 0;\n    let end = 0;\n    for (const cursor of this.cursors) {\n      const cursorTimeRange = cursor.timeRange();\n      start = Math.min(start, cursorTimeRange.start);\n      end = Math.max(end, cursorTimeRange.end);\n    }\n\n    return { start, end };\n  }\n\n  minTimestamp(): number {\n    // TODO: Calculate and cache this value every time there's a new cursor.\n    return this.timeRange().start;\n  }\n\n  maxTimestamp(): number {\n    // TODO: Calculate and cache this value every time there's a new cursor.\n    return this.timeRange().end;\n  }\n\n  private dispatchTimeRange(): void {\n    const timeRange = this.timeRange();\n    for (const listener of this.cursors) {\n      // TODO: dedup in case the timestamp hasn't changed sine last time.\n      listener.onTimeRangeChange(timeRange);\n    }\n    // TODO: Combine loops without extra memory?\n    for (const listener of this.timestampListeners) {\n      // TODO: dedup in case the timestamp hasn't changed sine last time.\n      listener.onTimeRangeChange(timeRange);\n    }\n  }\n\n  private dispatchTimestamp(): void {\n    for (const listener of this.cursors) {\n      // TODO: dedup in case the timestamp hasn't changed sine last time.\n      listener.onTimelineTimestampChange(this.timestamp);\n    }\n    // TODO: Combine loops without extra memory?\n    for (const listener of this.timestampListeners) {\n      // TODO: dedup in case the timestamp hasn't changed sine last time.\n      listener.onTimelineTimestampChange(this.timestamp);\n    }\n  }\n\n  addTimestampListener(timestampListener: TimelineTimestampListener): void {\n    this.timestampListeners.add(timestampListener);\n  }\n\n  removeTimestampListener(timestampListener: TimelineTimestampListener): void {\n    this.timestampListeners.delete(timestampListener);\n  }\n\n  addActionListener(actionListener: TimelineActionListener): void {\n    this.actionListeners.add(actionListener);\n  }\n\n  removeActionListener(actionListener: TimelineActionListener): void {\n    this.actionListeners.delete(actionListener);\n  }\n\n  play(): void {\n    this.experimentalPlay(Direction.Forwards, BoundaryType.EntireTimeline);\n  }\n\n  experimentalPlay(\n    direction: Direction.Backwards | Direction.Forwards,\n    boundaryType: BoundaryType = BoundaryType.EntireTimeline,\n  ): void {\n    this.direction = direction;\n    this.boundaryType = boundaryType;\n    const nextBoundary = this.nextBoundary(\n      this.timestamp,\n      direction,\n      this.boundaryType,\n    );\n    if (nextBoundary === null) {\n      return; // Nowhere to end, so we don't animate.\n    }\n    this.cachedNextBoundary = nextBoundary;\n    if (!this.animating) {\n      this.animating = true;\n      this.lastAnimFrameNow = getNow();\n      this.dispatchAction(TimelineAction.StartingToPlay);\n      this.scheduler.requestAnimFrame();\n    }\n  }\n\n  // Non-inclusive\n  private nextBoundary(\n    timestamp: MillisecondTimestamp,\n    direction: Direction.Backwards | Direction.Forwards,\n    boundaryType: BoundaryType = BoundaryType.EntireTimeline,\n  ): MillisecondTimestamp | null {\n    switch (boundaryType) {\n      case BoundaryType.EntireTimeline: {\n        switch (direction) {\n          case Direction.Backwards:\n            return timestamp <= this.minTimestamp()\n              ? null\n              : this.minTimestamp();\n          case Direction.Forwards:\n            return timestamp >= this.maxTimestamp()\n              ? null\n              : this.maxTimestamp();\n          default:\n            throw new Error(\"invalid direction\");\n        }\n      }\n      case BoundaryType.Move: {\n        let result: null | MillisecondTimestamp = null;\n        for (const cursor of this.cursors) {\n          const boundaryTimestamp = cursor.moveBoundary(timestamp, direction);\n          if (boundaryTimestamp !== null) {\n            switch (direction) {\n              case Direction.Backwards: {\n                result = Math.min(\n                  result ?? boundaryTimestamp,\n                  boundaryTimestamp,\n                );\n                break;\n              }\n              case Direction.Forwards: {\n                result = Math.max(\n                  result ?? boundaryTimestamp,\n                  boundaryTimestamp,\n                );\n                break;\n              }\n              default:\n                throw new Error(\"invalid direction\");\n            }\n          }\n        }\n        return result;\n      }\n      default:\n        throw new Error(\"invalid boundary type\");\n    }\n  }\n\n  // One more render may be dispatched after this.\n  pause(): void {\n    // TODO: error if already paused?\n    if (this.animating) {\n      this.animating = false;\n      this.dispatchAction(TimelineAction.Pausing);\n      this.scheduler.requestAnimFrame();\n    }\n  }\n\n  playPause(): void {\n    if (this.animating) {\n      this.pause();\n    } else {\n      if (this.timestamp >= this.maxTimestamp()) {\n        this.timestamp = 0;\n      }\n      this.experimentalPlay(Direction.Forwards, BoundaryType.EntireTimeline);\n    }\n  }\n\n  setTimestamp(timestamp: MillisecondTimestamp): void {\n    const oldTimestamp = this.timestamp;\n    this.timestamp = timestamp;\n    this.lastAnimFrameNow = getNow();\n\n    if (oldTimestamp !== timestamp) {\n      this.dispatchAction(TimelineAction.Jumping);\n      this.scheduler.requestAnimFrame();\n    }\n\n    if (PAUSE_ON_JUMP) {\n      this.animating = false;\n      this.dispatchAction(TimelineAction.Pausing);\n    }\n  }\n\n  jumpToStart(): void {\n    this.setTimestamp(this.minTimestamp());\n  }\n\n  jumpToEnd(): void {\n    this.setTimestamp(this.maxTimestamp());\n  }\n\n  /** @deprecated */\n  experimentalJumpToLastMove(): void {\n    let max: MillisecondTimestamp = 0;\n    for (const cursor of this.cursors) {\n      max = Math.max(\n        max,\n        cursor.experimentalTimestampForStartOfLastMove() ?? 0,\n      );\n    }\n    this.setTimestamp(max);\n  }\n\n  private dispatchAction(event: TimelineAction): void {\n    let locationType = TimestampLocationType.MiddleOfMove; // TODO\n    switch (this.timestamp) {\n      // TODO\n      case this.minTimestamp():\n        locationType = TimestampLocationType.StartOfTimeline;\n        break;\n      case this.maxTimestamp():\n        locationType = TimestampLocationType.EndOfTimeline;\n        break;\n    }\n\n    const actionEvent: TimelineActionEvent = {\n      action: event,\n      locationType,\n    };\n    for (const listener of this.actionListeners) {\n      listener.onTimelineAction(actionEvent);\n    }\n  }\n}\n","import { TimeRange } from \"../../animation/cursor/AlgCursor\";\nimport {\n  BoundaryType,\n  Direction,\n  MillisecondTimestamp,\n} from \"../../animation/cursor/CursorTypes\";\nimport {\n  Timeline,\n  TimelineAction,\n  TimelineActionEvent,\n  TimestampLocationType,\n} from \"../../animation/Timeline\";\nimport { ClassListManager } from \"../element/ClassListManager\";\nimport { ManagedCustomElement } from \"../element/ManagedCustomElement\";\nimport { customElementsShim } from \"../element/node-custom-element-shims\";\nimport { ViewerLinkPage } from \"../TwistyPlayerConfig\";\nimport { buttonCSS, buttonGridCSS } from \"./buttons.css\";\nimport { TwistyControlElement } from \"./TwistyControlElement.ts\";\n\ntype TimelineCommand =\n  | \"fullscreen\"\n  | \"jump-to-start\"\n  | \"play-pause\" // TODO: toggle-play?\n  // | \"play\"\n  // | \"play-backwards\"\n  | \"play-step-backwards\"\n  | \"play-step\"\n  | \"jump-to-end\"\n  | \"twizzle-link\";\n\n// TODO: combine this with disabled status and label in a state machine?\ntype ButtonIconName =\n  | \"skip-to-start\"\n  | \"skip-to-end\"\n  | \"step-forward\"\n  | \"step-backward\"\n  | \"pause\"\n  | \"play\"\n  | \"enter-fullscreen\"\n  | \"exit-fullscreen\"\n  | \"twizzle-tw\";\n\nexport class TwistyControlButton\n  extends ManagedCustomElement\n  implements TwistyControlElement {\n  private timeline: Timeline;\n  private timelineCommand: TimelineCommand;\n  private currentIconName: string | null = null;\n  protected button: HTMLButtonElement = document.createElement(\"button\");\n  private fullscreenElement: Element | null = null;\n  private visitTwizzleLinkCallback: (() => void) | null = null;\n  constructor(\n    timeline?: Timeline,\n    timelineCommand?: TimelineCommand,\n    options?: {\n      fullscreenElement?: Element; // TODO: reflect as an element attribute?\n      visitTwizzleLinkCallback?: () => void;\n    },\n  ) {\n    super();\n\n    this.fullscreenElement = options?.fullscreenElement ?? null;\n    this.visitTwizzleLinkCallback = options?.visitTwizzleLinkCallback ?? null;\n\n    if (!timeline) {\n      console.warn(\"Must have timeline!\"); // TODO\n    }\n    this.timeline = timeline!;\n    if (!timelineCommand) {\n      console.warn(\"Must have timelineCommand!\"); // TODO\n    }\n    this.timelineCommand = timelineCommand!;\n\n    this.addCSS(buttonCSS);\n    this.setIcon(this.initialIcon());\n    this.setHoverTitle(this.initialHoverTitle());\n    this.addElement(this.button);\n    this.addEventListener(\"click\", this.onPress.bind(this));\n\n    switch (this.timelineCommand!) {\n      case \"fullscreen\":\n        if (!document.fullscreenEnabled) {\n          this.button.disabled = true;\n        }\n        break;\n      case \"jump-to-start\":\n      case \"play-step-backwards\":\n        this.button.disabled = true;\n        break;\n    }\n\n    if (this.timeline) {\n      // TODO\n      this.timeline.addActionListener(this);\n      switch (this.timelineCommand!) {\n        case \"play-pause\":\n        case \"play-step-backwards\":\n        case \"play-step\":\n          this.timeline.addTimestampListener(this);\n          break;\n      }\n\n      this.autoSetTimelineBasedDisabled();\n    }\n  }\n\n  // TODO: Can we avoid duplicate calculations?\n  private autoSetTimelineBasedDisabled(): void {\n    switch (this.timelineCommand!) {\n      case \"jump-to-start\":\n      case \"play-pause\":\n      case \"play-step-backwards\":\n      case \"play-step\":\n      case \"jump-to-end\": {\n        const timeRange = this.timeline.timeRange();\n        if (timeRange.start === timeRange.end) {\n          this.button.disabled = true;\n          return;\n        }\n        switch (this.timelineCommand!) {\n          case \"jump-to-start\":\n          case \"play-step-backwards\":\n            this.button.disabled =\n              this.timeline.timestamp < this.timeline.maxTimestamp();\n            break;\n          case \"jump-to-end\":\n          case \"play-step\":\n            this.button.disabled =\n              this.timeline.timestamp > this.timeline.minTimestamp();\n            break;\n          default:\n            this.button.disabled = false;\n        }\n        break;\n      }\n    }\n  }\n\n  setIcon(buttonIconName: ButtonIconName): void {\n    if (this.currentIconName === buttonIconName) {\n      return;\n    }\n    if (this.currentIconName) {\n      this.button.classList.remove(`svg-${this.currentIconName}`);\n    }\n    this.button.classList.add(`svg-${buttonIconName}`);\n    this.currentIconName = buttonIconName;\n  }\n\n  private initialIcon(): ButtonIconName {\n    const map: Record<TimelineCommand, ButtonIconName> = {\n      \"jump-to-start\": \"skip-to-start\",\n      \"play-pause\": \"play\",\n      \"play-step\": \"step-forward\",\n      \"play-step-backwards\": \"step-backward\",\n      \"jump-to-end\": \"skip-to-end\",\n      \"fullscreen\": \"enter-fullscreen\",\n      \"twizzle-link\": \"twizzle-tw\",\n    };\n    return map[this.timelineCommand];\n  }\n\n  private initialHoverTitle(): string {\n    const map: Record<TimelineCommand, string> = {\n      \"jump-to-start\": \"Restart\",\n      \"play-pause\": \"Play\",\n      \"play-step\": \"Step forward\",\n      \"play-step-backwards\": \"Step backward\",\n      \"jump-to-end\": \"Skip to End\",\n      \"fullscreen\": \"Enter fullscreen\",\n      \"twizzle-link\": \"View at Twizzle\",\n    };\n    return map[this.timelineCommand];\n  }\n\n  private setHoverTitle(title: string): void {\n    this.button.title = title;\n  }\n\n  onPress(): void {\n    switch (this.timelineCommand!) {\n      case \"fullscreen\":\n        if (document.fullscreenElement === this.fullscreenElement) {\n          document.exitFullscreen();\n          // this.setIcon(\"enter-fullscreen\");\n        } else {\n          this.setIcon(\"exit-fullscreen\");\n          this.fullscreenElement!.requestFullscreen().then(() => {\n            const onFullscreen = (): void => {\n              if (document.fullscreenElement !== this.fullscreenElement) {\n                this.setIcon(\"enter-fullscreen\");\n                window.removeEventListener(\"fullscreenchange\", onFullscreen);\n              }\n            };\n            window.addEventListener(\"fullscreenchange\", onFullscreen);\n          });\n        }\n        break;\n      case \"jump-to-start\":\n        this.timeline.setTimestamp(0);\n        break;\n      case \"jump-to-end\":\n        this.timeline.jumpToEnd();\n        break;\n      case \"play-pause\":\n        this.timeline.playPause();\n        break;\n      case \"play-step\":\n        this.timeline.experimentalPlay(Direction.Forwards, BoundaryType.Move);\n        break;\n      case \"play-step-backwards\":\n        this.timeline.experimentalPlay(Direction.Backwards, BoundaryType.Move);\n        break;\n      case \"twizzle-link\":\n        if (this.visitTwizzleLinkCallback) {\n          this.visitTwizzleLinkCallback();\n        }\n        break;\n    }\n  }\n\n  onTimelineAction(actionEvent: TimelineActionEvent): void {\n    switch (this.timelineCommand!) {\n      case \"jump-to-start\":\n        // TODO: what if you're already playing?\n        this.button.disabled =\n          actionEvent.locationType === TimestampLocationType.StartOfTimeline &&\n          actionEvent.action !== TimelineAction.StartingToPlay;\n        break;\n      case \"jump-to-end\":\n        this.button.disabled =\n          actionEvent.locationType === TimestampLocationType.EndOfTimeline &&\n          actionEvent.action !== TimelineAction.StartingToPlay;\n        break;\n      case \"play-pause\":\n        // Always enabled, since we will jump to the start if needed.\n        switch (actionEvent.action) {\n          case TimelineAction.Pausing:\n            this.setIcon(\"play\");\n            this.setHoverTitle(\"Play\");\n            break;\n          case TimelineAction.StartingToPlay:\n            this.setIcon(\"pause\");\n            this.setHoverTitle(\"Pause\");\n            break;\n          // TODO: does jumping mean pause?\n        }\n        break;\n      case \"play-step\":\n        // TODO: refine this\n        this.button.disabled =\n          actionEvent.locationType === TimestampLocationType.EndOfTimeline &&\n          actionEvent.action !== TimelineAction.StartingToPlay;\n        break;\n      case \"play-step-backwards\":\n        // TODO: refine this\n        this.button.disabled =\n          actionEvent.locationType === TimestampLocationType.StartOfTimeline &&\n          actionEvent.action !== TimelineAction.StartingToPlay;\n        break;\n    }\n  }\n\n  onTimelineTimestampChange(_timestamp: MillisecondTimestamp): void {\n    // Nothing\n  }\n\n  onTimeRangeChange(_timeRange: TimeRange): void {\n    // TODO\n    this.autoSetTimelineBasedDisabled();\n  }\n}\n\ncustomElementsShim.define(\"twisty-control-button\", TwistyControlButton);\n\n// <twisty-control-button-grid>\n// Usually a horizontal line.\nexport class TwistyControlButtonPanel\n  extends ManagedCustomElement\n  implements TwistyControlElement {\n  #viewerLinkClassListManager: ClassListManager<ViewerLinkPage> = new ClassListManager(\n    this,\n    \"viewer-link-\",\n    [\"none\", \"twizzle\"],\n  );\n\n  constructor(\n    timeline?: Timeline,\n    options?: {\n      fullscreenElement?: Element;\n      viewerLinkCallback?: () => void;\n      viewerLink?: ViewerLinkPage;\n    },\n  ) {\n    super();\n    this.addCSS(buttonGridCSS);\n\n    this.#viewerLinkClassListManager.setValue(options?.viewerLink ?? \"none\");\n\n    // this.addElement(new TwistyControlButton(timeline!, fullscreenElement!));\n    this.addElement(\n      new TwistyControlButton(timeline!, \"fullscreen\", {\n        fullscreenElement: options?.fullscreenElement,\n      }),\n    );\n    this.addElement(new TwistyControlButton(timeline!, \"jump-to-start\"));\n    this.addElement(new TwistyControlButton(timeline!, \"play-step-backwards\"));\n    this.addElement(new TwistyControlButton(timeline!, \"play-pause\"));\n    this.addElement(new TwistyControlButton(timeline!, \"play-step\"));\n    this.addElement(new TwistyControlButton(timeline!, \"jump-to-end\"));\n    this.addElement(\n      new TwistyControlButton(timeline!, \"twizzle-link\", {\n        visitTwizzleLinkCallback: options?.viewerLinkCallback,\n      }),\n    ).classList.add(\"twizzle-link-button\");\n    /*...*/\n  }\n\n  setViewerLink(viewerLink: ViewerLinkPage): void {\n    this.#viewerLinkClassListManager.setValue(viewerLink);\n  }\n}\n\ncustomElementsShim.define(\n  \"twisty-control-button-panel\",\n  TwistyControlButtonPanel,\n);\n","import { CSSSource } from \"../element/ManagedCustomElement\";\n\nexport const buttonGridCSS = new CSSSource(`\n:host {\n  width: 384px;\n  height: 24px;\n  display: grid;\n}\n\n.wrapper {\n  width: 100%;\n  height: 100%;\n  display: grid;\n  overflow: hidden;\n  backdrop-filter: blur(4px);\n  -webkit-backdrop-filter: blur(4px);\n}\n\n.wrapper {\n  grid-auto-flow: column;\n}\n\n.viewer-link-none .twizzle-link-button {\n  display: none;\n}\n\n.wrapper twisty-control-button {\n  width: inherit;\n  height: inherit;\n}\n`);\n\nexport const buttonCSS = new CSSSource(`\n:host {\n  width: 48px;\n  height: 24px;\n  display: grid;\n}\n\n.wrapper {\n  width: 100%;\n  height: 100%;\n}\n\nbutton {\n  width: 100%;\n  height: 100%;\n  border: none;\n  \n  background-position: center;\n  background-repeat: no-repeat;\n  background-size: contain;\n\n  background-color: rgba(196, 196, 196, 0.75);\n}\n\nbutton:enabled {\n  background-color: rgba(196, 196, 196, 0.75)\n}\n\nbutton:disabled {\n  background-color: rgba(0, 0, 0, 0.4);\n  opacity: 0.25;\n  pointer-events: none;\n}\n\nbutton:enabled:hover {\n  background-color: rgba(255, 255, 255, 0.75);\n  box-shadow: 0 0 1em rgba(0, 0, 0, 0.25);\n  cursor: pointer;\n}\n\n/* TODO: fullscreen icons have too much padding?? */\nbutton.svg-skip-to-start {\n  background-image: url(\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNjQzIDEwMzdxMTktMTkgMzItMTN0MTMgMzJ2MTQ3MnEwIDI2LTEzIDMydC0zMi0xM2wtNzEwLTcxMHEtOS05LTEzLTE5djcxMHEwIDI2LTEzIDMydC0zMi0xM2wtNzEwLTcxMHEtOS05LTEzLTE5djY3OHEwIDI2LTE5IDQ1dC00NSAxOUg5NjBxLTI2IDAtNDUtMTl0LTE5LTQ1VjEwODhxMC0yNiAxOS00NXQ0NS0xOWgxMjhxMjYgMCA0NSAxOXQxOSA0NXY2NzhxNC0xMSAxMy0xOWw3MTAtNzEwcTE5LTE5IDMyLTEzdDEzIDMydjcxMHE0LTExIDEzLTE5eiIvPjwvc3ZnPg==\");\n}\n\nbutton.svg-skip-to-end {\n  background-image: url(\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik05NDEgMjU0N3EtMTkgMTktMzIgMTN0LTEzLTMyVjEwNTZxMC0yNiAxMy0zMnQzMiAxM2w3MTAgNzEwcTggOCAxMyAxOXYtNzEwcTAtMjYgMTMtMzJ0MzIgMTNsNzEwIDcxMHE4IDggMTMgMTl2LTY3OHEwLTI2IDE5LTQ1dDQ1LTE5aDEyOHEyNiAwIDQ1IDE5dDE5IDQ1djE0MDhxMCAyNi0xOSA0NXQtNDUgMTloLTEyOHEtMjYgMC00NS0xOXQtMTktNDV2LTY3OHEtNSAxMC0xMyAxOWwtNzEwIDcxMHEtMTkgMTktMzIgMTN0LTEzLTMydi03MTBxLTUgMTAtMTMgMTl6Ii8+PC9zdmc+\");\n}\n\nbutton.svg-step-forward {\n  background-image: url(\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNjg4IDE1NjhxMCAyNi0xOSA0NWwtNTEyIDUxMnEtMTkgMTktNDUgMTl0LTQ1LTE5cS0xOS0xOS0xOS00NXYtMjU2aC0yMjRxLTk4IDAtMTc1LjUgNnQtMTU0IDIxLjVxLTc2LjUgMTUuNS0xMzMgNDIuNXQtMTA1LjUgNjkuNXEtNDkgNDIuNS04MCAxMDF0LTQ4LjUgMTM4LjVxLTE3LjUgODAtMTcuNSAxODEgMCA1NSA1IDEyMyAwIDYgMi41IDIzLjV0Mi41IDI2LjVxMCAxNS04LjUgMjV0LTIzLjUgMTBxLTE2IDAtMjgtMTctNy05LTEzLTIydC0xMy41LTMwcS03LjUtMTctMTAuNS0yNC0xMjctMjg1LTEyNy00NTEgMC0xOTkgNTMtMzMzIDE2Mi00MDMgODc1LTQwM2gyMjR2LTI1NnEwLTI2IDE5LTQ1dDQ1LTE5cTI2IDAgNDUgMTlsNTEyIDUxMnExOSAxOSAxOSA0NXoiLz48L3N2Zz4=\");\n}\n\nbutton.svg-step-backward {\n  background-image: url(\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNjg4IDIwNDhxMCAxNjYtMTI3IDQ1MS0zIDctMTAuNSAyNHQtMTMuNSAzMHEtNiAxMy0xMyAyMi0xMiAxNy0yOCAxNy0xNSAwLTIzLjUtMTB0LTguNS0yNXEwLTkgMi41LTI2LjV0Mi41LTIzLjVxNS02OCA1LTEyMyAwLTEwMS0xNy41LTE4MXQtNDguNS0xMzguNXEtMzEtNTguNS04MC0xMDF0LTEwNS41LTY5LjVxLTU2LjUtMjctMTMzLTQyLjV0LTE1NC0yMS41cS03Ny41LTYtMTc1LjUtNmgtMjI0djI1NnEwIDI2LTE5IDQ1dC00NSAxOXEtMjYgMC00NS0xOWwtNTEyLTUxMnEtMTktMTktMTktNDV0MTktNDVsNTEyLTUxMnExOS0xOSA0NS0xOXQ0NSAxOXExOSAxOSAxOSA0NXYyNTZoMjI0cTcxMyAwIDg3NSA0MDMgNTMgMTM0IDUzIDMzM3oiLz48L3N2Zz4=\");\n}\n\nbutton.svg-pause {\n  background-image: url(\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNTYwIDEwODh2MTQwOHEwIDI2LTE5IDQ1dC00NSAxOWgtNTEycS0yNiAwLTQ1LTE5dC0xOS00NVYxMDg4cTAtMjYgMTktNDV0NDUtMTloNTEycTI2IDAgNDUgMTl0MTkgNDV6bS04OTYgMHYxNDA4cTAgMjYtMTkgNDV0LTQ1IDE5aC01MTJxLTI2IDAtNDUtMTl0LTE5LTQ1VjEwODhxMC0yNiAxOS00NXQ0NS0xOWg1MTJxMjYgMCA0NSAxOXQxOSA0NXoiLz48L3N2Zz4=\");\n}\n\nbutton.svg-play {\n  background-image: url(\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNDcyLjUgMTgyM2wtMTMyOCA3MzhxLTIzIDEzLTM5LjUgM3QtMTYuNS0zNlYxMDU2cTAtMjYgMTYuNS0zNnQzOS41IDNsMTMyOCA3MzhxMjMgMTMgMjMgMzF0LTIzIDMxeiIvPjwvc3ZnPg==\");\n}\n\nbutton.svg-enter-fullscreen {\n  background-image: url(\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAyOCAyOCIgd2lkdGg9IjI4Ij48cGF0aCBkPSJNMiAyaDI0djI0SDJ6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTkgMTZIN3Y1aDV2LTJIOXYtM3ptLTItNGgyVjloM1Y3SDd2NXptMTIgN2gtM3YyaDV2LTVoLTJ2M3pNMTYgN3YyaDN2M2gyVjdoLTV6Ii8+PC9zdmc+\");\n}\n\nbutton.svg-exit-fullscreen {\n  background-image: url(\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAyOCAyOCIgd2lkdGg9IjI4Ij48cGF0aCBkPSJNMiAyaDI0djI0SDJ6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTcgMThoM3YzaDJ2LTVIN3Yyem0zLThIN3YyaDVWN2gtMnYzem02IDExaDJ2LTNoM3YtMmgtNXY1em0yLTExVjdoLTJ2NWg1di0yaC0zeiIvPjwvc3ZnPg==\");\n}\n\nbutton.svg-twizzle-tw {\n  background-image: url(\"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODY0IiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMzk3LjU4MSAxNTEuMTh2NTcuMDg0aC04OS43MDN2MjQwLjM1MmgtNjYuOTU1VjIwOC4yNjRIMTUxLjIydi01Ny4wODNoMjQ2LjM2MXptNTQuMzEgNzEuNjc3bDcuNTEyIDMzLjY5MmMyLjcxOCAxMi4xNiA1LjU4IDI0LjY4IDguNTg0IDM3LjU1NWEyMTgwLjc3NSAyMTgwLjc3NSAwIDAwOS40NDIgMzguODQzIDEyNjYuMyAxMjY2LjMgMCAwMDEwLjA4NiAzNy41NTVjMy43Mi0xMi41OSA3LjM2OC0yNS40NjYgMTAuOTQ1LTM4LjYyOCAzLjU3Ni0xMy4xNjIgNy4wMS0yNi4xMSAxMC4zLTM4Ljg0M2w1Ljc2OS0yMi40NTZjMS4yNDgtNC44ODcgMi40NzItOS43MDUgMy42NzQtMTQuNDU1IDMuMDA0LTExLjg3NSA1LjY1MS0yMi45NjIgNy45NC0zMy4yNjNoNDYuMzU0bDIuMzg0IDEwLjU2M2EyMDAwLjc3IDIwMDAuNzcgMCAwMDMuOTM1IDE2LjgyOGw2LjcxMSAyNy43MWMxLjIxMyA0Ljk1NiAyLjQ1IDkuOTggMy43MDkgMTUuMDczYTMxMTkuNzc3IDMxMTkuNzc3IDAgMDA5Ljg3MSAzOC44NDMgMTI0OS4yMjcgMTI0OS4yMjcgMCAwMDEwLjczIDM4LjYyOCAxOTA3LjYwNSAxOTA3LjYwNSAwIDAwMTAuMzAxLTM3LjU1NSAxMzk3Ljk0IDEzOTcuOTQgMCAwMDkuNjU3LTM4Ljg0M2w0LjQtMTkuMDQ2Yy43MTUtMy4xMyAxLjQyMS02LjIzNiAyLjExOC05LjMyMWw5LjU3Ny00Mi44OGg2Ni41MjZhMjk4OC43MTggMjk4OC43MTggMCAwMS0xOS41MjkgNjYuMzExbC01LjcyOCAxOC40ODJhMzIzNy40NiAzMjM3LjQ2IDAgMDEtMTQuMDE1IDQzLjc1MmMtNi40MzggMTkuNi0xMi43MzMgMzcuNjk4LTE4Ljg4NSA1NC4yOTRsLTMuMzA2IDguODI1Yy00Ljg4NCAxMi44OTgtOS40MzMgMjQuMjYzLTEzLjY0NyAzNC4wOTVoLTQ5Ljc4N2E4NDE3LjI4OSA4NDE3LjI4OSAwIDAxLTIxLjAzMS02NC44MDkgMTI4OC42ODYgMTI4OC42ODYgMCAwMS0xOC44ODUtNjQuODEgMTk3Mi40NDQgMTk3Mi40NDQgMCAwMS0xOC4yNCA2NC44MSAyNTc5LjQxMiAyNTc5LjQxMiAwIDAxLTIwLjM4OCA2NC44MWgtNDkuNzg3Yy00LjY4Mi0xMC45MjYtOS43Mi0yMy43NDMtMTUuMTEtMzguNDUxbC0xLjYyOS00LjQ3Yy01LjI1OC0xNC41MjEtMTAuNjgtMzAuMTkyLTE2LjI2Ni00Ny4wMTRsLTIuNDA0LTcuMjhjLTYuNDM4LTE5LjYtMTMuMDItNDAuMzQ0LTE5Ljc0My02Mi4yMzRhMjk4OC43MDcgMjk4OC43MDcgMCAwMS0xOS41MjktNjYuMzExaDY3LjM4NXoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjwvc3ZnPg==\");\n}\n`);\n\n// Sized against full-screen dimensions.\n// button.svg-twizzle-tw {\n//   background-image: url(\"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzc3IiBoZWlnaHQ9IjUxMyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMzU0LjU4MSAxMDcuMTh2NTcuMDg0aC04OS43MDN2MjQwLjM1MmgtNjYuOTU1VjE2NC4yNjRIMTA4LjIydi01Ny4wODNoMjQ2LjM2MXptNTQuMzEgNzEuNjc3bDcuNTEyIDMzLjY5MmMyLjcxOCAxMi4xNiA1LjU4IDI0LjY4IDguNTg0IDM3LjU1NWEyMTgwLjc3NSAyMTgwLjc3NSAwIDAwOS40NDIgMzguODQzIDEyNjYuMyAxMjY2LjMgMCAwMDEwLjA4NiAzNy41NTVjMy43Mi0xMi41OSA3LjM2OC0yNS40NjYgMTAuOTQ1LTM4LjYyOCAzLjU3Ni0xMy4xNjIgNy4wMS0yNi4xMSAxMC4zLTM4Ljg0M2w1Ljc2OS0yMi40NTZjMS4yNDgtNC44ODcgMi40NzItOS43MDUgMy42NzQtMTQuNDU1IDMuMDA0LTExLjg3NSA1LjY1MS0yMi45NjIgNy45NC0zMy4yNjNoNDYuMzU0bDIuMzg0IDEwLjU2M2EyMDAwLjc3IDIwMDAuNzcgMCAwMDMuOTM1IDE2LjgyOGw2LjcxMSAyNy43MWMxLjIxMyA0Ljk1NiAyLjQ1IDkuOTggMy43MDkgMTUuMDczYTMxMTkuNzc3IDMxMTkuNzc3IDAgMDA5Ljg3MSAzOC44NDMgMTI0OS4yMjcgMTI0OS4yMjcgMCAwMDEwLjczIDM4LjYyOCAxOTA3LjYwNSAxOTA3LjYwNSAwIDAwMTAuMzAxLTM3LjU1NSAxMzk3Ljk0IDEzOTcuOTQgMCAwMDkuNjU3LTM4Ljg0M2w0LjQtMTkuMDQ2Yy43MTUtMy4xMyAxLjQyMS02LjIzNiAyLjExOC05LjMyMWw5LjU3Ny00Mi44OGg2Ni41MjZhMjk4OC43MTggMjk4OC43MTggMCAwMS0xOS41MjkgNjYuMzExbC01LjcyOCAxOC40ODJhMzIzNy40NiAzMjM3LjQ2IDAgMDEtMTQuMDE1IDQzLjc1MmMtNi40MzggMTkuNi0xMi43MzMgMzcuNjk4LTE4Ljg4NSA1NC4yOTRsLTMuMzA2IDguODI1Yy00Ljg4NCAxMi44OTgtOS40MzMgMjQuMjYzLTEzLjY0NyAzNC4wOTVoLTQ5Ljc4N2E4NDE3LjI4OSA4NDE3LjI4OSAwIDAxLTIxLjAzMS02NC44MDkgMTI4OC42ODYgMTI4OC42ODYgMCAwMS0xOC44ODUtNjQuODEgMTk3Mi40NDQgMTk3Mi40NDQgMCAwMS0xOC4yNCA2NC44MSAyNTc5LjQxMiAyNTc5LjQxMiAwIDAxLTIwLjM4OCA2NC44MWgtNDkuNzg3Yy00LjY4Mi0xMC45MjYtOS43Mi0yMy43NDMtMTUuMTEtMzguNDUxbC0xLjYyOS00LjQ3Yy01LjI1OC0xNC41MjEtMTAuNjgtMzAuMTkyLTE2LjI2Ni00Ny4wMTRsLTIuNDA0LTcuMjhjLTYuNDM4LTE5LjYtMTMuMDItNDAuMzQ0LTE5Ljc0My02Mi4yMzRhMjk4OC43MDcgMjk4OC43MDcgMCAwMS0xOS41MjktNjYuMzExaDY3LjM4NXoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjwvc3ZnPg==\");\n// }\n","// <twisty-scrubber>\n\nimport { TimeRange } from \"../../animation/cursor/AlgCursor\";\nimport { MillisecondTimestamp } from \"../../animation/cursor/CursorTypes\";\nimport { Timeline, TimelineTimestampListener } from \"../../animation/Timeline\";\nimport { ManagedCustomElement } from \"../element/ManagedCustomElement\";\nimport { customElementsShim } from \"../element/node-custom-element-shims\";\nimport { TwistyControlElement } from \"./TwistyControlElement.ts\";\nimport { twistyScrubberCSS } from \"./TwistyScrubber.css\";\n\n// Usually a horizontal line.\nexport class TwistyScrubber\n  extends ManagedCustomElement\n  implements TwistyControlElement, TimelineTimestampListener {\n  private timeline: Timeline;\n  range: HTMLInputElement = document.createElement(\"input\"); // type=\"range\"\n  constructor(timeline?: Timeline) {\n    super();\n    this.timeline = timeline!; // TODO\n\n    this.addCSS(twistyScrubberCSS);\n\n    this.timeline?.addTimestampListener(this); // TODO\n    this.range.type = \"range\";\n\n    this.range.step = (1).toString();\n    this.range.min = this.timeline?.minTimestamp().toString(); // TODO\n    this.range.max = this.timeline?.maxTimestamp().toString(); // TODO\n    this.range.value = this.timeline?.timestamp.toString(); // TODO\n    this.range.addEventListener(\"input\", this.onInput.bind(this));\n\n    this.addElement(this.range);\n  }\n\n  onTimelineTimestampChange(timestamp: MillisecondTimestamp): void {\n    this.range.value = timestamp.toString();\n  }\n\n  onTimeRangeChange(timeRange: TimeRange): void {\n    this.range.min = timeRange.start.toString();\n    this.range.max = timeRange.end.toString();\n  }\n\n  private onInput(): void {\n    this.timeline!.setTimestamp(parseInt(this.range.value, 10));\n  }\n}\n\ncustomElementsShim.define(\"twisty-scrubber\", TwistyScrubber);\n","import { CSSSource } from \"../element/ManagedCustomElement\";\n\nexport const twistyScrubberCSS = new CSSSource(`\n:host {\n  width: 384px;\n  height: 16px;\n  display: grid;\n}\n\n.wrapper {\n  width: 100%;\n  height: 100%;\n  display: grid;\n  overflow: hidden;\n  backdrop-filter: blur(4px);\n  -webkit-backdrop-filter: blur(4px);\n}\n\ninput {\n  margin: 0; width: 100%;\n}\n\ninput {\n  background: none;\n}\n\n::-moz-range-track {\n  background: rgba(0, 0, 0, 0.25);\n  height: 50%;\n  border: 1px solid rgba(0, 0, 0, 0.1);\n}\n\n::-webkit-slider-runnable-track {\n  background: rgba(0, 0, 0, 0.05);\n}\n\n::-moz-range-progress {\n  background: #3273F6;\n  height: 50%;\n  border: 1px solid rgba(0, 0, 0, 0.1);\n}\n\n::-ms-fill-lower {\n  background: #3273F6;\n  height: 50%;\n  border: 1px solid rgba(0, 0, 0, 0.1);\n}\n`);\n","import { CSSSource } from \"./element/ManagedCustomElement\";\n\n// TODO: figure out why `:host(twisty-player):fullscreen { background-color: white }` doesn't work.\nexport const twistyPlayerCSS = new CSSSource(`\n:host {\n  width: 384px;\n  height: 256px;\n  display: grid;\n}\n\n.wrapper {\n  display: grid;\n  overflow: hidden;\n  grid-template-rows: 7fr 1em 1fr;\n}\n\n.wrapper > * {\n  width: inherit;\n  height: inherit;\n  overflow: hidden;\n}\n\n.wrapper.controls-none {\n  grid-template-rows: 7fr;\n}\n\n.wrapper.controls-none twisty-scrubber,\n.wrapper.controls-none twisty-control-button-panel {\n  display: none;\n}\n\ntwisty-scrubber {\n  background: rgba(196, 196, 196, 0.5);\n}\n\n.wrapper.checkered {\n  background-color: #EAEAEA;\n  background-image: linear-gradient(45deg, #DDD 25%, transparent 25%, transparent 75%, #DDD 75%, #DDD),\n    linear-gradient(45deg, #DDD 25%, transparent 25%, transparent 75%, #DDD 75%, #DDD);\n  background-size: 32px 32px;\n  background-position: 0 0, 16px 16px;\n}\n`);\n","import {\n  combineTransformations,\n  KPuzzleDefinition,\n  KPuzzleSVGWrapper,\n  Transformation,\n  transformationForMove,\n} from \"../../../kpuzzle\";\nimport { PuzzleLoader } from \"../../../puzzles/PuzzleLoader\";\nimport { PuzzleAppearance } from \"../../../puzzles/stickerings/appearance\";\nimport {\n  PositionDispatcher,\n  PositionListener,\n} from \"../../animation/cursor/AlgCursor\";\nimport { Direction, PuzzlePosition } from \"../../animation/cursor/CursorTypes\";\nimport { RenderScheduler } from \"../../animation/RenderScheduler\";\nimport { ManagedCustomElement } from \"../element/ManagedCustomElement\";\nimport { customElementsShim } from \"../element/node-custom-element-shims\";\nimport { ExperimentalStickering } from \"../TwistyPlayerConfig\";\nimport { twisty2DSVGCSS } from \"./Twisty2DSVGView.css\";\nimport { TwistyViewerElement } from \"./TwistyViewerElement\";\n\nexport interface Twisty2DSVGOptions {\n  experimentalStickering?: ExperimentalStickering;\n}\n\n// <twisty-2d-svg>\nexport class Twisty2DSVG\n  extends ManagedCustomElement\n  implements TwistyViewerElement, PositionListener {\n  private definition: KPuzzleDefinition;\n  private svg: KPuzzleSVGWrapper;\n  private scheduler = new RenderScheduler(this.render.bind(this));\n  #cachedPosition: PuzzlePosition | null = null; // TODO: pull when needed.\n  constructor(\n    cursor?: PositionDispatcher,\n    def?: KPuzzleDefinition,\n    private svgSource?: string,\n    private options?: Twisty2DSVGOptions,\n    private puzzleLoader?: PuzzleLoader,\n  ) {\n    super();\n    this.addCSS(twisty2DSVGCSS);\n\n    this.definition = def!;\n    this.resetSVG(); // TODO\n    cursor?.addPositionListener(this); // TODO\n\n    if (this.options?.experimentalStickering) {\n      this.experimentalSetStickering(this.options.experimentalStickering);\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars-experimental\n  onPositionChange(position: PuzzlePosition): void {\n    if (position.movesInProgress.length > 0) {\n      const move = position.movesInProgress[0].move;\n\n      const def = this.definition;\n      let partialMove = move;\n      if (position.movesInProgress[0].direction === Direction.Backwards) {\n        partialMove = move.invert();\n      }\n      const newState = combineTransformations(\n        def,\n        position.state as Transformation,\n        transformationForMove(def, partialMove),\n      );\n      // TODO: move to render()\n      this.svg.draw(\n        this.definition,\n        position.state as Transformation,\n        newState,\n        position.movesInProgress[0].fraction,\n      );\n    } else {\n      this.svg.draw(this.definition, position.state as Transformation);\n      this.#cachedPosition = position;\n    }\n  }\n\n  scheduleRender(): void {\n    this.scheduler.requestAnimFrame();\n  }\n\n  experimentalSetStickering(stickering: ExperimentalStickering): void {\n    (async () => {\n      if (!this.puzzleLoader?.appearance) {\n        return;\n      }\n      const appearance = await this.puzzleLoader.appearance(stickering);\n      this.resetSVG(appearance);\n    })();\n  }\n\n  // TODO: do this without constructing a new SVG.\n  private resetSVG(appearance?: PuzzleAppearance): void {\n    if (this.svg) {\n      this.removeElement(this.svg.element);\n    }\n    if (!this.definition) {\n      return; // TODO\n    }\n    this.svg = new KPuzzleSVGWrapper(\n      this.definition,\n      this.svgSource!,\n      appearance,\n    ); // TODO\n    this.addElement(this.svg.element);\n    if (this.#cachedPosition) {\n      this.onPositionChange(this.#cachedPosition);\n    }\n  }\n\n  private render(): void {\n    /*...*/\n  }\n}\n\ncustomElementsShim.define(\"twisty-2d-svg\", Twisty2DSVG);\n","import { CSSSource } from \"../element/ManagedCustomElement\";\n\n// TODO: Can we do this without so much nesting, and styling all the nested elems?\nexport const twisty2DSVGCSS = new CSSSource(`\n:host {\n  width: 384px;\n  height: 256px;\n  display: grid;\n}\n\n.wrapper {\n  width: 100%;\n  height: 100%;\n  display: grid;\n  overflow: hidden;\n}\n\n.svg-wrapper,\ntwisty-2d-svg,\nsvg {\n  width: 100%;\n  height: 100%;\n  display: grid;\n  min-height: 0;\n}\n`);\n"],"names":["SHOW_STATS","experimentalShowRenderStats","show","resizeObserverWarningShown","shareAllNewRenderers","experimentalSetShareAllNewRenderers","share","sharedRenderer","newRenderer","WebGLRenderer","antialias","alpha","newSharedRenderer","Twisty3DCanvas","ManagedCustomElement","constructor","scene","options","RenderScheduler","render","bind","addCSS","twisty3DCanvasCSS","addRenderTarget","stats","dom","style","position","addElement","rendererIsShared","renderer","canvas","document","createElement","domElement","canvas2DContext","getContext","camera","PerspectiveCamera","copy","experimentalCameraPosition","Vector3","negateCameraPosition","multiplyScalar","lookAt","orbitControls","TwistyOrbitControls","scheduleRender","window","ResizeObserver","observer","onResize","observe","contentWrapper","console","warn","setMirror","partner","experimentalSetLatitudeLimits","limits","experimentalLatitudeLimits","connectedCallback","resize","scheduler","requestAnimFrame","makeInvisibleUntilRender","classList","add","experimentalSetOnRenderFinish","f","begin","cancelAnimFrame","resizePending","setSize","width","height","clearRect","drawImage","remove","end","w","clientWidth","h","clientHeight","off","legacyExperimentalShift","Math","max","floor","yoff","excess","aspect","setViewOffset","updateProjectionMatrix","toString","setPixelRatio","renderToDataURL","squareCrop","toDataURL","tempCanvas","squareSize","min","tempCtx","customElementsShim","define","callback","animFrameWrapper","animFrameID","requestAnimationFrame","animFrame","cancelAnimationFrame","timestamp","CSSSource","sourceText","getAsString","HTMLElementShim","Map","shadow","attachShadow","mode","appendChild","cssSource","cssSourceMap","get","cssElem","textContent","set","removeCSS","removeChild","delete","element","prependElement","prepend","removeElement","HTMLElementStub","HTMLElement","CustomElementsStub","customElements","pixelRatio","devicePixelRatio","EPSILON","INERTIA_DEFAULT","LATITUDE_LIMITS_DEFAULT","INERTIA_DURATION_MS","INERTIA_TIMEOUT_MS","VERTICAL_MOVEMENT_BASE_SCALE","momentumScale","progress","exp","E","Inertia","startTimestamp","momentumX","momentumY","lastTimestamp","now","progressBefore","progressAfter","delta","onMove","onMouseMove","onMouseEnd","onTouchMove","onTouchEnd","Spherical","addEventListener","onMouseStart","onTouchStart","temperMovement","sign","log","abs","e","onMouseMoveBound","onMouseEndBound","onStart","lastMouseTimestamp","timeStamp","buttons","minDim","offsetWidth","offsetHeight","movementX","movementY","lastMouseMoveMomentumX","lastMouseMoveMomentumY","removeEventListener","onEnd","experimentalInertia","onMoveBound","currentTouchID","changedTouches","identifier","lastTouchClientX","touches","clientX","lastTouchClientY","clientY","onTouchMoveBound","onTouchEndBound","lastTouchTimestamp","i","length","touch","lastTouchMoveMomentumX","lastTouchMoveMomentumY","preventDefault","tempSpherical","setFromVector3","theta","phi","PI","setFromSpherical","experimentalHasBeenMoved","mirrorControls","updateMirroredCamera","m","c","CountMoves","TraversalUp","metric","traverseAlg","alg","r","unit","units","traverseUnit","traverseGrouping","grouping","experimentalAlg","experimentalEffectiveAmount","traverseMove","move","traverseCommutator","commutator","A","B","traverseConjugate","conjugate","traversePause","_pause","traverseNewline","_newLine","traverseLineComment","_comment","isCharUppercase","baseMetric","fam","family","countMovesInstance","countMoves","CountAnimatedMoves","total","part","_move","_newline","countAnimatedMovesInstance","countAnimatedMoves","DEFAULT_CAMERA_Z","DEFAULT_CAMERA_Y","sqrt","centeredCameraPosition","cubeCameraPosition","setupToLocations","start","visualizationFormats","backgroundThemes","checkered","none","hintFaceletStyles","floating","experimentalStickerings","controlsLocations","puzzleIDs","viewerLinkPages","twizzle","twistyPlayerAttributeMap","TwistyPlayerConfig","twistyPlayer","initialValues","attributes","AlgAttribute","experimentalSetupAlg","StringEnumAttribute","experimentalSetupAnchor","puzzle","visualization","hintFacelets","experimentalStickering","background","controlPanel","backViewLayouts","Vector3Attribute","viewerLink","observedAttributes","Object","keys","attributeChangedCallback","attributeName","oldValue","newValue","managedAttribute","string","setString","propertyName","value","initialValue","setValue","defaultValue","str","toValue","val","Alg","s","fromString","enumVal","Error","StringFakeEnumAttribute","validStrings","includes","startsWith","endsWith","coords","slice","split","x","y","z","map","parseInt","v","TwistyViewerWrapper","config","ClassListManager","twistyViewerWrapperCSS","backView","setBackView","clear","innerHTML","elem","prefix","validSuffixes","clearValue","suffix","newClassName","changed","is3DVisualization","visualizationFormat","indexerMap","simple","SimpleAlgIndexer","tree","TreeAlgIndexer","simultaneous","SimultaneousMoveIndexer","TwistyPlayer","initialConfig","legacyExperimentalPG3DViewConfig","experimentalInvalidInitialAlgCallback","twistyPlayerCSS","timeline","Timeline","addActionListener","newAlg","cursor","setAlg","indexerConstructor","setCursorStartState","setStartState","algToState","cursorStartAlg","startAlg","concat","invert","setupToLocation","updatePuzzleDOM","twisty3D","Cube3D","experimentalUpdateOptions","PG3D","appearance","getPG3DAppearance","experimentalSetAppearance","viewerElems","Twisty2DSVG","experimentalSetStickering","toggle","controls","createBackViewer","removeBackViewerElem","viewer","cameraPosition","effectiveCameraPosition","viewerLinkPage","maybePanel","controlElems","setViewerLink","defaultCameraPosition","experimentalSetStartStateOverride","state","experimentalSetCursorIndexer","cursorName","experimentalSetIndexer","scrubber","TwistyScrubber","controlButtonGrid","TwistyControlButtonPanel","fullscreenElement","viewerLinkCallback","visitTwizzleLink","twizzleLink","url","URL","experimentalIsEmpty","searchParams","a","href","target","click","clearRenderMode","legacyExperimentalPG3D","setRenderMode2D","setTwisty2DSVG","twisty2DSVG","push","setRenderMode3D","Twisty3DScene","mainViewer","setTwisty3D","removeTwisty3DPuzzle","dispose","addTwisty3DPuzzle","setCursor","oldCursor","addCursor","removeCursor","removeTimestampListener","initial","puzzleLoader","id","fullName","def","Promise","resolve","svg","puzzles","pendingPuzzleUpdate","cancelled","AlgCursor","jumpToEnd","svgPromiseFn","llSVG","stickerDat","pgGetter","pg","writekpuzzle","get3d","pg3d","showFoundation","hintStickers","backViewer","pop","setCustomPuzzleGeometry","experimentalAddMove","coalesce","coalesceDelayed","hackyCoalescePending","oldNumMoves","mod","legacyExperimentalCoalesceModFunc","experimentalJumpToLastMove","play","onTimelineAction","actionEvent","action","TimelineAction","Pausing","locationType","TimestampLocationType","EndOfTimeline","Array","from","pending","is","Move","finalMove","fullscreen","requestFullscreen","svgLoader","TextureLoader","ignoredMaterial","MeshBasicMaterial","color","side","DoubleSide","ignoredMaterialHint","BackSide","invisibleMaterial","visible","orientedMaterial","orientedMaterialHint","AxisInfo","vector","fromZ","dimColor","stickerMaterial","regular","dim","oriented","ignored","invisible","hintStickerMaterial","transparent","opacity","axesInfo","Euler","TAU","face","U","L","F","R","D","familyToAxis","u","Uw","l","Lw","M","Fw","S","Rw","b","Bw","d","Dw","cubieDimensions","stickerWidth","stickerElevation","foundationWidth","hintStickerElevation","EXPERIMENTAL_PICTURE_CUBE_HINT_ELEVATION","experimentalSetDefaultStickerElevation","cube3DOptionsDefaults","showMainStickers","blackMesh","blackTranslucentMesh","CubieDef","orbit","stickerFaceNames","q","individualStickerFaceNames","stickerFaces","matrix","Matrix4","setPosition","firstPiecePosition","premultiply","makeRotationFromQuaternion","t","t4","Quaternion","setFromAxisAngle","O","EDGES","CORNERS","CENTERS","orientationRotation","makeRotationAxis","clone","normalize","cubieStickerOrder","pieceDefs","CUBE_SCALE","pictureStickerCoords","sharedCubieFoundationGeometryCache","sharedCubieFoundationGeometry","BoxGeometry","newStickerGeometry","BufferGeometry","half","setAttribute","BufferAttribute","Float32Array","sharedStickerGeometryCache","sharedStickerGeometry","Object3D","scheduleRenderCallback","setSpriteURL","load","setHintSpriteURL","assign","name","kpuzzleFaceletInfo","orbitFaceletInfo","pieces","createCubie","scale","setStickering","addPositionListener","experimentalSetStickerSpriteURL","stickerSpriteURL","experimentalSetHintStickerSpriteURL","hintStickerSpriteURL","stickering","setAppearance","orbitName","orbitAppearance","entries","orbits","pieceIdx","pieceAppearance","pieceInfo","faceletIdx","faceletAppearance","facelets","faceletInfo","facelet","material","faceIdx","hintAppearance","hintFacelet","foundation","experimentalFoundationMeshes","hintSticker","experimentalHintStickerMeshes","onPositionChange","p","reid333","j","permutation","multiply","orientation","moveProgress","movesInProgress","turnNormal","moveMatrix","ease","fraction","direction","effectiveAmount","k","moves","orbitFacelets","piece","orbitPieceIdx","cubieFaceletInfo","cubie","Group","createCubieFoundation","sticker","createSticker","rotate","offsetX","offsetY","addImageSticker","hint","texture","hintSprite","sprite","mesh","x1","x2","y1","y2","v1","Vector2","v2","v3","v4","geometry","matrixAutoUpdate","box","Mesh","posAxisInfo","materialAxisInfo","isHint","geo","stickerMesh","setRotationFromEuler","experimentalSetFoundationOpacity","experimentalSetStickerWidth","orbitInfo","values","setScalar","experimentalSetCenterStickerWidth","smootherStep","foundationMaterial","vertexColors","polyMaterial","Filler","sz","colored","vertices","colors","Uint8Array","ind","pos","ipos","pt","addUncolored","setind","setAttributes","makeGroups","clearGroups","si","iv","addGroup","makePoly","filler","faceArray","ncoords","g","StickerDef","sdColor","Color","getHex","origColor","origColorAppearance","faceColor","highArea","goodFace","Triangle","getArea","norm","getNormal","hintCoords","addFoundation","foundationDat","black","faceletMeshAppearance","setColor","HitPlaneDef","hitface","obj","userData","axisDat","vec","axis","order","PG_SCALE","definition","pgdat","params","axesDef","stickers","materialArray1","materialArray2","triangleCount","multiplier","sides","ord","ori","stickerdef","foundationBound","foundations","fixedGeo","obj2","hitfaces","faces","movingObj","facedef","controlTargets","children","experimentalGetStickerTargets","stickerTargets","experimentalGetControlTargets","numPieces","orientations","stickerDef","lastPos","noRotation","rotation","colormods","pos2","orin","pieces2","ni","nori","vismods","externalMove","unswizzled","unswizzle","notationMapper","notationToInternal","quantumTransformation","quantum","ax","angle","rotateOnAxis","lastMove","bmv","tv","twistVal","getAttribute","updateRange","offset","count","needsUpdate","ThreeScene","Set","renderTarget","renderTargets","twisty3DPuzzle","twisty3Ds","clearPuzzles","puz","startStateAlg","ksolvePuzzle","KPuzzleWrapper","instantiateIndexer","startState","addTimestampListener","dispatchPositionForTimestamp","onCursorChange","indexer","kpuzzle","KPuzzle","applyAlg","combine","startPieces","timeRange","algDuration","experimentalTimestampForStartOfLastMove","numMoves","indexToMoveStartTimestamp","positionListener","positionListeners","removePositionListener","onTimelineTimestampChange","listeners","timestampToPosition","idx","timestampToIndex","stateAtIndex","moveDuration","stateFromMove","getMove","Direction","Forwards","listener","onTimeRangeChange","_timeRange","isIdentical","moveBoundary","offsetHack","moveStart","Backwards","moveEnd","setPuzzle","experimentalTimestampFromIndex","index","experimentalIndexFromTimestamp","PuzzleWrapper","amount","identity","newState","fromID","s1","s2","key","moveCache","equivalent","QTMCounterState","QTMCounterPuzzle","deccon","DecoratorConstructor","chunkedAlg","decoration","walker","AlgWalker","moveByIndex","back","dur","indexToMovesInProgress","startTransformation","st","transformAtIndex","moveCount","moveByDuration","duration","MIN_CHUNKING_THRESHOLD","chunkifyAlg","chunkMaxLength","mainAlgBuilder","AlgBuilder","chunkAlgBuilder","experimentalNumUnits","Grouping","toAlg","reset","ChunkAlgs","algLength","ceil","Conjugate","pause","newline","comment","chunkAlgsInstance","chunkAlgs","AlgPartDecoration","_puz","forward","backward","AlgDuration","defaultDurationForAmount","dummyLeaf","child","apd","dec","mult","cache","durationFn","decA","decB","AB","ApBp","ABApBp","ABAp","n","absn","WalkerDown","TraversalDownUp","algOrUnit","goali","goaldur","undefined","root","loc","dosearch","Infinity","wd","firstcheck","ExperimentalIterationDirection","domult","_wd","_lineComment","keepgoing","base","full","mul","constantDurationForAmount","_amount","ExperimentalScaledDefaultDurationForAmount","durationForAmount","directionScalar","BoundaryType","experimentalExpand","cumulativeTime","demos","getMoveWithRange","moveWithRange","axisLookup","isSameAxis","move1","move2","toLowerCase","LocalSimulMoves","processed","nestedUnit","prototype","traverseGroupingOnce","maxSimulDur","localMovesWithRange","blockMove","msUntilNext","segmentOnce","segmentsOnce","segment","localSimulMovesInstance","localSimulMoves","simulMoves","localSimulMove","PAUSE_ON_JUMP","getNow","round","performance","EntireTimeline","_now","animating","tempoScale","lastAnimFrameNow","atOrPastBoundary","cachedNextBoundary","dispatchAction","lastAnimFrameTimestamp","dispatchTimestamp","cursors","dispatchTimeRange","clampTimestampToRange","setTimestamp","_cursor","maxTimestamp","cursorTimeRange","minTimestamp","timestampListeners","timestampListener","actionListener","actionListeners","removeActionListener","experimentalPlay","boundaryType","nextBoundary","StartingToPlay","result","boundaryTimestamp","playPause","oldTimestamp","Jumping","jumpToStart","event","MiddleOfMove","StartOfTimeline","TwistyControlButton","timelineCommand","visitTwizzleLinkCallback","buttonCSS","setIcon","initialIcon","setHoverTitle","initialHoverTitle","button","onPress","fullscreenEnabled","disabled","autoSetTimelineBasedDisabled","buttonIconName","currentIconName","title","exitFullscreen","then","onFullscreen","_timestamp","buttonGridCSS","twistyScrubberCSS","range","type","step","onInput","svgSource","twisty2DSVGCSS","resetSVG","partialMove","draw","KPuzzleSVGWrapper"],"version":3,"file":"index.3a4f7a9b.js.map"}